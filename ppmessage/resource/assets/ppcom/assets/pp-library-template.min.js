!function(){function PPMessage(jQuery){function extend(e,t){e.prototype=function(e){function n(){}return e?Object.create(t.prototype):(n.prototype=t.prototype,new n)}(void 0!==Object.create),e.prototype.constructor=e}var fn={$:jQuery,Service:{},View:{},Modal:{},Controller:{},Factory:{},Configuration:{},Toolkit:{}},$=fn.$,Service=fn.Service,View=fn.View,Modal=fn.Modal,Controller=fn.Controller,Factory=fn.Factory,Ctrl=Controller,Configuration=fn.Configuration,Toolkit=fn.Toolkit,$timeout=setTimeout,$clearTimeout=clearTimeout,$onResult=function(e,t){t&&t(e)};Configuration={api_key:"{ppcom_api_key}",api_secret:"{ppcom_api_secret}",assets_path:"{ppcom_assets_path}",portal:"{portal}",api:"{api}",auth:"{auth}",web_socket_url:"{web_socket_url}",file_upload_url:"{file_upload_url}",file_upload_txt_url:"{file_upload_txt_url}",file_download_url:"{file_download_url}"},function(e,t){"use strict";var n=function(t,n){this.$element=e(t),this.options=e.extend({},self.DEFAULTS,n),this.$scroll=e(n.scroll),this.flags={prevented:!1,moving:!1,touched:!1,isTouch:!1,refreshed:!1},this.positions={startY:0,startX:0,lastStep:0,delta:0}};n.key="pulltorefresh",n.DEFAULTS={orientation:"down",sensibility:5,refresh:70,click:1e-6,lockRefresh:!1,resetRefresh:!0,autoInit:!0,resetSpeed:"100ms",simulateTouch:!0,threshold:20,scroll:t},n.namespace=function(e){return[e,n.key].join(".")},n.support={touch:window.Modernizr&&Modernizr.touch===!0||function(){return!!("ontouchstart"in window||window.DocumentTouch&&t instanceof DocumentTouch)}()},n.events=function(){if(n.support.touch)return{start:n.namespace("touchstart"),move:n.namespace("touchmove"),end:n.namespace("touchend")};var e={start:n.namespace("mousedown"),move:n.namespace("mousemove"),end:n.namespace("mouseup")};return window.navigator.msPointerEnabled&&(e={start:n.namespace("MSPointerDown"),move:n.namespace("MSPointerMove"),end:n.namespace("MSPointerUp")}),window.navigator.pointerEnabled&&(e={start:n.namespace("pointerdown"),move:n.namespace("pointermove"),end:n.namespace("pointerup")}),e}(),n.prototype.construct=function(){var i=this;i.$element.on(n.events.start,i.proxy(i.onTouchStart,i)).on(n.events.move,i.proxy(i.onTouchMove,i)).on(n.events.end,i.proxy(i.onTouchEnd,i)),i.options.simulateTouch&&(i.$element.on(n.namespace("mousedown"),i.proxy(i.onTouchStart,i)),e(t).on(n.namespace("mousemove"),i.$element,i.proxy(i.onTouchMove,i)).on(n.namespace("mouseup"),i.$element,i.proxy(i.onTouchEnd,i)))},n.prototype.destroy=function(){this.remove_transition(this.$element[0].style),this.remove_transform(this.$element[0].style),e(t).off(n.namespace("")),this.$element.off(n.namespace("")),this.$element.removeData("pulltorefresh")},n.prototype.proxy=function(){var t=!!Function.prototype.bind;return t?function(e,t){return e.bind(t)}:e.proxy?e.proxy:function(e,t){var n,i,o;return"string"==typeof t&&(n=e[t],t=e,e=n),"function"!=typeof e?(i=Array.prototype.slice.call(arguments,2),o=function(){return e.apply(t||this,i.concat(slice.call(arguments)))},o.guid=e.guid=e.guid||jQuery.guid++,o):void 0}}(),n.prototype.transform=function(e,t){e.webkitTransform="translate(0, "+t+"px) translateZ(0)",e.msTransform=e.MsTransform=e.MozTransform=e.OTransform=e.transform="translateY("+t+"px)"},n.prototype.transition=function(e,t){e.webkitTransitionDuration=e.MozTransitionDuration=e.msTransitionDuration=e.OTransitionDuration=e.transitionDuration=t},n.prototype.remove_transition=function(e){e.webkitTransitionDuration=e.MozTransitionDuration=e.msTransitionDuration=e.OTransitionDuration=e.transitionDuration=null},n.prototype.remove_transform=function(e){e.webkitTransform=e.msTransform=e.MsTransform=e.MozTransform=e.OTransform=e.transform=null},n.prototype.getAxis=function(e,t){return{x:t?(e.targetTouches||e.originalEvent.targetTouches)[0].pageX:e.pageX||e.clientX,y:t?(e.targetTouches||e.originalEvent.targetTouches)[0].pageY:e.pageY||e.clientY}},n.prototype.onTouchStart=function(e){var t="touchstart"===e.type,i=this.getAxis(e,t);return this.$scroll.scrollTop()>0?!0:void((t||1===e.which)&&(this.flags.touched=!0,this.flags.refreshed=!1,this.flags.isTouch=t,this.positions.startY=i.y,this.positions.startX=i.x,this.$element.trigger(n.namespace("start"),[i.y]),this.transition(this.$element[0].style,"0ms")))},n.prototype.onTouchMove=function(e){var t,i,o,r,a="touchmove"===e.type;if(this.flags.touched&&(!this.flags.isTouch||"mousemove"!==e.type)){if(!this.flags.prevented&&e.target&&(e.target.click||e.target.onclick)&&(this.flags.prevented=!0),r=this.getAxis(e,a),t=r.y-this.positions.startY,this.positions.delta=t,Math.abs(r.x-this.positions.startX)>this.options.threshold)return void this.reset();if(!(0>t&&"down"==this.options.orientation||t>=0&&"up"==this.options.orientation))return(0>t?-1*t:t)>=this.options.refresh&&!this.flags.refreshed&&(this.$element.trigger(n.namespace("refresh"),[r.y]),this.flags.refreshed=!0,this.options.resetRefresh)?void this.reset():void(this.flags.refreshed&&this.options.lockRefresh||(i=parseInt(t/this.options.sensibility,10),this.positions.lastStep!=i&&(o=parseInt(100*t/this.options.refresh,10),this.$element.trigger(n.namespace("move"),o),this.positions.lastStep=i),this.transform(this.$element[0].style,t),e.stopPropagation(),e.preventDefault()))}},n.prototype.reset=function(){this.transition(this.$element[0].style,this.options.resetSpeed),this.transform(this.$element[0].style,0),this.flags.touched=!1,this.flags.isTouch=!1,this.flags.refreshed=!1,this.positions.startY=!1,this.positions.delta=0},n.prototype.onTouchEnd=function(t){if(this.flags.touched){var i=this.positions.delta;this.flags.prevented=!1,this.positions.startY=0,this.positions.startX=0,this.reset(),this.$element.trigger(n.namespace("end")),t.stopPropagation(),t.preventDefault();var o=t.target.click||t.target.onclick;o&&Math.abs(i)<=this.options.click&&e(t.target).trigger("click")}};var i=e.fn.pullToRefresh;e.fn.pullToRefresh=function(t){return this.each(function(){var i=e(this),o=i.data(n.key),r=e.extend({},n.DEFAULTS,i.data(),"object"==typeof t&&t);return o||"destroy"!=t?(o||(i.data(n.key,o=new n(this,r)),r.autoInit&&o.construct()),void("string"==typeof t&&o[t].apply(o))):n.destroy()})},e.fn.pullToRefresh.Constructor=n,e.fn.pullToRefresh.noConflict=function(){return e.fn.pullToRefresh=i,this}}($,"#pp-conversation-content"),function(e){e.extend(e.easing,{easeInQuart:function(e,t,n,i,o){return i*(t/=o)*t*t*t+n}})}($),function(){Service._booted=!1,Service.bootMe=function(e){Service._booted&&!e||(Service.$cookies=new Service.PPCookies,Service.$tools=new Service.PPTools,Service.$errorHint=new Service.ErrorHint,Service.$publicApi=new Service.PublicAPI,Service.$startUp=new Service.PPStartUp(Service.$api,Service.$device),Service.$conversationManager.init(),Service._booted=!0)}}(),function(e){function t(){}e.BaseService=t}(Service),function(e){function t(){}t.ICON_DEFAULT_LAUNCHER=Configuration.assets_path+"img/logo_1.png",t.DEFAULT_HEADER_TITLE="PPMessage",t.ICON_DEFAULT_USER=Configuration.assets_path+"img/logo_1.png",t.USER_DEFAULT_NAME="Anonymous",t.STYLE={EMOJI_PANEL_DEFAULT_BOTTOM_MARGIN:67},t.EVENT={NEW_MESSAGE_ARRIVED:"message:NEW_ARRIVED",ON_TEXTAREA_HEIGHT_CHANGED:"textarea:height-change"},t.MESSAGE={TYPE_TEXT:"TEXT",TYPE_EMOJI:"EMOJI",TYPE_IMAGE:"IMAGE",TYPE_FILE:"FILE",TYPE_WELCOME:"WELCOME",TYPE_TIMESTAMP:"TIMESTAMP",TO_TYPE:"P2S",TEXT_MAX_LEN:128},t.MAX_UPLOAD_SIZE=4194304,t.MAX_UPLOAD_SIZE_STR="4MB",t.MESSAGE_TYPE={NOTI:"NOTI",SYS:"SYS"},t.FILE={ROOT:"PP"},t.MESSAGE_SUBTYPE={AUDIO:"AUDIO",VIDEO:"VIDEO",DOCUMENT:"DOCUMENT",FILE:"FILE",TEXT:"TEXT",IMAGE:"IMAGE",SINGLE_CARD:"SINGLE_CARD",MULTIPLE_CARD:"MULTIPLE_CARD",TXT:"TXT",MENU:"MENU",EVENT:"EVENT",GPS_LOCATION:"GPS_LOCATION",INVITE_CONTACT:"INVITE_CONTACT",ACCEPT_CONTACT:"ACCEPT_CONTACT",REMOVE_CONTACT:"REMOVE_CONTACT",DG_INVITED:"DG_INVITED",DG_REMOVED:"DG_REMOVED",REQUEST_JOIN_OG:"REQUEST_JOIN_OG",APPROVE_JOIN_OG:"APPROVE_JOIN_OG",LOGOUT:"LOGOUT"},t.I18N={"zh-CN":{START_CONVERSATION_HINT:"按“回车键”发送",START_CONVERSATION_MOBILE_HINT:"",ERROR_TEXT_TOO_LONG:"字数太长",WELCOME_MSG:"您好，请问有什么可以帮助您的？",CLOSE_BUTTON_HINT:"结束会话",MINIZE_BUTTON_HINT:"最小化",MAXIMUM_UPLOAD_SIZE_HINT:"最大文件大小为",PPMESSAGE:"皮皮消息",HOVER_CARD_TEXTAREA_HINT:"开始对话",DEFAULT_SERVE_NAME:"客服",UPLOADING_HINT:"正在上传",SEND:"发送",WAITING_AVALIABLE_CONVERSATION:"正在等待客服...",WAITING_LENGTH_HINT:"正在排队中，当前共有%s人正在等待",LOAD_HISTORY_HINT:"点击加载历史消息",LOAD_HISTORY_MOBILE_HINT:"下拉加载历史消息",LOADING_HISTORY:"正在加载...",NO_MORE_HISTORY:"没有更多历史消息",IMAGE:"图片",FILE:"文件",AUDIO:"语音",SEND_ERROR:"发送失败",SERVICE_NOT_AVALIABLE:"服务不可用",CANCELED:"已取消",CLOSE:"关闭",CONSULT_WORKING_TIME:"服务时间",CONTACT_NUMBER:"联系电话",ONLINE:"在线",OFFLINE:"离线",SYSTEM_MSG:"系统消息",TYPING:"对方正在输入...",AUDIO_PLAY_ERROR:"播放失败",timeFormat:function(t){return e.$tools.formatTime(t,{year:"年",month:"月",day:"日",today:"今天",yesterday:"昨天"})}},en:{START_CONVERSATION_HINT:'Press "Enter key" to send',START_CONVERSATION_MOBILE_HINT:"",ERROR_TEXT_TOO_LONG:"Text is too long",WELCOME_MSG:"Hello, what can I do for you ?",CLOSE_BUTTON_HINT:"Close Conversation",MINIZE_BUTTON_HINT:"Minimization",MAXIMUM_UPLOAD_SIZE_HINT:"The maximum upload size is ",PPMESSAGE:"PPMessage",HOVER_CARD_TEXTAREA_HINT:"Start a conversation",DEFAULT_SERVE_NAME:"Service",UPLOADING_HINT:"Uploading",SEND:"Send",WAITING_AVALIABLE_CONVERSATION:"Waiting service ...",WAITING_LENGTH_HINT:"There are total %s person in the queue",LOAD_HISTORY_HINT:"Click to load history",LOAD_HISTORY_MOBILE_HINT:"Pull to load history",LOADING_HISTORY:"Loading...",NO_MORE_HISTORY:"No more history",IMAGE:"Image",FILE:"File",AUDIO:"Audio",SEND_ERROR:"Send Error",SERVICE_NOT_AVALIABLE:"Service Not Avaliable",CANCELED:"Cancled",CLOSE:"Close",CONSULT_WORKING_TIME:"Online Time",CONTACT_NUMBER:"Contact Number",ONLINE:"Online",OFFLINE:"Offline",SYSTEM_MSG:"System message",TYPING:"Typing...",AUDIO_PLAY_ERROR:"Play Error",timeFormat:function(t){return e.$tools.formatTime(t,{year:"-",month:"-",day:"",today:"Today",yesterday:"Yesterday"})}}},t.i18n=function(t){return e.Constants.I18N[e.$language.getLanguage()][t]},e.Constants=t}(Service),function(e){function t(){var t=null,n=null,i=null,o=null,r=function(t,n){e.$debug.d("[PPAPI] [Error]: ",t),e.$errorHint.warn(e.ErrorHint.ERROR_SERVICE_NOT_AVALIABLE),n&&n(t)},a=function(t,n){e.$debug.d("[PPAPI] [Fail]: ",t),n&&n(t)},s=function(t,n){e.$debug.d("[PPAPI] [Success]: ",t),n&&n(t)},c=function(e,t,n){if(e&&void 0!==e.error_code){var i=!1;switch(e.error_code){case 0:i=!0}i?s(e,t):a(e,n)}else a(e,n)},u=function(t,n){e.$debug.d("[PPAPI] [Request]: ",t,n)};this._post=function(n,i,o,a){if(null==t)return e.$debug.d("[PPAPI] [Error]: ","no token"),void e.$errorHint.warn(e.ErrorHint.ERROR_SERVICE_NOT_AVALIABLE);var s=Configuration.api+n;$.support.cors=!0,$.ajax({url:s,type:"post",data:e.$json.stringify(i),headers:{"Content-Type":"application/json;charset=utf-8",Authorization:"OAuth "+t},cache:!1,crossDomain:!0,beforeSend:function(){u(s,i)},success:function(e){c(e,o,a)},error:function(e,t,n){r(t,a)}})},this.init=function(e,t,r){o=e,n=t,i=r},this.getPPComToken=function(e,o){var a=Configuration.auth+"/token",c="client_id="+n+"&client_secret="+i+"&grant_type=client_credentials";$.support.cors=!0,$.ajax({url:a,type:"post",data:c,headers:{"Content-Type":"application/x-www-form-urlencoded"},cache:!1,crossDomain:!0,beforeSend:function(){u(a,c)},success:function(n){t=n.access_token,s(n,e)},error:function(e,t,n){r(t,o)}})},this.updateUser=function(e,t,n){this._post("/PP_UPDATE_USER",$.extend({},e),t,n)},this.getConversationList=function(e,t,n){this._post("/PP_GET_USER_CONVERSATION_LIST",$.extend({},e),t,n)},this.getConversation=function(e,t,n){this.getConversationList(e,t,n)},this.createConversation=function(e,t,n){this._post("/PP_CREATE_CONVERSATION",$.extend({},e),t,n)},this.sendMessage=function(e,t,n){this._post("/PP_SEND_MESSAGE",e,t,n)},this.getUnackedMessages=function(e,t,n){this._post("/GET_UNACKED_MESSAGES",$.extend({},e),t,n)},this.ackMessage=function(e,t,n){this._post("/ACK_MESSAGE",$.extend({},e),t,n)},this.createAnonymousUser=function(e,t,n){this._post("/PP_CREATE_ANONYMOUS",$.extend({},e),t,n)},this.createDevice=function(e,t,n){this._post("/PP_CREATE_DEVICE",$.extend(!0,{},e),t,n)},this.updateDevice=function(e,t,n){this._post("/PP_UPDATE_DEVICE",$.extend({},e),t,n)},this.getUserUuid=function(e,t,n){this._post("/PP_GET_USER_UUID",$.extend({},e),t,n)},this.getUserDetailInfo=function(e,t,n){this._post("/GET_YVOBJECT_DETAIL",$.extend({},e),t,n)},this.getMessageHistory=function(e,t,n){this._post("/PP_GET_HISTORY_MESSAGE",$.extend({},e),t,n)},this.getAppInfo=function(e,t,n){this._post("/PP_GET_APP_INFO",$.extend({},e),t,n)},this.getWelcomeTeam=function(e,t,n){this._post("/PP_GET_WELCOME_TEAM",$.extend({},e),t,n)},this.getAppOrgGroupList=function(e,t,n){this._post("/PP_GET_APP_ORG_GROUP_LIST",$.extend({},e),t,n)},this.getOrgGroupUserList=function(e,t,n){this._post("/PP_GET_ORG_GROUP_USER_LIST",$.extend({},e),t,n)},this.getOrgGroupConversationId=function(e,t,n){this._post("/PP_GET_ORG_GROUP_CONVERSATION",$.extend({},e),t,n)},this.getDefaultConversation=function(e,t,n){this._post("/PP_GET_DEFAULT_CONVERSATION",$.extend({},e),t,n)},this.getConversationUserList=function(e,t,n){this._post("/PP_GET_CONVERSATION_USER_LIST",$.extend({},e),t,n)},this.cancelWaitingCreateConversation=function(e,t,n){this._post("/PP_CANCEL_WAITING_CREATE_CONVERSATION",$.extend({},e),t,n)},this.getPPComDefaultConversation=function(e,t,n){this._post("/PPCOM_GET_DEFAULT_CONVERSATION",$.extend({},e),t,n)},this.createPPComConversation=function(e,t,n){this._post("/PPCOM_CREATE_CONVERSATION",$.extend({},e),t,n)},this.getConversationInfo=function(e,t,n){this._post("/PP_GET_CONVERSATION_INFO",$.extend({},e),t,n)},this.getWaitingQueueLength=function(e,t,n){this._post("/PP_GET_AMD_QUEUE_LENGTH",$.extend({},e),t,n)},this.getAppUuid=function(){return o},this.getApiToken=function(){return t}}e.$api=new t}(Service),Service.$rootCache=function(){var e={},t=function(t){return e[t]},n=function(t,n){e[t]=n},i=function(t){return void 0!==e[t]};return{get:t,set:n,exist:i}}(),function(e){function t(){}t.prototype._api=function(e,t,n){if(arguments.length>1){if(n=n||{},"number"==typeof n.expires){var i=new Date;i.setMilliseconds(i.getMilliseconds()+1e3*n.expires),n.expires=i}return document.cookie=[e,"=",t,n.expires&&"; expires="+n.expires.toUTCString(),n.path&&"; path="+n.path,n.domain&&"; domain="+n.domain,n.secure?"; secure":""].join("")}for(var o,r=document.cookie?document.cookie.split("; "):[],a=0;a<r.length;a++){var s=r[a].split("="),c=s[0],t=s[1];if(c===e){o=t;break}}return o},t.prototype.set=function(e,t,n){return this._api(e,t,n)},t.prototype.get=function(e){return this._api(e)},e.PPCookies=t}(Service),function(e){function t(){}t.ERROR_ILLEGAL_APPUUID=1e4,t.ERROR_ILLEGAL_USER_EMAIL=10001,t.ERROR_IE9_OR_LOWER_BROWSER=10002,t.ERROR_SERVICE_NOT_AVALIABLE=10003,t.ERROR_ILLEGAL_USER_EMAIL_STYLE=10004,t._ERROR_INFO={1e4:"appUuid not provide, Please check your appUuid and try again",10001:"Can not find user by the user_email, please check your user_email and try again",10002:"Can not run ppMessage on IE 9 or lower version browser",10003:"Service not avaliable",10004:"Not a valid user_email"},t.prototype._getErrorDescription=function(e){for(var n in t._ERROR_INFO)if(n==e)return t._ERROR_INFO[n];return""},t.prototype._getErrorLogDescription=function(e){return"number"==typeof e?"PPMessage: [errorCode:"+e+", errorDescription:'"+this._getErrorDescription(e)+"']":e},t.prototype.warn=function(e){window.console&&window.console.warn&&console.warn(this._getErrorLogDescription(e))},t.prototype.error=function(e){window.console&&window.console.error&&console.error(this._getErrorLogDescription(e))},e.ErrorHint=t}(Service),function(e){var t=function(){function t(n){var i=$.extend({},t.DEFAULTS,n),o=function(e){return e.user_uuid?e.user_fullname&&e.user_fullname!=i.user_fullname||e.user_avatar&&e.user_avatar!=i.user_avatar:!1},r=function(e){return e.user_uuid?e.is_online!==i.is_online:!1};this.getInfo=function(){return i},this.update=function(t){if(!t.user_uuid)return this;var n=o(t),a=r(t);return i=$.extend({},i,t),n&&e.$pubsub.publish("user/infochange/"+i.user_uuid,this),a&&e.$pubsub.publish("user/infochange/state/"+i.user_uuid,this),this}}function n(e){return new t(e)}function i(e){return d[e]}function o(e,t){e&&t&&(d[e]=t)}function r(){d={}}function a(e){return e?void 0!==d[e]:!1}function s(t,r){if(a(t.user_uuid))return u(t),void(r&&r(i(t.user_uuid)));if(t.user_uuid&&t.user_fullname&&t.user_avatar){var s=n(t);return o(t.user_uuid,s),void(r&&r(s))}e.$api.getUserDetailInfo({uuid:t.user_uuid,type:"DU"},function(i){var a=$.extend({},{user_email:i.email,user_fullname:i.fullname?i.fullname:e.Constants.USER_DEFAULT_NAME,user_uuid:i.uuid,user_avatar:i.icon?e.$tools.getFileDownloadUrl(i.icon):e.Constants.ICON_DEFAULT_USER},t),s=n(a);o(t.user_uuid,s),r&&r(s)},function(e){r&&r(null)})}function c(){return d}function u(e){e&&e.user_uuid&&a(e.user_uuid)&&i(e.user_uuid).update(e)}function p(t){if(t){var n=t.uuid||t.user_uuid,i=e.$tools.icon.get(t.user_icon||t.icon||t.user_avatar),o=t.user_fullname,r=t.is_mobile_online||t.is_browser_online,a=t.is_browser_online,s=t.is_mobile_online,c=t.user_signature?t.user_signature:"";return{user_uuid:n,user_fullname:o,user_avatar:i,user_signature:c,is_online:r,is_browser_online:a,is_mobile_online:s}}}function l(e){if(e&&e.user_uuid){var t=e.user_uuid;return a(t)?i(t).update(e):(o(t,n(e)),i(t))}}var d={};return t.DEFAULTS={is_portal_user:!1,is_anonymous:!0,ppcom_trace_uuid:null,user_fullname:e.Constants.USER_DEFAULT_NAME,user_avatar:e.Constants.ICON_DEFAULT_USER,user_uuid:"",device_uuid:"",user_signature:"",is_browser_online:!1,is_mobile_online:!1,is_online:!1},{createUser:n,getUser:i,getOrCreateUser:l,asyncGetUser:s,getUsers:c,setUser:o,updateUser:u,adapter:p,clear:r,exist:a}}();e.$users=t}(Service),Service.$user=function(){function e(e){return e?Service.$users.getUser(e):void 0}function t(t){if(t){var n=e(t),i=n&&n.getInfo();return i}}var n=null;return{getUser:function(){return n?e(n):null},setUser:function(e){n=e.user_uuid,Service.$users.setUser(n,Service.$users.createUser(e))},offline:function(){if(n){var i=t(n);i&&i.device_uuid&&i.is_online&&e(n).update({user_uuid:n,is_online:!1})}},online:function(){if(n){var i=t(n);i&&i.device_uuid&&!i.is_online&&e(n).update({user_uuid:n,is_online:!0})}},clear:function(){n=null},quickId:function(){return n},quickDeviceUUID:function(){var e=t(n);return e&&e.device_uuid}}}(),function(){var e=function(){var e=null,t=null,n="pp-id",i={app_uuid:null,api_key:null,api_secret:null,user_email:null,user_name:null,user_icon:null,language:window.navigator.userLanguage||window.navigator.language,view:{launcher_bottom_margin:"20px",launcher_right_margin:"20px",launcher_is_show:!0}},o=function(t){e=$.extend({},i,t),e.api_key=Configuration.api_key,e.api_secret=Configuration.api_secret},r=function(){if(null==e)return null;if(null!=t)return t;var i=!e.user_email;return t={user_email:e.user_email,user_fullname:e.user_name,user_avatar:e.user_icon,user_uuid:null,device_uuid:null,is_portal_user:!0,is_anonymous:i,ppcom_trace_uuid:function(){if(!i)return null;var e=Service.$cookies.get(n)||function(){var e=Service.$tools.getUUID();return Service.$cookies.set(n,e,{expires:47304e4}),e}();return e}()}},a=function(e){t=$.extend(r(),e)},s=function(){return e.language},c=function(){return e.app_uuid},u=function(){return e.api_key},p=function(){return e.api_secret},l=function(){e=null,t=null};return{init:o,getUserSettings:r,updateUserSettings:a,getLanguage:s,getAppUuid:c,getApiKey:u,getApiSecret:p,clear:l}}();Service.$ppSettings=e}(),function(e){function t(){var e=!0,t=!1,n=!("undefined"==typeof console||"undefined"==typeof console.log),i=n&&!("unknown"==typeof console.log.apply||"undefined"==typeof console.log.apply),o="↓↓↓↓↓↓↓↓↓↓",r="font-size:28px; color:blue;";this.h=function(){if(n){if(e){var t="%c"+o;this.d(t,r)}return this}},this.d=function(){if(n){if(e)if(t)t=!1;else{var o=Array.prototype.slice.call(arguments);i?console.log.apply(console,o):console.log(o)}return this}},this.error=function(){if(n){if(e)if(t)t=!1;else{var o=Array.prototype.slice.call(arguments);i?console.error.apply(console,o):console.error(o)}return this}},this.close=function(e){return this},this.debug=function(t){return e=t,this}}e.$debug=new t}(Service),function(e){e.$device=function(){var t,n=window,i=n.innerWidth>0?n.innerWidth:screen.width,o=n.innerHeight>0?n.innerHeight:screen.height,r="pp-device-id",a=31536e4,s=navigator.userAgent,c=navigator.platform,u=/iPhone|iPad|iPod/i.test(s),p=/Android/i.test(s),l=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(s),d=/Windows Phone/i.test(s)||/iemobile/i.test(s)||/WPDesktop/i.test(s),f=c.toUpperCase().indexOf("MAC")>=0,h=c.toUpperCase().indexOf("WIN")>-1,g=c.toUpperCase().indexOf("LINUX")>-1,v={MAC:"MAB",LIN:"LIB",WIN:"WIB"};return this.getDeviceWidth=function(){return i},this.getDeviceHeight=function(){return o},this.inMobile=function(){var e=this.getDeviceWidth();return 736>=e},this.disableScroll=function(){$("html, body").css({overflow:"hidden",height:"100%"})},this.enableScroll=function(){$("html, body").css({overflow:"auto",height:"auto"})},this.isIOS=function(){return u},this.isAndroid=function(){return p},this.isMobileBrowser=function(){return l},this.isIE=function(){var e=s,t=e.indexOf("MSIE ");if(t>0)return parseInt(e.substring(t+5,e.indexOf(".",t)),10);var n=e.indexOf("Trident/");if(n>0){var i=e.indexOf("rv:");return parseInt(e.substring(i+3,e.indexOf(".",i)),10)}var o=e.indexOf("Edge/");return o>0?parseInt(e.substring(o+5,e.indexOf(".",o)),10):!1},this.isIE9=function(){var e=this.isIE();return e&&9==e},this.isIE9OrLowerVersionBrowser=function(){var e=this.isIE();return e&&9>=e},this.isWindowsPlatform=function(){return h},this.isMac=function(){return f},this.isFirefox=function(){return"undefined"!=typeof InstallTrigger},this.getOSType=function(){return p||g?v.LIN:u||f?v.MAC:d||h?v.WIN:v.MAC},this.getDeviceId=function(){return t?t:t=e.$cookies.get(r)||function(){var t=e.$tools.getUUID();return e.$cookies.set(r,t,{expires:a}),t}()},this.audioMp3=function(){var e=$("<audio>")[0];return!!e.canPlayType&&!!e.canPlayType("audio/mpeg;").replace(/^no$/,"")},this}()}(Service),function(e){function t(){var e=String.fromCharCode,t={People:[[e(55357,56836),"smile"],[e(55357,56835),"smiley"],[e(55357,56832),"grinning"],[e(55357,56842),"blush"],[e(55357,56841),"wink"],[e(55357,56845),"heart_eyes"],[e(55357,56856),"kissing_heart"],[e(55357,56858),"kissing_closed_eyes"],[e(55357,56860),"stuck_out_tongue_winking_eye"],[e(55357,56861),"stuck_out_tongue_closed_eyes"],[e(55357,56859),"stuck_out_tongue"],[e(55357,56883),"flushed"],[e(55357,56833),"grin"],[e(55357,56852),"pensive"],[e(55357,56844),"relieved"],[e(55357,56850),"unamused"],[e(55357,56862),"disappointed"],[e(55357,56867),"persevere"],[e(55357,56866),"cry"],[e(55357,56834),"joy"],[e(55357,56877),"sob"],[e(55357,56874),"sleepy"],[e(55357,56869),"disappointed_relieved"],[e(55357,56880),"cold_sweat"],[e(55357,56837),"sweat_smile"],[e(55357,56851),"sweat"],[e(55357,56873),"weary"],[e(55357,56875),"tired_face"],[e(55357,56872),"fearful"],[e(55357,56881),"scream"],[e(55357,56864),"angry"],[e(55357,56865),"rage"],[e(55357,56868),"triumph"],[e(55357,56854),"confounded"],[e(55357,56838),"laughing"],[e(55357,56843),"yum"],[e(55357,56887),"mask"],[e(55357,56846),"sunglasses"],[e(55357,56885),"dizzy_face"],[e(55357,56882),"astonished"],[e(55357,56447),"imp"],[e(55357,56870),"open_mouth"],[e(55357,56848),"neutral_face"],[e(55357,56853),"confused"],[e(55357,56847),"smirk"],[e(55357,56434),"man_with_gua_pi_mao"],[e(55357,56435),"man_with_turban"],[e(55357,56430),"cop"],[e(55357,56439),"construction_worker"],[e(55357,56450),"guardsman"],[e(55357,56438),"baby"],[e(55357,56422),"boy"],[e(55357,56423),"girl"],[e(55357,56424),"man"],[e(55357,56425),"woman"],[e(55357,56436),"older_man"],[e(55357,56437),"older_woman"],[e(55357,56433),"person_with_blond_hair"],[e(55357,56444),"angel"],[e(55357,56440),"princess"],[e(55357,56890),"smiley_cat"],[e(55357,56888),"smile_cat"],[e(55357,56891),"heart_eyes_cat"],[e(55357,56893),"kissing_cat"],[e(55357,56892),"smirk_cat"],[e(55357,56896),"scream_cat"],[e(55357,56895),"crying_cat_face"],[e(55357,56889),"joy_cat"],[e(55357,56894),"pouting_cat"],[e(55357,56441),"japanese_ogre"],[e(55357,56442),"japanese_goblin"],[e(55357,56904),"see_no_evil"],[e(55357,56905),"hear_no_evil"],[e(55357,56906),"speak_no_evil"],[e(55357,56448),"skull"],[e(55357,56445),"alien"],[e(55357,56489),"hankey"],[e(55357,56613),"fire"],[e(55356,57119),"star2"],[e(55357,56491),"dizzy"],[e(55357,56485),"boom"],[e(55357,56482),"anger"],[e(55357,56486),"sweat_drops"],[e(55357,56487),"droplet"],[e(55357,56484),"zzz"],[e(55357,56488),"dash"],[e(55357,56386),"ear"],[e(55357,56384),"eyes"],[e(55357,56387),"nose"],[e(55357,56389),"tongue"],[e(55357,56388),"lips"],[e(55357,56397),"thumbs_up"],[e(55357,56398),"thumbs_down"],[e(55357,56396),"ok_hand"],[e(55357,56394),"facepunch"],[e(55357,56395),"wave"],[e(55357,56400),"open_hands"],[e(55357,56390),"point_up_2"],[e(55357,56391),"point_down"],[e(55357,56392),"point_right"],[e(55357,56393),"point_left"],[e(55357,56908),"raised_hands"],[e(55357,56911),"pray"],[e(55357,56399),"clap"],[e(55357,56490),"muscle"],[e(55357,57014),"walking"],[e(55356,57283),"runner"],[e(55357,56451),"dancer"],[e(55357,56427),"couple"],[e(55357,56426),"family"],[e(55357,56463),"couplekiss"],[e(55357,56465),"couple_with_heart"],[e(55357,56431),"dancers"],[e(55357,56902),"ok_woman"],[e(55357,56901),"no_good"],[e(55357,56449),"information_desk_person"],[e(55357,56907),"raising_hand"],[e(55357,56454),"massage"],[e(55357,56455),"haircut"],[e(55357,56453),"nail_care"],[e(55357,56432),"bride_with_veil"],[e(55357,56910),"person_with_pouting_face"],[e(55357,56909),"person_frowning"],[e(55357,56903),"bow"],[e(55356,57257),"tophat"],[e(55357,56401),"crown"],[e(55357,56402),"womans_hat"],[e(55357,56415),"athletic_shoe"],[e(55357,56414),"mans_shoe"],[e(55357,56417),"sandal"],[e(55357,56416),"high_heel"],[e(55357,56418),"boot"],[e(55357,56405),"shirt"],[e(55357,56404),"necktie"],[e(55357,56410),"womans_clothes"],[e(55357,56407),"dress"],[e(55356,57277),"running_shirt_with_sash"],[e(55357,56406),"jeans"],[e(55357,56408),"kimono"],[e(55357,56409),"bikini"],[e(55357,56508),"briefcase"],[e(55357,56412),"handbag"],[e(55357,56413),"pouch"],[e(55357,56411),"purse"],[e(55357,56403),"eyeglasses"],[e(55356,57216),"ribbon"],[e(55356,57090),"closed_umbrella"],[e(55357,56452),"lipstick"],[e(55357,56475),"yellow_heart"],[e(55357,56473),"blue_heart"],[e(55357,56476),"purple_heart"],[e(55357,56474),"green_heart"],[e(55357,56468),"broken_heart"],[e(55357,56471),"heartpulse"],[e(55357,56467),"heartbeat"],[e(55357,56469),"two_hearts"],[e(55357,56470),"sparkling_heart"],[e(55357,56478),"revolving_hearts"],[e(55357,56472),"cupid"],[e(55357,56460),"love_letter"],[e(55357,56459),"kiss"],[e(55357,56461),"ring"],[e(55357,56462),"gem"],[e(55357,56420),"bust_in_silhouette"],[e(55357,56492),"speech_balloon"],[e(55357,56419),"footprints"]],Nature:[[e(55357,56374),"dog"],[e(55357,56372),"wolf"],[e(55357,56369),"cat"],[e(55357,56365),"mouse"],[e(55357,56377),"hamster"],[e(55357,56368),"rabbit"],[e(55357,56376),"frog"],[e(55357,56367),"tiger"],[e(55357,56360),"koala"],[e(55357,56379),"bear"],[e(55357,56375),"pig"],[e(55357,56381),"pig_nose"],[e(55357,56366),"cow"],[e(55357,56343),"boar"],[e(55357,56373),"monkey_face"],[e(55357,56338),"monkey"],[e(55357,56372),"horse"],[e(55357,56337),"sheep"],[e(55357,56344),"elephant"],[e(55357,56380),"panda_face"],[e(55357,56359),"penguin"],[e(55357,56358),"bird"],[e(55357,56356),"baby_chick"],[e(55357,56357),"hatched_chick"],[e(55357,56355),"hatching_chick"],[e(55357,56340),"chicken"],[e(55357,56333),"snake"],[e(55357,56354),"turtle"],[e(55357,56347),"bug"],[e(55357,56349),"bee"],[e(55357,56348),"ant"],[e(55357,56350),"beetle"],[e(55357,56332),"snail"],[e(55357,56345),"octopus"],[e(55357,56346),"shell"],[e(55357,56352),"tropical_fish"],[e(55357,56351),"fish"],[e(55357,56364),"dolphin"],[e(55357,56371),"whale"],[e(55357,56334),"racehorse"],[e(55357,56370),"dragon_face"],[e(55357,56353),"blowfish"],[e(55357,56363),"camel"],[e(55357,56361),"poodle"],[e(55357,56382),"feet"],[e(55357,56464),"bouquet"],[e(55356,57144),"cherry_blossom"],[e(55356,57143),"tulip"],[e(55356,57152),"four_leaf_clover"],[e(55356,57145),"rose"],[e(55356,57147),"sunflower"],[e(55356,57146),"hibiscus"],[e(55356,57153),"maple_leaf"],[e(55356,57155),"leaves"],[e(55356,57154),"fallen_leaf"],[e(55356,57151),"herb"],[e(55356,57150),"ear_of_rice"],[e(55356,57156),"mushroom"],[e(55356,57141),"cactus"],[e(55356,57140),"palm_tree"],[e(55356,57136),"chestnut"],[e(55356,57137),"seedling"],[e(55356,57148),"blossom"],[e(55356,57105),"new_moon"],[e(55356,57107),"first_quarter_moon"],[e(55356,57108),"moon"],[e(55356,57109),"full_moon"],[e(55356,57115),"first_quarter_moon_with_face"],[e(55356,57113),"crescent_moon"],[e(55356,57103),"earth_asia"],[e(55356,57099),"volcano"],[e(55356,57100),"milky_way"],[e(55356,57120),"stars"],[e(55356,57088),"cyclone"],[e(55356,57089),"foggy"],[e(55356,57096),"rainbow"],[e(55356,57098),"ocean"]],Objects:[[e(55356,57229),"bamboo"],[e(55357,56477),"gift_heart"],[e(55356,57230),"dolls"],[e(55356,57234),"school_satchel"],[e(55356,57235),"mortar_board"],[e(55356,57231),"flags"],[e(55356,57222),"fireworks"],[e(55356,57223),"sparkler"],[e(55356,57232),"wind_chime"],[e(55356,57233),"rice_scene"],[e(55356,57219),"jack_o_lantern"],[e(55357,56443),"ghost"],[e(55356,57221),"santa"],[e(55356,57220),"christmas_tree"],[e(55356,57217),"gift"],[e(55356,57227),"tanabata_tree"],[e(55356,57225),"tada"],[e(55356,57226),"confetti_ball"],[e(55356,57224),"balloon"],[e(55356,57228),"crossed_flags"],[e(55357,56622),"crystal_ball"],[e(55356,57253),"movie_camera"],[e(55357,56567),"camera"],[e(55357,56569),"video_camera"],[e(55357,56572),"vhs"],[e(55357,56511),"cd"],[e(55357,56512),"dvd"],[e(55357,56509),"minidisc"],[e(55357,56510),"floppy_disk"],[e(55357,56507),"computer"],[e(55357,56561),"iphone"],[e(55357,56542),"telephone_receiver"],[e(55357,56543),"pager"],[e(55357,56544),"fax"],[e(55357,56545),"satellite"],[e(55357,56570),"tv"],[e(55357,56571),"radio"],[e(55357,56586),"loud_sound"],[e(55357,56596),"bell"],[e(55357,56546),"loudspeaker"],[e(55357,56547),"mega"],[e(55357,56595),"unlock"],[e(55357,56594),"lock"],[e(55357,56591),"lock_with_ink_pen"],[e(55357,56592),"closed_lock_with_key"],[e(55357,56593),"key"],[e(55357,56590),"mag_right"],[e(55357,56481),"bulb"],[e(55357,56614),"flashlight"],[e(55357,56588),"electric_plug"],[e(55357,56587),"battery"],[e(55357,56589),"mag"],[e(55357,57024),"bath"],[e(55357,57021),"toilet"],[e(55357,56615),"wrench"],[e(55357,56617),"nut_and_bolt"],[e(55357,56616),"hammer"],[e(55357,57002),"door"],[e(55357,57004),"smoking"],[e(55357,56483),"bomb"],[e(55357,56619),"gun"],[e(55357,56618),"hocho"],[e(55357,56458),"pill"],[e(55357,56457),"syringe"],[e(55357,56496),"moneybag"],[e(55357,56500),"yen"],[e(55357,56501),"dollar"],[e(55357,56499),"credit_card"],[e(55357,56504),"money_with_wings"],[e(55357,56562),"calling"],[e(55357,56551),"e-mail"],[e(55357,56549),"inbox_tray"],[e(55357,56548),"outbox_tray"],[e(55357,56553),"envelope_with_arrow"],[e(55357,56552),"incoming_envelope"],[e(55357,56555),"mailbox"],[e(55357,56554),"mailbox_closed"],[e(55357,56558),"postbox"],[e(55357,56550),"package"],[e(55357,56541),"memo"],[e(55357,56516),"page_facing_up"],[e(55357,56515),"page_with_curl"],[e(55357,56529),"bookmark_tabs"],[e(55357,56522),"bar_chart"],[e(55357,56520),"chart_with_upwards_trend"],[e(55357,56521),"chart_with_downwards_trend"],[e(55357,56540),"scroll"],[e(55357,56523),"clipboard"],[e(55357,56517),"date"],[e(55357,56518),"calendar"],[e(55357,56519),"card_index"],[e(55357,56513),"file_folder"],[e(55357,56514),"open_file_folder"],[e(55357,56524),"pushpin"],[e(55357,56526),"paperclip"],[e(55357,56527),"straight_ruler"],[e(55357,56528),"triangular_ruler"],[e(55357,56533),"closed_book"],[e(55357,56535),"green_book"],[e(55357,56536),"blue_book"],[e(55357,56537),"orange_book"],[e(55357,56531),"notebook"],[e(55357,56532),"notebook_with_decorative_cover"],[e(55357,56530),"ledger"],[e(55357,56538),"books"],[e(55357,56534),"book"],[e(55357,56598),"bookmark"],[e(55357,56539),"name_badge"],[e(55357,56560),"newspaper"],[e(55356,57256),"art"],[e(55356,57260),"clapper"],[e(55356,57252),"microphone"],[e(55356,57255),"headphones"],[e(55356,57276),"musical_score"],[e(55356,57269),"musical_note"],[e(55356,57270),"notes"],[e(55356,57273),"musical_keyboard"],[e(55356,57275),"violin"],[e(55356,57274),"trumpet"],[e(55356,57271),"saxophone"],[e(55356,57272),"guitar"],[e(55357,56446),"space_invader"],[e(55356,57262),"video_game"],[e(55356,56527),"black_joker"],[e(55356,57268),"flower_playing_cards"],[e(55356,56324),"mahjong"],[e(55356,57266),"game_die"],[e(55356,57263),"dart"],[e(55356,57288),"football"],[e(55356,57280),"basketball"],[e(55356,57278),"tennis"],[e(55356,57265),"8ball"],[e(55356,57267),"bowling"],[e(55356,57281),"checkered_flag"],[e(55356,57286),"trophy"],[e(55356,57279),"ski"],[e(55356,57282),"snowboarder"],[e(55356,57290),"swimmer"],[e(55356,57284),"surfer"],[e(55356,57251),"fishing_pole_and_fish"],[e(55356,57205),"tea"],[e(55356,57206),"sake"],[e(55356,57210),"beer"],[e(55356,57211),"beers"],[e(55356,57208),"cocktail"],[e(55356,57209),"tropical_drink"],[e(55356,57207),"wine_glass"],[e(55356,57204),"fork_and_knife"],[e(55356,57173),"pizza"],[e(55356,57172),"hamburger"],[e(55356,57183),"fries"],[e(55356,57175),"poultry_leg"],[e(55356,57174),"meat_on_bone"],[e(55356,57181),"spaghetti"],[e(55356,57179),"curry"],[e(55356,57188),"fried_shrimp"],[e(55356,57201),"bento"],[e(55356,57187),"sushi"],[e(55356,57189),"fish_cake"],[e(55356,57177),"rice_ball"],[e(55356,57176),"rice_cracker"],[e(55356,57178),"rice"],[e(55356,57180),"ramen"],[e(55356,57202),"stew"],[e(55356,57186),"oden"],[e(55356,57185),"dango"],[e(55356,57203),"egg"],[e(55356,57182),"bread"],[e(55356,57193),"doughnut"],[e(55356,57198),"custard"],[e(55356,57190),"icecream"],[e(55356,57192),"ice_cream"],[e(55356,57191),"shaved_ice"],[e(55356,57218),"birthday"],[e(55356,57200),"cake"],[e(55356,57194),"cookie"],[e(55356,57195),"chocolate_bar"],[e(55356,57196),"candy"],[e(55356,57197),"lollipop"],[e(55356,57199),"honey_pot"],[e(55356,57166),"apple"],[e(55356,57167),"green_apple"],[e(55356,57162),"tangerine"],[e(55356,57170),"cherries"],[e(55356,57159),"grapes"],[e(55356,57161),"watermelon"],[e(55356,57171),"strawberry"],[e(55356,57169),"peach"],[e(55356,57160),"melon"],[e(55356,57164),"banana"],[e(55356,57165),"pineapple"],[e(55356,57184),"sweet_potato"],[e(55356,57158),"eggplant"],[e(55356,57157),"tomato"],[e(55356,57149),"corn"]],
Places:[[e(55356,57312),"house"],[e(55356,57313),"house_with_garden"],[e(55356,57323),"school"],[e(55356,57314),"office"],[e(55356,57315),"post_office"],[e(55356,57317),"hospital"],[e(55356,57318),"bank"],[e(55356,57322),"convenience_store"],[e(55356,57321),"love_hotel"],[e(55356,57320),"hotel"],[e(55357,56466),"wedding"],[e(55356,57324),"department_store"],[e(55356,57095),"city_sunrise"],[e(55356,57094),"city_sunset"],[e(55356,57327),"japanese_castle"],[e(55356,57328),"european_castle"],[e(55356,57325),"factory"],[e(55357,56828),"tokyo_tower"],[e(55357,56830),"japan"],[e(55357,56827),"mount_fuji"],[e(55356,57092),"sunrise_over_mountains"],[e(55356,57093),"sunrise"],[e(55356,57091),"night_with_stars"],[e(55357,56829),"statue_of_liberty"],[e(55356,57097),"bridge_at_night"],[e(55356,57248),"carousel_horse"],[e(55356,57249),"ferris_wheel"],[e(55356,57250),"roller_coaster"],[e(55357,56994),"ship"],[e(55357,56996),"speedboat"],[e(55357,56960),"rocket"],[e(55357,56506),"seat"],[e(55357,56969),"station"],[e(55357,56964),"bullettrain_side"],[e(55357,56965),"bullettrain_front"],[e(55357,56967),"metro"],[e(55357,56963),"railway_car"],[e(55357,56972),"bus"],[e(55357,56985),"blue_car"],[e(55357,56983),"car"],[e(55357,56981),"taxi"],[e(55357,56986),"truck"],[e(55357,57e3),"rotating_light"],[e(55357,56979),"police_car"],[e(55357,56978),"fire_engine"],[e(55357,56977),"ambulance"],[e(55357,57010),"bike"],[e(55357,56456),"barber"],[e(55357,56975),"busstop"],[e(55356,57259),"ticket"],[e(55357,56997),"traffic_light"],[e(55357,56999),"construction"],[e(55357,56624),"beginner"],[e(55356,57326),"izakaya_lantern"],[e(55356,57264),"slot_machine"],[e(55357,56831),"moyai"],[e(55356,57258),"circus_tent"],[e(55356,57261),"performing_arts"],[e(55357,56525),"round_pushpin"],[e(55357,57001),"triangular_flag_on_post"]],Symbols:[[e(55357,56607),"keycap_ten"],[e(55357,56610),"1234"],[e(55357,56611),"symbols"],[e(55357,56608),"capital_abcd"],[e(55357,56609),"abcd"],[e(55357,56612),"abc"],[e(55357,56636),"arrow_up_small"],[e(55357,56637),"arrow_down_small"],[e(55356,56727),"ok"],[e(55356,56725),"new"],[e(55356,56729),"up"],[e(55356,56722),"cool"],[e(55356,56723),"free"],[e(55356,56726),"ng"],[e(55357,56566),"signal_strength"],[e(55356,57254),"cinema"],[e(55356,56833),"koko"],[e(55356,56879),"u6307"],[e(55356,56883),"u7a7a"],[e(55356,56885),"u6e80"],[e(55356,56884),"u5408"],[e(55356,56882),"u7981"],[e(55356,56912),"ideograph_advantage"],[e(55356,56889),"u5272"],[e(55356,56890),"u55b6"],[e(55356,56886),"u6709"],[e(55356,56858),"u7121"],[e(55357,57019),"restroom"],[e(55357,57017),"mens"],[e(55357,57018),"womens"],[e(55357,57020),"baby_symbol"],[e(55357,57022),"wc"],[e(55357,57005),"no_smoking"],[e(55356,56888),"u7533"],[e(55356,56913),"accept"],[e(55356,56721),"cl"],[e(55356,56728),"sos"],[e(55356,56724),"id"],[e(55357,57003),"no_entry_sign"],[e(55357,56606),"underage"],[e(55357,56479),"heart_decoration"],[e(55356,56730),"vs"],[e(55357,56563),"vibration_mode"],[e(55357,56564),"mobile_phone_off"],[e(55356,56718),"ab"],[e(55357,56480),"diamond_shape_with_a_dot_inside"],[e(55357,56623),"six_pointed_star"],[e(55356,57319),"atm"],[e(55357,56505),"chart"],[e(55357,56498),"heavy_dollar_sign"],[e(55357,56497),"currency_exchange"],[e(55357,56605),"back"],[e(55357,56602),"on"],[e(55357,56601),"soon"],[e(55357,56603),"arrows_clockwise"],[e(55357,56604),"clock12"],[e(55357,56579),"clock1"],[e(55357,56667),"clock2"],[e(55357,56656),"clock3"],[e(55357,56657),"clock4"],[e(55357,56658),"clock5"],[e(55357,56659),"clock6"],[e(55357,56660),"clock7"],[e(55357,56661),"clock8"],[e(55357,56662),"clock9"],[e(55357,56663),"clock10"],[e(55357,56664),"clock11"],[e(55357,56665),"heavy_plus_sign"],[e(55357,56666),"heavy_minus_sign"],[e(55357,56494),"radio_button"],[e(55357,56495),"link"],[e(55357,56600),"curly_loop"],[e(55357,56599),"trident"],[e(55357,56625),"black_square_button"],[e(55357,56634),"white_square_button"],[e(55357,56626),"red_circle"],[e(55357,56627),"large_blue_circle"],[e(55357,56628),"small_red_triangle_down"],[e(55357,56629),"white_large_square"],[e(55357,56635),"black_large_square"],[e(55357,56630),"small_orange_diamond"],[e(55357,56631),"small_blue_diamond"]]},n=function(){var e={};return $.each(t,function(t,n){e[t]={},$.each(n,function(n,i){var o=i[1],r=i[0];e[t][o]={value:r,title:o}})}),e}(),i=function(){var e={};for(var t in n)for(key in n[t])e[n[t][key].value]=n[t][key];return e}();this.getEmojiCode=function(e,t){return n[e][t]},this.getEmojiGroup=function(e,t){var o=n[e];if(t&&"function"==typeof t)for(var r in o)if(1==t(r)){var a=n[e][r].value;delete i[a],delete o[r]}return o},this.isEmoji=function(e){if(!e||e.length>3)return!1;var t=i[e],n=!!t;return n}}e.$emoji=new t}(Service),Service.$encryption=function(){function e(e){function t(e){for(var t,n=l?"0123456789ABCDEF":"0123456789abcdef",i="",o=0;o<e.length;o++)t=e.charCodeAt(o),i+=n.charAt(t>>>4&15)+n.charAt(15&t);return i}function n(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>24-n%32&255);return t}function i(e,t){e[t>>5]|=128<<24-t%32,e[(t+64>>9<<4)+15]=t;for(var n=Array(80),i=1732584193,o=-271733879,c=-1732584194,p=271733878,l=-1009589776,d=0;d<e.length;d+=16){for(var f=i,h=o,g=c,v=p,m=l,b=0;80>b;b++){16>b?n[b]=e[d+b]:n[b]=a(n[b-3]^n[b-8]^n[b-14]^n[b-16],1);var w=u(u(a(i,5),s(b,o,c,p)),u(u(l,n[b]),r(b)));l=p,p=c,c=a(o,30),o=i,i=w}i=u(i,f),o=u(o,h),c=u(c,g),p=u(p,v),l=u(l,m)}return Array(i,o,c,p,l)}function o(e){for(var t=Array(e.length>>2),n=0;n<t.length;n++)t[n]=0;for(var n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<24-n%32;return t}function r(e){return 20>e?1518500249:40>e?1859775393:60>e?-1894007588:-899497514}function a(e,t){return e<<t|e>>>32-t}function s(e,t,n,i){return 20>e?t&n|~t&i:40>e?t^n^i:60>e?t&n|t&i|n&i:t^n^i}function c(e){return n(i(o(e),8*e.length))}function u(e,t){var n=(65535&e)+(65535&t),i=(e>>16)+(t>>16)+(n>>16);return i<<16|65535&n}function p(e){for(var t,n,i="",o=-1;++o<e.length;)t=e.charCodeAt(o),n=o+1<e.length?e.charCodeAt(o+1):0,t>=55296&&56319>=t&&n>=56320&&57343>=n&&(t=65536+((1023&t)<<10)+(1023&n),o++),127>=t?i+=String.fromCharCode(t):2047>=t?i+=String.fromCharCode(192|t>>>6&31,128|63&t):65535>=t?i+=String.fromCharCode(224|t>>>12&15,128|t>>>6&63,128|63&t):2097151>=t&&(i+=String.fromCharCode(240|t>>>18&7,128|t>>>12&63,128|t>>>6&63,128|63&t));return i}var l=0;return t(c(p(e)))}return{hex_sha1:e}}(),function(e){var t=function(){var n="file-upload-",i={},o=t.ERROR_CODE,r=function(e,t){var n=new XMLHttpRequest;return"withCredentials"in n?n.open(e,t,!0):"undefined"!=typeof XDomainRequest?(n=new XDomainRequest,n.open(e,t)):n=null,n},a=function(t){var a=e.$json,s=null,c=t.type,u=n+e.$tools.getUUID(),p=null,l=null,d=null,f={uploadId:u,state:"RUNNING",progress:0},h=function(e){var t=null;switch(c){case"file":t=a.parse(e).fuuid;break;case"txt":t=a.parse(e).fid}return{fuuid:t}};switch(i[u]=this,c){case"file":s=Configuration.file_upload_url;break;case"txt":s=Configuration.file_upload_txt_url}var g=r("post",s);switch("file"==c&&(g.upload.onprogress=function(e){if(e.lengthComputable){var t=Math.round(100*e.loaded/e.total);"RUNNING"==f.state&&(f.progress=t,d&&d(t))}}),g.onerror=function(e){l&&l(o.SERVICE_NOT_AVALIABLE)},g.onabort=function(e){l&&l(o.CANCEL)},g.onload=function(e){f.state="FINISH",f.progress=100,"txt"==c&&$("#pp-composer-container-content-txt").val(""),p&&p(h(g.responseText))},c){case"file":var v=new FormData;v.append("file",t.content),v.append("upload_type","file"),v.append("subtype","FILE"),v.append("user_uuid",e.$user.getUser().getInfo().user_uuid),g.send(v);break;case"txt":$("#pp-composer-container-content-txt").val(t.content);var m=document.forms.namedItem("pp-composer-container-form"),b=new FormData(m);g.send(b)}this.progress=function(e){return d=e,this},this.done=function(e){return p=e,this},this.fail=function(e){return l=e,this},this.cancel=function(){"CANCEL"!=f.state&&(f.state="CANCEL",g.abort())},this.query=function(){return f}};this.upload=function(e){return new a(e)},this.cancel=function(e){e&&i[e]&&i[e].cancel()},this.clear=function(){var e=this;$.each(i,function(t,n){e.cancel(t)})}};t.ERROR_CODE={SERVICE_NOT_AVALIABLE:0,CANCEL:1},e.Uploader=t,e.$uploader=new t}(Service),Service.$language=function(){function e(){return i}function t(e){switch(e&&(e=e.toLowerCase()),e){case"zh":case"zh-cn":case"zh-hk":case"zh-tw":case"zh-sg":i="zh-CN";break;case"en":case"en-us":i="en";break;default:i=n}}var n="en",i=n;return{getLanguage:e,setLanguage:t}}(),function(e){function t(){var t=this,i={get:function(n){var i=t.getFileDownloadUrl(n);return i||e.Constants.ICON_DEFAULT_USER}};this.scrollbarWidth=n(),this.getUUID=function(){var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:7&n|8).toString(16)});return t},this.isImage=function(e){var t=!1;if(e){var n=e.lastIndexOf(".");if(-1!=n&&0!=n){var i=e.substring(n+1);i&&(i=i.toLowerCase()),"jpg"!=i&&"jpeg"!=i&&"png"!=i&&"gif"!=i||(t=!0)}}return t},this.messageAdapter=function(e){return e},this.getMessageUploadId=function(e){var t="";switch(e.messageType){case"FILE":t=e.message.file.fileUploadId;break;case"IMAGE":t=e.message.image.fileUploadId}return t},this.isMessageSendError=function(e){return"ERROR"==e.messageState||"CANCELED"==e.messageState},this.isUploading=function(e){return"BEGIN_UPLOAD"==e.messageState||"SENDING"==e.messageState},this.getFileDownloadUrl=function(t,n){if(t){var i=/(^https?:\/\/)|(^w{3})/.test(t),o=i?t:Configuration.file_download_url+t;return n&&(o+="?file_name="+e.$gb2312utf8.GB2312ToUTF8(n)),o}},this.isShowEmojiIcon=function(){return e.$device.isMac()},this.getRemoteTextFileContent=function(e,t,n){var i=this.getFileDownloadUrl(e);$.get(i,function(e){t&&t(e)}).fail(function(){n&&n()})},this.getTimestamp=function(e){e.length>=19&&(e=e.substring(0,19));var t=new Date(e.replace("-","/"));return t.getTime()},this.padNumber=function(e){return 10>e?"0"+e.toString():e.toString()},this.formatTime=function(e,n){var i=new Date(e),o=i.getFullYear(),r=i.getMonth(),a=i.getUTCDate(),s=i.getHours(),c=i.getMinutes(),u=new Date,p=u.getFullYear(),l=u.getMonth(),d=u.getUTCDate(),f=n.year,h=n.month,g=n.day,v=n.today,m=n.yesterday;return o==p&&r==l&&a==d?v+" "+t.padNumber(s)+":"+t.padNumber(c):u.getTime()-i.getTime()<=864e5?m+" "+t.padNumber(s)+":"+t.padNumber(c):p>o?o+f+t.padNumber(r+1)+h+t.padNumber(a)+g+" "+t.padNumber(s)+":"+t.padNumber(c):o==p&&l>=r?t.padNumber(r+1)+h+t.padNumber(a)+g+" "+t.padNumber(s)+":"+t.padNumber(c):o+f+t.padNumber(r+1)+h+t.padNumber(a)+g+" "+t.padNumber(s)+":"+t.padNumber(c)},this.validateEmail=function(e){var t=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;return t.test(e)},this.cssNum=function(e){return parseFloat(e)},this.reverseArray=function(e){return e&&0!==e.length?e.reverse():e},this.icon=i,this.isNull=function(e){return null===e||void 0===e},this.isApiResponseEmpty=function(e){if(!e)return!0;if(0!==e.error_code)return!1;var t=$.extend({},e);return delete t.error_code,delete t.error_string,delete t.uri,$.isEmptyObject(t)},this.format=function(e){var t=[].slice.call(arguments,1),n=0;return e.replace(/%s/g,function(){return t[n++]})}}function n(){var e=$("<div>").css({visibility:"hidden",width:100,overflow:"scroll"}).appendTo("body"),t=$("<div>").css({width:"100%"}).appendTo(e).outerWidth();return e.remove(),100-t}e.PPTools=t}(Service),function(e){function t(t,n){var i=e.ErrorHint,o=function(n,i,o){t.createAnonymousUser({app_uuid:e.$ppSettings.getAppUuid(),ppcom_trace_uuid:n},i,o)},r=function(n,i,o,r){if(n.user_fullname||n.user_avatar){var a={app_uuid:e.$ppSettings.getAppUuid(),user_uuid:n.user_uuid,user_fullname:n.user_fullname,user_icon:n.user_avatar,user_email:n.user_email};t.updateUser(a,o,r)}else e.$ppSettings.updateUserSettings({user_fullname:i.user_fullname,user_avatar:i.user_avatar}),o&&o()},a=function(n,i,o){t.createDevice({app_uuid:e.$ppSettings.getAppUuid(),user_uuid:n.user_uuid,device_ostype:e.$device.getOSType(),ppcom_trace_uuid:n.ppcom_trace_uuid,device_id:e.$device.getDeviceId()},function(n){t.updateDevice({device_uuid:n.device_uuid,device_ostype:e.$device.getOSType()}),e.$ppSettings.updateUserSettings({device_uuid:n.device_uuid}),i(n)},function(t){var n=25;return t&&t.error_code&&t.error_code==n?(e.$ppSettings.updateUserSettings({device_uuid:t.device_uuid}),void i(t)):void(o&&o(t))})},s=function(t,n,i){return function(){e.$user.setUser(t),View.Style.init(),$(document.body).append((new View.PPContainer).getElement()),e.$messageReceiverModule.start({user_uuid:t.user_uuid,device_uuid:t.device_uuid,app_uuid:e.$ppSettings.getAppUuid()}),setTimeout(function(){n&&n()})}},c=function(t,n,i){var c=t.ppcom_trace_uuid;o(c,function(o){e.$ppSettings.updateUserSettings({user_uuid:o.user_uuid}),r(t,{user_fullname:o.user_fullname,user_avatar:null},null,null),a(t,s(t,n,i),null)},i)},u=function(n,i,o){return e.$tools.validateEmail(n.user_email)?void t.getUserUuid({app_uuid:e.$ppSettings.getAppUuid(),user_icon:n.user_avatar,user_email:n.user_email,user_fullname:n.user_fullname},function(c){t.getUserDetailInfo({uuid:c.user_uuid,type:"DU"},function(t){e.$ppSettings.updateUserSettings({user_uuid:t.uuid}),r(n,{user_fullname:t.fullname,user_avatar:t.icon},null,null),a(n,s(n,i,o),null)},function(e){})},function(){o&&o(e.ErrorHint.ERROR_ILLEGAL_USER_EMAIL)}):void(o&&o(e.ErrorHint.ERROR_ILLEGAL_USER_EMAIL_STYLE))};this.startUp=function(t,n,o){if(e.$device.isIE9OrLowerVersionBrowser())return void(o&&o(i.ERROR_IE9_OR_LOWER_BROWSER));var r={};$.extend(!0,r,t),e.$ppSettings.init(r),View.$settings.init(r),e.$ppSettings.getAppUuid()?(e.$api.init(e.$ppSettings.getAppUuid(),e.$ppSettings.getApiKey(),e.$ppSettings.getApiSecret()),e.$language.setLanguage(e.$ppSettings.getLanguage()),e.$api.getPPComToken(function(t){e.$api.getAppInfo({app_uuid:e.$ppSettings.getAppUuid()},function(t){e.$app.set(t);var i=e.$ppSettings.getUserSettings();i.is_anonymous?c(i,n,o):u(i,n,o)},function(e){o&&o(i.ERROR_SERVICE_NOT_AVALIABLE)})},function(e){o&&o(i.ERROR_SERVICE_NOT_AVALIABLE)})):o&&o(i.ERROR_ILLEGAL_APPUUID)}}t.bootServices=function(t){e.bootMe(t),View.bootMe(t)},e.PPStartUp=t}(Service),function(e){function t(){this._booted=!1,this._onShowEvent=null,this._onHideEvent=null}t.prototype._clearData=function(){e.$uploader.clear(),e.$notification.reset(),Ctrl.$conversationPanel.stopPollingWaitingQueueLength()},t.prototype.boot=function(t,n){if(t&&!this._booted){this._booted=!0;var i=this;e.$startUp.startUp(t,function(){i._booted=!0,$.isFunction(n)&&n(!0)},function(t){i._booted=!1,i._clearData(),e.$errorHint.warn(t),$.isFunction(n)&&n(!1,t)})}},t.prototype.show=function(){if(this._booted){var e=Ctrl.$launcher.get();e&&(e.onClickEvent(),this._onShowEvent&&"function"==typeof this._onShowEvent&&this._onShowEvent())}},t.prototype.hide=function(){if(this._booted){var e=Ctrl.$sheetheader;e&&(e.minimize(),this._onHideEvent&&"function"==typeof this._onHideEvent&&this._onHideEvent())}},t.prototype.onShow=function(e){this._onShowEvent=e},t.prototype.onHide=function(e){this._onHideEvent=e},t.prototype.shutdown=function(){this._booted&&($("#pp-container").remove(),this._booted=!1,this._clearData())},t.prototype.update=function(t){if(!this._booted)return!1;var n=t,i=e.$api,o=e.$user.getUser();return!n||!o||n.app_uuid!=i.getAppUuid()||n.user_email!=o.getInfo().user_email},e.PublicAPI=t}(Service),function(e){function t(){}t.reposity={},t.clear=function(){t.reposity={}},t.prototype.get=function(e){return t.reposity[e]},t.prototype.set=function(e,n){t.reposity[e]=n},t.prototype.remove=function(e){delete t.reposity[e]},e.BaseStorage=t}(Service),function(e){var t=function(){function e(e){return n.parseJSON(e)}function t(e){return JSON.stringify(e)}var n=$;return{parse:e,stringify:t}}();e.$json=t}(Service),function(e){function t(e,t){if(!e){if(t=t||"Assertion failed","undefined"!=typeof Error)throw new Error(t);throw t}}e.assert=t}(fn),Service.$schedule=function(){function e(e,t){var i,r,a,s=e,c=t,u=!1,p=!1;this.after=function(e,t){return i=e,a=t||n,this},this.onCancel=function(e){return r=e,this},this.cancel=function(){u=!0,void 0!==r&&r()},this.finished=function(){return p},this.start=function(){void 0!==o[c]&&$clearTimeout(o[c].timer),$.isFunction(s)&&s();var e=$.isFunction(i)&&$timeout(function(){!u&&i(),p=!0,o[c]=void 0},a);o[c]={task:this,timer:e}}}function t(e,t,n){var o=t,a=n||i;$.isFunction(e)&&o&&void 0===r[o]&&(r[o]={event:e},e(),$timeout(function(){r[o]=void 0},a))}var n=2e3,i=2e3,o=[],r=[];return{schedule:function(t,n){return new e(t,n)},cancelAll:function(){$.each(o,function(e,t){t.finished()||t.cancel()})},cancel:function(e){var t=$.inArray(e,o);-1!==t&&(e&&$clearTimeout(o[e].timer),o[e]=void 0)},once:function(e,n,i){t(e,n,i)}}}(),Service.$task=function(){function e(e,t,n){o[e]=$timeout(t,n||a)}function t(e){o[e]&&($clearTimeout(o[e].timer),o[e]=void 0)}function n(e,t,n){r[e]=setInterval(t,n||a)}function i(e){r[e]&&(clearInterval(r[e]),r[e]=void 0)}var o=[],r=[],a=1e3;return{plan:e,cancel:t,repeat:n,cancelRepeat:i}}(),Service.KEYS={APP_INFO:"app_info"},Service.$monitor=function(){function e(e,t){Service.$pubsub.publish(e,t)}function t(e,t){Service.$pubsub.subscribe(e,t)}var n="Monitor/",i={show:n+"S",hide:n+"H",resume:n+"R",watch:n+"W",unwatch:n+"UW",typing:n+"T"};return{Event:i,report:e,watch:t}}();var __Monitor=Service.$monitor,__MonitorEvent=__Monitor.Event;return function(){Service.$gb2312utf8={Dig2Dec:function(s){var retV=0;if(4==s.length){for(var i=0;4>i;i++)retV+=eval(s.charAt(i))*Math.pow(2,3-i);return retV}return-1},Hex2Utf8:function(s){var retS="",tempS="",ss="";if(16==s.length){tempS="1110"+s.substring(0,4),tempS+="10"+s.substring(4,10),tempS+="10"+s.substring(10,16);for(var sss="0123456789ABCDEF",i=0;3>i;i++)retS+="%",ss=tempS.substring(8*i,8*(eval(i)+1)),retS+=sss.charAt(this.Dig2Dec(ss.substring(0,4))),retS+=sss.charAt(this.Dig2Dec(ss.substring(4,8)));return retS}return""},Dec2Dig:function(e){for(var t="",n=0,i=0;4>i;i++)n=Math.pow(2,3-i),e>=n?(t+="1",e-=n):t+="0";return t},Str2Hex:function(s){for(var c="",n,ss="0123456789ABCDEF",digS="",i=0;i<s.length;i++)c=s.charAt(i),n=ss.indexOf(c),digS+=this.Dec2Dig(eval(n));return digS},GB2312ToUTF8:function(e){var t=escape(e),n=t.split("%"),i="";""!=n[0]&&(i=n[0]);for(var o=1;o<n.length;o++)"u"==n[o].substring(0,1)?(i+=this.Hex2Utf8(this.Str2Hex(n[o].substring(1,5))),n[o].length&&(i+=n[o].substring(5))):(i+=unescape("%"+n[o]),n[o].length&&(i+=n[o].substring(5)));return i}}}(),function(e){!function(e){var t={},n=-1;e.publish=function(e,n){if(!t[e])return!1;for(var i=t[e],o=i?i.length:0;o--;)i[o].func(e,n);return this},e.subscribe=function(e,i){t[e]||(t[e]=[]);var o=(++n).toString();return t[e].push({token:o,func:i}),o},e.unsubscribe=function(e){for(var n in t)if(t[n])for(var i=0,o=t[n].length;o>i;i++)if(t[n][i].token===e)return t[n].splice(i,1),e;return this},e.clear=function(){t={},n=-1}}(e.$pubsub||(e.$pubsub={}))}(Service),Service.$polling=function(){function e(e){var t=$.extend(s,e);t.eventID&&t.apiFunc&&(c[t.eventID]||(c[t.eventID]={handler:void 0},i(t)))}function t(e){e&&e.eventID&&(n(e)||(c[e.eventID].handler&&$clearTimeout(c[e.eventID].handler),c[e.eventID]=void 0))}function n(e){return void 0===c[e.eventID]}function i(e){e.apiFunc.call(Service.$api,e.apiRequestParams,function(t){n(e)||(o(e,t,!0),r(e))},function(t){n(e)||(o(e,t,!1),r(e))})}function o(e,t,n){e.onGet&&e.onGet(t,n)}function r(e){c[e.eventID].handler=$timeout(function(){n(e)||i(e)},e.delay)}var a=3e3,s={eventID:void 0,apiFunc:void 0,apiRequestParams:void 0,delay:a,onGet:void 0},c={};return{run:e,cancel:t}}(),Service.$app=function(){var e,t={GROUP:"GROUP",ALL:"ALL",SMART:"SMART"},n=t.ALL,i=function(t){e=t},o=function(){return e};return{POLICY:t,set:i,policy:function(){return o()&&o().app_route_policy||n},app:o,appName:function(){return o().app_name},appId:function(){return o().app_uuid||o().uuid}}}(),Service.$orgGroups=function(){function e(e){return Service.$app.policy()!==Service.$app.POLICY.GROUP?void $onResult([],e):void 0!==i?void $onResult(i,e):void Service.$api.getAppOrgGroupList({app_uuid:Service.$ppSettings.getAppUuid()},function(n){i=n.list,t(i),$onResult(i,e)},function(t){i=[],$onResult(i,e)})}function t(e){e&&$.each(e,function(e,t){o[t.group_uuid]=t})}function n(e,t){return e&&t?void(o[e]=t):o[e]&&o[e].conversation_uuid}var i,o={};return{asyncGetAppOrgGroupList:e,conversationId:n}}(),Service.$hovercardWelcome=function(){function e(e){if(e)switch(e=e.toLowerCase()){case"zh-cn":return"zh_cn";case"en":return"en_us"}return"en"}function t(e,t,n){return{appTeamName:e,appWelcomeText:t,activeAdmins:function(){var e=[];return n&&$.each(n,function(t,n){var i=n.uuid,o=n.user_fullname,r=Service.$tools.icon.get(n.user_icon),a=n.is_browser_online,s=n.is_mobile_online,c=n.is_mobile_online||n.is_browser_online;Service.$users.exist(i)?Service.$users.getUser(i).update({user_fullname:o,user_avatar:r,is_online:c}):Service.$users.setUser(i,Service.$users.createUser({is_portal_user:!1,user_uuid:i,user_fullname:o,user_avatar:r,is_browser_online:a,is_mobile_online:s,is_online:c})),e.push(Service.$users.getUser(i).getInfo())}),e}()}}function n(n){return void 0!==o?void $onResult(o,n):void Service.$api.getWelcomeTeam({language:e(Service.$language.getLanguage())},function(e){o=t(e.team,e.welcome,e.list),r=e.welcome,$onResult(o,n)},function(e){$onResult(null,n)})}function i(){return r}var o,r;return{asyncGet:n,getWelcomeText:i}}(),Service.$orgGroupUsers=function(){function e(e,n){return e?t[e]?void $onResult(t[e],n):void Service.$api.getOrgGroupUserList({app_uuid:Service.$ppSettings.getAppUuid(),group_uuid:e},function(i){t[e]=[],0===i.error_code&&i.list&&$.each(i.list,function(n,i){var o=Service.$users.adapter(i);t[e].push(Service.$users.getOrCreateUser(o).getInfo())}),$onResult(t[e],n)},function(e){$onResult([],n)}):void $onResult([],n)}var t={};return{asyncGet:e}}(),Service.$conversation=function(){function e(e,o,r){function a(e){return r&&r.include?e:n(e)}return r&&r.reuse&&void 0!==i[e]?void $onResult(t(a(i[e])),o):(i[e]=void 0,void Service.$api.getConversationUserList({app_uuid:Service.$ppSettings.getAppUuid(),conversation_uuid:e},function(n){n&&0===n.error_code?i[e]=function(){var e=[];return n.list&&$.each(n.list,function(t,n){var i=Service.$users.adapter(n);e.push(Service.$users.getOrCreateUser(i).getInfo())}),e}():i[e]=[],$onResult(t(a(i[e])),o)},function(n){i[e]=[],$onResult(t(a(i[e])),o)}))}function t(e){return e}function n(e){if(!e)return e;var t,n=e.slice();return $.each(n,function(e,n){n.user_uuid===Service.$user.quickId()&&(t=e)}),void 0!==t&&n.splice(t,1),n}var i={};return{asyncGetUser:e}}(),Service.$messageStore=function(){function e(e,t){n[e]=t}function t(e){if(e){var t,i=n[e];if(i){var o=Modal.$conversationContentGroup.get(i);o&&(t=o.find(e))}return t}}var n={};return{map:e,find:t}}(),Service.$conversationManager=function(){function e(){var e=Service.$pubsub;e.subscribe(Service.$notifyConversation.EVENT.AVALIABLE,function(t,n){Service.$conversationAgency.requestInfo(n,function(t){if(t){var n=!Service.$conversationAgency.isDefaultConversationAvaliable();n?o(t):g(p(t)),e.publish(w.AVALIABLE,t)}})})}function t(){return h(x)}function n(){Service.$conversationAgency.enableDebug(!1),Service.$conversationAgency.request(function(e){o(e),Service.$pubsub.publish(w.AVALIABLE,e)})}function i(e){return f()?void $onResult(f(),e):void Service.$conversationAgency.request(function(t){t?o(t):v(),$onResult(f(),e)})}function o(e){g(p(e,!0)),c(e.token)}function r(e){if(void 0!==e)c(e);else if(void 0!==m)return d(m)}function a(e){return S?void $onResult(h(x),e):void Service.$orgGroups.asyncGetAppOrgGroupList(function(t){var n=(t||[]).slice();n&&$.each(n,function(e,t){t.user_count>0&&g(l(t))}),Service.$api.getConversationList({user_uuid:Service.$user.getUser().getInfo().user_uuid,app_uuid:Service.$ppSettings.getAppUuid()},function(t){if(t&&0===t.error_code){var n=(t.list||[]).slice();n&&$.each(n,function(e,t){g(p(t))})}S=!0,$onResult(h(x),e)},function(t){S=!0,$onResult(h(x),e)})})}function s(e,t){function n(e){var t;return $.each(x,function(n,i){i.assigned_uuid===e&&(t=i)}),t}function i(e){var t;return $.each(x,function(n,i){i.type===b.GROUP&&i.uuid===e&&(t=i.conversation_uuid)}),t&&d(t)}if(void 0!==e.user_uuid&&void 0!==e.group_uuid)throw new Error;var o=void 0!==e.user_uuid?n(e.user_uuid):void 0!=e.group_uuid?i(e.group_uuid):void 0;return Service.$tools.isNull(o)?void Service.$conversationAgency.create(e,function(e){e?(g(p(e)),$onResult(d(e.uuid),t)):($onResult(void 0,t),v())}):void $onResult(o,t)}function c(e){var t=d(e);void 0!==t&&($.each(x,function(e,t){t.active=!1}),t.ts=Date.now(),t.active=!0,m=e),u(e)}function u(e){var t,n,i=f();void 0!==i&&(t=i.app_welcome,n=i.app_name,i.vip=!1,delete i.app_welcome,delete i.app_name);var o=d(e);o&&(o.vip=!0,t&&(o.app_welcome=t),n&&(o.app_name=n))}function p(e,t){return e.type=b.CONVERSATION,e.token=e.uuid,e.ts=Service.$tools.getTimestamp(e.updatetime),e.vip="boolean"==typeof t?t:!1,e}function l(e){return e.type=b.GROUP,e.token=e.uuid,e.ts=Service.$tools.getTimestamp(e.updatetime),e}function d(e){var t,n=x.length;for(t=0;n>t;++t)if(e===x[t].token)return x[t]}function f(){var e,t=x.length;for(e=0;t>e;++e)if(x[e].vip)return x[e]}function h(e){function t(e,t){var i=n(e),o=n(t);if(i>o)return-1;if(o>i)return 1;var r=e.ts,a=t.ts;return a-r}function n(e){return e.type===b.GROUP?_:0}return!e||e.length<=1?e:e.sort(t)}function g(e){var t;$.each(x,function(n,i){void 0===t&&i.token===e.token&&(t=i)}),void 0===t?x.push(e):(e.vip=t.vip,$.extend(t,e))}function v(){Service.$pubsub.publish(w.WAITING)}var m,b={GROUP:"GROUP",CONVERSATION:"CONVERSATION"},w={WAITING:"CONVERSATION_MANAGER/WAITING",AVALIABLE:"CONVERSATION_MANAGER/AVALIABLE"},_=1e4,x=[],S=!1;return{TYPE:b,EVENT:w,init:e,all:t,simulateConversationAvaliable:n,asyncGetDefaultConversation:i,activeConversation:r,vipConversation:f,asyncGetList:a,find:d,asyncGetConversation:s}}(),Service.$sheetHeader=function(){function e(e){e=e||p}function t(){return l||p}function n(e){return l?void $onResult(l,e):(l=Service.$app.appName()||p,void $onResult(l,e))}function i(e){d=e}function o(){return d}function r(){f++}function a(){return f}function s(e){f=0>f-e?0:f-e}function c(){return h}function u(e){h=e}var p=Service.Constants.DEFAULT_HEADER_TITLE,l="",d=!0,f=0,h=!1;return{setHeaderTitle:e,getHeaderTitle:t,asyncGetHeaderTitle:n,close:i,closed:o,incrUnreadCount:r,unreadCount:a,decrUnreadCount:s,isShowDropDownButton:c,showDropDownButton:u}}(),Service.$audioContext=function(){function e(e){return void 0!==r&&void 0!==a&&r.id()===e.id()}function t(e){if(void 0!==r&&void 0!==e){if(r.id()===e.id())return;n(r)}return e.canPlay()&&Service.$device.audioMp3()?(r=e,a=new Audio(e.src()),a.onended=function(t){n(e)},a.onerror=function(t){i(e)},a.play(),void Service.$pubsub.publish("audio/"+r.id(),{state:s.PLAYING,audioId:r.id()})):void i(e)}function n(t){e(t)&&(a.currentTime=0,a.pause(),Service.$pubsub.publish("audio/"+t.id(),{state:s.NULL,audioId:t.id()}),a=void 0,r=void 0)}function i(t){e(t)&&(a=void 0,r=void 0),Service.$pubsub.publish("audio/"+t.id(),{state:s.ERROR,audioId:t.id()})}function o(){n(r)}var r,a,s={NULL:0,PLAYING:1,ERROR:2};return{STATE:s,isPlaying:e,play:t,stop:n,close:o}}(),Service.$conversationAgency=function(){function e(e){return l===p.DONE&&c?void $onResult(c,e):(l=p.REQUESTING,void Service.$api.getPPComDefaultConversation({app_uuid:Service.$app.appId(),user_uuid:Service.$user.quickId(),device_uuid:Service.$user.quickDeviceUUID()},function(t){a(t)||(c=t,l=p.DONE),$onResult(c,e)},function(t){$onResult(c,e)}))}function t(e,t){return e?void Service.$api.getConversationInfo({app_uuid:Service.$app.appId(),user_uuid:Service.$user.quickId(),conversation_uuid:e},function(e){$onResult(e,t)},function(e){$onResult(void 0,t)}):void $onResult(void 0,t)}function n(e,t){if(void 0!==e.user_uuid&&void 0!==e.group_uuid)throw new Error;l=p.REQUESTING,u=e.group_uuid,Service.$api.createPPComConversation({device_uuid:Service.$user.quickDeviceUUID(),user_uuid:Service.$user.getUser().getInfo().user_uuid,app_uuid:Service.$ppSettings.getAppUuid(),conversation_type:Service.Constants.MESSAGE.TO_TYPE,group_uuid:void 0!==e.group_uuid?e.group_uuid:void 0,member_list:void 0!==e.user_uuid?[e.user_uuid]:void 0},function(e){var n=void 0;a(e)||(n=e,l=p.DONE,u=void 0),$onResult(n,t)},function(e){$onResult(void 0,t)})}function i(){function e(e){l=p.CANCEL,u=void 0}l===p.REQUESTING&&Service.$api.cancelWaitingCreateConversation({app_uuid:Service.$app.appId(),user_uuid:Service.$user.quickId(),device_uuid:Service.$user.quickDeviceUUID(),group_uuid:u},e,e)}function o(){return void 0!==c}function r(){return void 0!==u}function a(e){return d||0!==e.error_code||Service.$tools.isApiResponseEmpty(e)}function s(e){d=e}var c,u,p={REQUESTING:0,DONE:1,CANCEL:2},l=p.REQUESTING,d=!1;return{enableDebug:s,request:e,requestInfo:t,create:n,cancel:i,isDefaultConversationAvaliable:o,isRequestingGroupConversation:r}}(),function(e){function t(t){var n=e.$json,i=e.$tools,o=e.$emoji,r=(e.$users,e.$user),a=e.Constants.MESSAGE_SUBTYPE,s=e.PPMessage.TYPE,c=t,u=function(e){var t="",n=e;switch(n.ms){case a.TEXT:t=i.isShowEmojiIcon()&&o.isEmoji(n.bo)?s.EMOJI:s.TEXT;break;case a.TXT:t=s.TEXT;break;case a.IMAGE:t=s.IMAGE;break;case a.FILE:t=s.FILE;break;case a.AUDIO:t=s.AUDIO}return t},p=function(e){return e.fi!=r.getUser().getInfo().user_uuid||"S2P"==e.tt},l=function(t){return t.ft===e.ApiMessage.TYPE_OG||t.ft===e.ApiMessage.TYPE_AP},d=function(t,n,o){var r=function(){o&&o(t.build(),n)};if(p(c))if(l(c))t.userName(e.Constants.i18n("SYSTEM_MSG")).userIcon(e.Constants.ICON_DEFAULT_USER),r();else{var a={user_uuid:c.fi,user_fullname:c.from_user&&c.from_user.user_fullname?c.from_user.user_fullname:void 0,user_avatar:c.from_user&&c.from_user.user_icon?i.getFileDownloadUrl(c.from_user.user_icon):void 0};e.$users.asyncGetUser(a,function(n){null!=n?t.userName(n.getInfo().user_fullname).userIcon(n.getInfo().user_avatar):t.userName(e.Constants.i18n("DEFAULT_SERVE_NAME")).userIcon(e.Constants.ICON_DEFAULT_USER),r()})}else r()},f=function(e,t){var r=!0;switch(c.ms){case a.TEXT:i.isShowEmojiIcon()&&o.isEmoji(c.bo)?e.emojiMessageCode(c.bo):e.textMessageBody(c.bo);break;case a.TXT:return void i.getRemoteTextFileContent(n.parse(c.bo).fid,function(n){e.textMessageBody(n),t&&t(r)},function(){r=!1,t&&t(r)});case a.IMAGE:e.imageMessageUrl(i.getFileDownloadUrl(n.parse(c.bo).orig));break;case a.FILE:var s=n.parse(c.bo).name,u=n.parse(c.bo).fid,p=i.getFileDownloadUrl(u,s),l=p;e.fileMessageLocalUrl(p).fileMessageName(s).fileMessageServerUrl(l);break;case a.AUDIO:e.audio(n.parse(c.bo));break;default:r=!1}t&&t(r)};this.asyncGetPPMessage=function(t){var n=new e.PPMessage.Builder(u(c)).id(c.id).timestamp(c.ts).messageState("FINISH").conversationId(c.ci).conversation({uuid:c.ci}).rawData(c).userId(c.fi).admin(p(c));f(n,function(e){d(n,e,t)})}}e.ApiMessageAdapter=t}(Service),function(e){function t(e){var t=e;this.getBody=function(){return t}}function n(n){var i={conversation_uuid:n,to_uuid:"",to_type:"",conversation_type:e.Constants.MESSAGE.TO_TYPE,message_type:e.Constants.MESSAGE_TYPE.NOTI,message_subtype:"",from_uuid:"",device_uuid:"",uuid:"",from_type:"DU",app_uuid:e.$ppSettings.getAppUuid()};this.uuid=function(e){return i.uuid=e,this},this.type=function(e){return i.message_subtype=e,this},this.toType=function(e){return i.to_type=e,this},this.toId=function(e){return i.to_uuid=e,this},this.fromUuid=function(e){return i.from_uuid=e,this},this.deviceUuid=function(e){return i.device_uuid=e,this},this.build=function(){var e=$.extend({},i,!0);if(!e.to_uuid)throw new Error("to_uuid == null");if(!e.to_type)throw new Error("to_type == null");return new t(e)}}t.TYPE_OG="OG",t.TYPE_AP="AP",t.Builder=n,e.ApiMessage=t}(Service),Service.$messageSender=function(){function e(e,i){var o=$.extend({},g,i),a=e.getBody();t(a,o,a.conversation.uuid),o.upload?n(a,o):r(a,o);
}function t(e,t,n){e.messageConversationId=n,e.messageIsConversationValid=!!n,l(e,h.BUILD_DONE,{conversationId:n})}function n(e,t){var n=Service.$uploader,r=Service.Uploader.ERROR_CODE,a=t.uploadContent,s=t.uploadType,c=Service.Constants.i18n,u=n.upload({type:s,content:a}).progress(function(t){l(e,h.UPLOADING,{uploadProgress:t})}).done(function(n){o(e,t,n.fuuid)}).fail(function(n){switch(e.messageState="ERROR",n){case r.SERVICE_NOT_AVALIABLE:e.extra.errorDescription=c("SERVICE_NOT_AVALIABLE");break;case r.CANCEL:e.extra.errorDescription=c("CANCELED")}i(e,t)}).query().uploadId;l(e,h.BEGIN_UPLOAD,{uploadTaskId:u})}function i(e,t){l(e,h.UPLOAD_FAIL),r(e,t)}function o(e,t,n){l(e,h.UPLOAD_DONE,{fileId:n}),r(e,t)}function r(e,t){if(!e.messageIsConversationValid||"ERROR"===e.messageState)return void c(e,t);var n=new Service.PPMessageAdapter(e).getApiMessageBody();try{Service.$notifyMsg.get(Service.$notification,n).send()}catch(i){Service.$api.sendMessage(n,function(n){a(e,t,n)},function(n){c(e,t)})}}function a(e,t,n){e.messageState="FINISH",n&&s(e,n),l(e,h.SEND_DONE)}function s(e,t){}function c(e,t){e.messageState="ERROR";var n=e.extra.errorDescription;n||(n=Service.Constants.i18n("SEND_ERROR")),e.extra.errorDescription=n,l(e,h.SEND_FAIL)}function u(e){var t=Service.$messageStore.find(e);t&&a(t)}function p(e){var t=Service.$messageStore.find(e);t&&c(t)}function l(e,t,n){f.broadcast(e.messageId,{body:e,state:t,stateInfo:n||{}})}function d(){function e(e,t){Service.$pubsub.publish("msg/send/"+e,t)}var t={BUILD_DONE:"BUILD_DONE",BEGIN_UPLOAD:"BEGIN_UPLOAD",UPLOADING:"UPLOADING",UPLOAD_DONE:"UPLOAD_DONE",UPLOAD_FAIL:"UPLOAD_FAIL",SEND_DONE:"SEND_DONE",SEND_FAIL:"SEND_FAIL"};return{STATE:t,broadcast:e}}var f=d(),h=f.STATE,g={upload:!1,uploadType:"file",uploadContent:null};return{$messageStateBroadcast:f,send:e,notifySendDone:u,notifySendFail:p}}(),Service.$messageReceiverModule=function(){function e(){function e(){if(!g){var e;(e="hidden")in document?document.addEventListener("visibilitychange",n):(e="mozHidden")in document?document.addEventListener("mozvisibilitychange",n):(e="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",n):(e="msHidden")in document&&document.addEventListener("msvisibilitychange",n),g=void 0!==e,p=e,l=document.title}}function t(){g&&("hidden"===p?document.removeEventListener("visibilitychange",n):"mozHidden"===p?document.removeEventListener("mozvisibilitychange",n):"webkitHidden"===p?document.removeEventListener("webkitvisibilitychange",n):"msHidden"===p&&document.removeEventListener("msvisibilitychange",n)),g=!1,p=void 0,s()}function n(e){h=document[p],h||s()}function i(e){o()&&(u(),f=r(e),c())}function o(){return g&&void 0!==p&&!Service.$device.isMobileBrowser()&&h}function r(e){return Service.Constants.i18n("PPMESSAGE")+": "+e.getMessageSummary()+"... "}function a(e){e&&(document.title=e)}function s(){u(),l&&a(l)}function c(){var e=f,t=e.substring(v,e.length)+e.substring(0,v);v++,a(t),v>e.length&&(v=0),d=$timeout(c,200)}function u(){d&&($clearTimeout(d),d=void 0),f=void 0,v=0}var p,l,d,f,h=!1,g=!1,v=0;return{register:e,unregister:t,notify:i}}var t,n=function(e){return e&&View.$conversationContentContainer.visible()&&!Ctrl.$launcher.get().isLauncherShow()&&Service.$conversationManager.activeConversation()&&Service.$conversationManager.activeConversation().uuid===e},i=function(e){return Modal.$conversationContentGroup.get(e)},o=function(e,o){var r=Service.$pubsub,a=o.getBody(),s=a.conversation.uuid;if(t&&t.notify(o),n(s))r.publish("msgArrived/chat",o);else{var c=i(s);c.addMessage(a),c.incrUnreadCount(),Ctrl.$sheetheader.incrUnread(),Ctrl.$launcher.get().isLauncherShow()?r.publish("msgArrived/launcher",o):View.$groupContent.visible()&&r.publish("msgArrived/group",o)}},r=function(n){n&&(Service.$notification.init({user_uuid:n.user_uuid,device_uuid:n.device_uuid,app_uuid:n.app_uuid}).start(),t&&t.unregister(),t=e(),t.register(),Service.$pubsub.subscribe("ws/msg",o))};return{start:r}}(),function(e){var t=function(){function t(e){return unescape(encodeURIComponent(e))}function n(n){return t(n).length>e.Constants.MESSAGE.TEXT_MAX_LEN}function i(e){return n(e.message.text.body)}function o(t){if(!t||!t.messageType)return!1;var n=e.PPMessage.TYPE;return-1!==$.inArray(t.messageType.toUpperCase(),[n.TEXT,n.EMOJI,n.IMAGE,n.FILE,n.AUDIO])}function r(){if(!a)switch(e.$app.policy()){case e.$app.POLICY.ALL:a=e.PPMessage.TO_TYPE.AP;break;case e.$app.POLICY.GROUP:a=e.PPMessage.TO_TYPE.OG;break;default:a=e.PPMessage.TO_TYPE.AP}return a}var a;return{isTextLengthLargerThan128:n,isMessageTextOverflow:i,isMessage:o,toType:r}}();e.$messageToolsModule=t}(Service),function(e){function t(n){var i=n;this.setConversationId=function(e){return i.messageConversationId=e,this},this.setConversationIdValid=function(e){return i.messageIsConversationValid=e,this},this.setMessageState=function(e){return i.messageState=e,this},this.setRawData=function(e){return i.messageRawData=e,this},this.isConversationValid=function(){return i.messageIsConversationValid},this.getBody=function(){return i},this.getMessageState=function(){return i.messageState},this.getMessageSummary=function(){return t.getMessageSummary(i)},this.send=function(){var t=e.$sendSettingsFactory.get(i);e.$msgStateReceiverFactory.get(i.messageType).listen(i.messageId),e.$messageSender.send(this,t)}}function n(n){var i={messageId:e.$tools.getUUID(),messageTimestamp:Date.now()/1e3,messageType:n,messageToType:e.$messageToolsModule.toType(),messageState:"SENDING",messageConversationId:"",messageIsConversationValid:!0,messageRawData:"",extra:{errorDescription:"",description:""},message:{text:{},file:{},image:{},welcome:{},emoji:{},audio:{},timestamp:{time:Date.now()}},user:{id:null,admin:!1,name:"",avatar:e.Constants.ICON_DEFAULT_USER},conversation:void 0};this.id=function(e){return i.messageId=e,this},this.timestamp=function(e){return i.messageTimestamp=e,this},this.toType=function(e){return i.messageToType=e,this},this.conversationId=function(e){return i.messageConversationId=e,this},this.conversationIsValid=function(e){return i.messageIsConversationValid=e,this},this.rawData=function(e){return i.messageRawData=e,this},this.messageState=function(e){return i.messageState=e,this},this.extraDescription=function(e){return i.extra.description=e,this},this.conversation=function(e){return i.conversation=e,this},this.admin=function(e){return i.user.admin=e,this},this.userName=function(e){return i.user.name=e,this},this.userIcon=function(e){return i.user.avatar=e,this},this.userId=function(e){return i.user.id=e,this},this.welcomeBody=function(e){return i.message.welcome=e,this},this.emojiMessageCode=function(e){return i.message.emoji.code=e,this},this.textMessageBody=function(e){return i.message.text.body=e,this},this.fileBody=function(e){return i.message.file=e,this},this.fileMessageLocalUrl=function(e){return i.message.file.fileUrl=e,this},this.fileMessageName=function(e){return i.message.file.fileName=e,this},this.fileMessageServerUrl=function(e){return i.message.file.fileServerUrl=e,this},this.imageBody=function(e){return i.message.image=e,this},this.imageMessageUrl=function(e){return i.message.image.url=e,this},this.audio=function(e){return i.message.audio=new t.Audio(e),this},this.timestampBody=function(e){return i.message.timestamp=e,this},this.build=function(){var n=$.extend({},i,!0);return void 0===n.conversation&&(n.conversation=e.$conversationManager.activeConversation()),new t(n)}}t.TYPE={TEXT:"TEXT",EMOJI:"EMOJI",IMAGE:"IMAGE",FILE:"FILE",AUDIO:"AUDIO",WELCOME:"WELCOME",TIMESTAMP:"TIMESTAMP"},t.TO_TYPE={AP:"AP",OG:"OG"},t.getMessageSummary=function(n){var i="",o=n,r=t.TYPE,a=e.Constants.i18n;if(!o||!o.messageType)return"";switch(o.messageType){case r.TEXT:i=o.message.text.body;break;case r.EMOJI:i=o.message.emoji.code;break;case r.FILE:i="["+a("FILE")+": "+o.message.file.fileName+"]";break;case r.IMAGE:i="["+a("IMAGE")+"]";break;case r.AUDIO:i="["+a("AUDIO")+"]";break;case r.WELCOME:i="";break;default:i=""}return i},t.Builder=n,e.PPMessage=t}(Service),function(){function e(e){function t(){return h}function n(){return d}function i(){return l}function o(){return!u&&!Service.$tools.isNull(t())}function r(){return p}function a(){u=!0}function s(){p=!0}var c=$.extend({dura:0,fid:void 0,file:void 0},e.mp3),u=!1,p=!1,l=Service.$tools.getUUID(),d=c.dura,f=c.fid,h=(c.file,Service.$tools.isNull(f)?void 0:Service.$tools.getFileDownloadUrl(f));this.id=i,this.src=t,this.duration=n,this.canPlay=o,this.markError=a,this.hasRead=r,this.markRead=s}Service.PPMessage.Audio=e}(),function(e){function t(t){var n=e.$json,i=e.$messageToolsModule,o=t,r=function(t){var n="",o=t;switch(o.messageType){case e.Constants.MESSAGE.TYPE_EMOJI:n=e.Constants.MESSAGE_SUBTYPE.TEXT;break;case e.Constants.MESSAGE.TYPE_TEXT:n=i.isMessageTextOverflow(o)?e.Constants.MESSAGE_SUBTYPE.TXT:e.Constants.MESSAGE_SUBTYPE.TEXT;break;case e.Constants.MESSAGE.TYPE_FILE:n=e.Constants.MESSAGE_SUBTYPE.FILE;break;case e.Constants.MESSAGE.TYPE_IMAGE:n=e.Constants.MESSAGE_SUBTYPE.IMAGE}return n},a=function(e){var t="",n="application/octet-stream";switch(e.messageType){case"FILE":t=e.message.file.file.type||n;break;case"IMAGE":t=e.message.image.file.type||n;break;case"TEXT":t=e.message.image.file.type||n;break;default:t=n}return t},s=function(){return o.messageToType};this.getApiMessageBody=function(){var t=new e.ApiMessage.Builder(o.messageConversationId).uuid(o.messageId).type(r(o)).toType(s()).toId(o.conversation.token).fromUuid(e.$user.getUser().getInfo().user_uuid).deviceUuid(e.$user.getUser().getInfo().device_uuid).build().getBody();switch(o.messageType){case"TEXT":var c={fid:o.message.text.fuuid};t.message_body=i.isMessageTextOverflow(o)?n.stringify(c):o.message.text.body;break;case"EMOJI":t.message_body=o.message.emoji.code;break;case"FILE":var c={fid:o.message.file.fuuid,mime:a(o)};t.message_body=n.stringify(c);break;case"IMAGE":var c={fid:o.message.image.fuuid,mime:a(o)};t.message_body=n.stringify(c)}return t}}e.PPMessageAdapter=t}(Service),function(e){var t=function(){var t=function(t){var n=t;return sendSettings=function(){switch(n.messageType){case"TEXT":return e.$textMessageSendSettings.build(n);case"EMOJI":return e.$emojiMessageSendSettings.build(n);case"IMAGE":return e.$imageMessageSendSettings.build(n);case"FILE":return e.$fileMessageSendSettings.build(n)}}(),sendSettings};return{get:t}}();e.$sendSettingsFactory=t}(Service),function(e){var t=function(){function t(t){var n=t.message.text.body,i=e.$messageToolsModule.isTextLengthLargerThan128(n),o=t.messageIsConversationValid&&i;return{upload:o,uploadType:"txt",uploadContent:n}}return{build:t}}();e.$textMessageSendSettings=t}(Service),function(e){var t=function(){function e(e){return{upload:!0,uploadContent:e.message.file.file}}return{build:e}}();e.$fileMessageSendSettings=t}(Service),function(e){var t=function(){function e(e){return{upload:!0,uploadContent:e.message.image.file}}return{build:e}}();e.$imageMessageSendSettings=t}(Service),function(e){var t=function(){function e(e){return{}}return{build:e}}();e.$emojiMessageSendSettings=t}(Service),Service.$msgStateReceiverFactory=function(){function e(e){switch(e){case"TEXT":return Service.$msgStateTextReceiver;case"EMOJI":return Service.$msgStateEmojiReceiver;case"FILE":return Service.$msgStateFileReceiver;case"IMAGE":return Service.$msgStateImageReceiver;default:return{listen:function(){}}}}return{get:e}}(),Service.$msgStateTextReceiver=function(){function e(e){var t=Service.$pubsub.subscribe("msg/send/"+e,function(e,n){var i=n.body,o=Service.$messageSender.$messageStateBroadcast.STATE;switch(n.state){case o.BUILD_DONE:Ctrl.$conversationContent.appendMessage(i);break;case o.UPLOAD_DONE:i.message.text.fuuid=n.stateInfo.fileId;break;case o.SEND_DONE:Service.$pubsub.unsubscribe(t);break;case o.SEND_FAIL:View.$userTextMessage.onSendFail(i),Service.$pubsub.unsubscribe(t)}})}return{listen:e}}(),Service.$msgStateEmojiReceiver=function(){function e(e){var t=Service.$pubsub.subscribe("msg/send/"+e,function(e,n){var i=n.body,o=Service.$messageSender.$messageStateBroadcast.STATE;switch(n.state){case o.BUILD_DONE:Ctrl.$conversationContent.appendMessage(i),View.$composerContainer.focus();break;case o.SEND_DONE:Service.$pubsub.unsubscribe(t);break;case o.SEND_FAIL:View.$userEmojiMessage.onSendFail(i),Service.$pubsub.unsubscribe(t)}})}return{listen:e}}(),Service.$msgStateFileReceiver=function(){function e(e){var t=Service.$pubsub.subscribe("msg/send/"+e,function(e,n){var i=n.body,o=Service.$messageSender.$messageStateBroadcast.STATE,r="#pp-conversation-part-file-by-user-o2-"+i.messageId;switch(n.state){case o.BEGIN_UPLOAD:i.message.file.fileUploadId=n.stateInfo.uploadTaskId,Ctrl.$conversationContent.appendMessage(i),View.$composerContainer.focus(),$(r).css({opacity:.6});break;case o.UPLOADING:var a=n.stateInfo.uploadProgress;if(0>a)return;100>=a&&$("#pp-uploading-bar-state-"+i.message.file.fileUploadId).css("width",a+"%");break;case o.UPLOAD_DONE:var s=n.stateInfo.fileId;i.message.file.fuuid=s,i.message.file.fileServerUrl=Service.$tools.getFileDownloadUrl(s,i.message.file.fileName),$("#pp-uploading-bar-outer-"+i.message.file.fileUploadId).hide();break;case o.UPLOAD_FAIL:$("#pp-uploading-bar-outer-"+i.message.file.fileUploadId).hide();break;case o.SEND_DONE:$("#pp-conversation-part-file-by-user-o2-"+i.messageId).css({opacity:1}),i.message.file.fileServerUrl&&$("#pp-conversation-part-file-by-user-a-"+i.messageId).attr("href",i.message.file.fileServerUrl),Service.$pubsub.unsubscribe(t);break;case o.SEND_FAIL:$("#pp-conversation-part-file-by-user-timestamp-"+i.messageId).text(i.extra.errorDescription).css({color:"red",display:"block"}),Service.$pubsub.unsubscribe(t)}})}return{listen:e}}(),Service.$msgStateImageReceiver=function(){function e(e){var t=Service.$pubsub.subscribe("msg/send/"+e,function(e,n){var i=n.body,o=Service.$messageSender.$messageStateBroadcast.STATE;switch(n.state){case o.BEGIN_UPLOAD:i.message.image.fileUploadId=n.stateInfo.uploadTaskId,Ctrl.$conversationContent.appendMessage(i),View.$composerContainer.focus(),View.$userImageMessage.onBeginUpload(i.messageId);break;case o.UPLOADING:var r=n.stateInfo.uploadProgress;if(0>r)return;100>=r&&$("#pp-uploading-bar-state-"+i.message.image.fileUploadId).css("width",r+"%");break;case o.UPLOAD_DONE:var a=n.stateInfo.fileId;i.message.image.fuuid=a,i.message.image.fileServerUrl=Service.$tools.getFileDownloadUrl(a),$("#pp-uploading-bar-outer-"+i.message.image.fileUploadId).hide();break;case o.UPLOAD_FAIL:$("#pp-uploading-bar-outer-"+i.message.image.fileUploadId).hide();break;case o.SEND_DONE:View.$userImageMessage.onSendDone(i.messageId,i.message.image.fileServerUrl),Service.$pubsub.unsubscribe(t);break;case o.SEND_FAIL:View.$userImageMessage.onSendFail(i.messageId,i.extra.errorDescription),Service.$pubsub.unsubscribe(t)}})}return{listen:e}}(),Service.$notifyAuth=function(){function e(e,n){function i(){var n=Service.$api,i=Service.$json,o=e.getWsSettings(),r=n.getApiToken(),a=o.user_uuid,s=o.device_uuid,c=o.app_uuid,u=!1,p={title:document.title,location:function(){var e={};for(var t in location)location.hasOwnProperty(t)&&"string"==typeof location[t]&&(e[t]=location[t]);return e}()};e.write(i.stringify({type:t,api_token:r,app_uuid:c,user_uuid:a,device_uuid:s,extra_data:p,is_service_user:u}))}function o(){if(n&&(0===n.error_code||0===n.code)){var t=e.getWsSettings();Service.$api.getUnackedMessages({app_uuid:Service.$ppSettings.getAppUuid(),from_uuid:t.user_uuid,device_uuid:t.device_uuid},function(t){t.list&&t.message&&$.each(t.list,function(n,i){var o=t.message[i],r=null;o&&(r=Service.$json.parse(o),r.pid=i,Service.$notifyMsg.get(e,r).dispatch())})})}}return{auth:i,dispatch:o}}var t="auth";return{get:e}}(),Service.$notifyMsg=function(){function e(e,i){function o(){var n=i;if(n){var o=Service.$json.stringify({type:t,send:n});e.write(o,function(){throw new Error("ws not open")})}}function r(){var e=void 0!==i.what&&i.what===n;e?a(i):s(i)}function a(e){var t=e.extra.uuid;t&&(0===e.code?Service.$messageSender.notifySendDone(t):Service.$messageSender.notifySendFail(t))}function s(e){c.ackMessage({list:[e.pid]}),new Service.ApiMessageAdapter(e).asyncGetPPMessage(function(e,t){t&&u.publish("ws/msg",e)})}var c=Service.$api,u=Service.$pubsub;Service.$debug;return{send:o,dispatch:r}}var t="send",n="SEND";return{get:e}}(),Service.$notification=function(){function e(e,i){n()?(t().send(e),Service.$debug.d("[Message][Send]",e)):i&&i(e)}function t(){return r}function n(){return null!=r&&r.readyState===WebSocket.OPEN}function i(){return o}var o=null,r=null,a=Configuration.web_socket_url,s=!("undefined"==typeof WebSocket),c=null,u=null,p=function(){null!=o&&null!=r&&Service.$notifyAuth.get(Service.$notification).auth()},l=function(e){Service.$debug.d("[WebSocket][Close]: ",e),null!=o&&(r=null,u&&u())},d=function(e){var t=Service.$json,n=Service.$debug,i="string"==typeof e.data&&function(){try{return t.parse(e.data)}catch(i){return void(i&&n.d(i))}}()||"object"==typeof e.data&&e.data;void 0!==i&&(n.d("[Message][Arrived][WsMessage]:",i),Service.$notifyFactory.get(Service.$notification,i).dispatch())},f=function(e){Service.$debug.error("[WebSocket][Error]: ",e),r=null},h=function(){null!=r&&r.close()},g=function(){null!=r&&r.readyState!=WebSocket.CONNECTING&&r.readyState!=WebSocket.CLOSED||v()},v=function(){_()},m=function(){null!=c&&(clearInterval(c),c=null)},b=function(){m(),c=setInterval(g,1e4)},w=function(e){return o=e,this},_=function(){s&&null!=o&&null==r&&(r=new WebSocket(a),r.onopen=p,r.onclose=l,r.onmessage=d,r.onerror=f,b())},x=function(e){u=e,h(),m()};return{init:w,start:_,reset:x,write:e,getWs:t,isWsOk:n,getWsSettings:i,onWebSocketMessage:d}}(),Service.$notifyFactory=function(){function e(e,i){var o,r=t(i);switch(r){case n.MSG:o=Service.$notifyMsg;break;case n.ONLINE:o=Service.$notifyOnline;break;case n.TYPING:o=Service.$notifyTyping;break;case n.AUTH:o=Service.$notifyAuth;break;case n.SYS:o=Service.$notifySys;break;case n.CONVERSATION:o=Service.$notifyConversation;break;default:o=Service.$notifyUnknown}return o.get(e,i.msg?i.msg:i)}function t(e){var t=e.type;if(t===n.MSG)e.msg.mt===n.SYS&&(t=n.SYS);else if(t===n.ACK)switch(e.what){case i.AUTH:t=n.AUTH;break;case i.SEND:t=n.MSG;break;case i.CONVERSATION:t=n.CONVERSATION}return t}var n={AUTH:"AUTH",ACK:"ACK",MSG:"MSG",ONLINE:"ONLINE",SYS:"SYS",TYPING:"TYPING",CONVERSATION:"CONVERSATION"},i={AUTH:"AUTH",SEND:"SEND",CONVERSATION:"CONVERSATION"};return{get:e}}(),Service.$notifyOnline=function(){function e(e,t){function n(){t&&Service.$pubsub.publish("ws/online",t)}return{dispatch:n}}return{get:e}}(),Service.$notifySys=function(){function e(e,n){function i(){n&&o(n)&&e.reset()}function o(e){return e&&e.ms&&e.ms===t}return{dispatch:i}}var t="LOGOUT";return{get:e}}(),Service.$notifyTyping=function(){function e(e,o){function r(n){e.isWsOk()&&(e.write(Service.$json.stringify({type:t,conversation_uuid:n})),__Monitor.report(__MonitorEvent.watch,n))}function a(t){t&&e.isWsOk()&&(e.write(Service.$json.stringify({type:i,conversation_uuid:t})),__Monitor.report(__MonitorEvent.unwatch,t))}function s(){e.isWsOk()&&(e.write(Service.$json.stringify({type:n})),__Monitor.report(__MonitorEvent.typing,n))}function c(){void 0!==o&&Service.$pubsub.publish("ws/typing",o)}return{dispatch:c,watch:r,unWatch:a,typing:s}}var t="typing_watch",n="typing",i="typing_unwatch";return{get:e}}(),Service.$notifyUnknown=function(){function e(e,t){function n(){Service.$debug.d("unknown msg : ",t)}return{dispatch:n}}return{get:e}}(),Service.$notifyConversation=function(){function e(e,i){function o(){i.code===n.NOERR&&Service.$pubsub.publish(t.AVALIABLE,r(i))}function r(e){return e.extra&&e.extra.conversation_uuid}return{dispatch:o}}var t={AVALIABLE:"NOTIFY_CONVERSATION/AVALIABLE"},n={NOERR:0,WAITING:11};return{EVENT:t,get:e}}(),function(){View._booted=!1,View.bootMe=function(e){View._booted&&!e||(View.$settings=new View.PPSettings,View.$textUrlChecker=new View.TextUrlChecker,View._booted=!0)},View._pool={},View.add=function(e,t){View._pool[e]=t},View.find=function(e){return View._pool[e]}}(),function(e){function t(e,t,n){function i(e,t,n,i){var o={};t&&(n?($.each(t,function(e,t){if(void 0!==t||null!==t)switch(e){case"className":o["class"]=t;break;default:o[e]=t}}),!o["class"]&&o.id&&(o["class"]=o.id)):i&&(o.id=i,o["class"]=i));var r=document.createElement(e);for(var a in o)"event"!=a&&"selector"!=a&&r.setAttribute(a,o[a]);if(o.event){var s=i?"#"+i:o.selector,c=["click","mouseover","mouseleave","mousedown","keydown","keyup","change","input propertychange","focus","blur","init"];if(!s)throw new Error("No jQuerySelector");s&&$.each(o.event,function(e,t){if(-1!=$.inArray(e,c))switch(e){case"init":setTimeout(function(){t.apply(this,arguments)});break;case"change":setTimeout(function(){$(s).bind(e,function(e){t.apply(this,$(this))})});break;default:setTimeout(function(){$(s).bind(e,function(e){t.apply(this,arguments)})})}})}return $(r)}var o=t&&"object"==typeof t,r=o?t.id:t,a=i(e,t,o,r),s=n;this.controller=s,this.getElement=function(){return a},this.getHTML=function(){return a[0].outerHTML},this.add=function(e){return a.append(e.getElement()[0].outerHTML),this},this.text=function(e){return a.text(e),this},this.html=function(e){return a.html(e),this},this.show=function(e){return a.css("display",e?"block":"none"),this},this.ctrl=function(e){s=e},this.getController=function(){return s},this.renderTo=function(e){}}e.PPElement=t,e.Element=t}(View),function(e){function t(){e.PPElement.call(this,"style",{id:"pp-styles",type:"text/css"}),this.text("@charset \"UTF-8\" .pp-container,.pp-location{z-index:2147483647;bottom:0}.pp-container p,.pp-p-no-margin{-webkit-margin-before:0!important;-webkit-margin-after:0!important;-webkit-margin-start:0!important;-webkit-margin-end:0!important}.pp-container,.pp-launcher-icon,.pp-location,.pp-sheet-header{position:absolute;right:0}.pp-container a,.pp-container b,.pp-container div,.pp-container p,.pp-container span,.pp-container textarea,.pp-container u{font-family:'Helvetica Neue',Helvetica,Arial,sans-serif!important;font:normal normal 100% 'Helvetica Neue',Helvetica,Arial,sans-serif;font-style:normal;letter-spacing:normal;font-stretch:normal;font-variant:normal;-webkit-text-emphasis:none;text-shadow:none;text-transform:none;-webkit-font-smoothing:antialiased;word-wrap:break-word}.pp-container *,.pp-container :after,.pp-container :before{-webkit-box-sizing:content-box!important;-moz-box-sizing:content-box!important;box-sizing:content-box!important}.pp-conversation-container{display:none}.pp-text-link-user{color:#fff!important}.pp-text-link-admin{color:#455A64!important}.pp-container .pp-box-sizing{-webkit-box-sizing:content-box!important;-moz-box-sizing:content-box!important;box-sizing:content-box!important}.pp-container .pp-box-sizing-borderbox{-webkit-box-sizing:border-box!important;-moz-box-sizing:border-box!important;box-sizing:border-box!important}.pp-fixme{clear:both}.pp-selectable{-o-user-select:text;-moz-user-select:text;-webkit-user-select:text;user-select:text}.pp-unselectable{-moz-user-select:none;-khtml-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.pp-launcher-icon{bottom:0;width:50px;height:50px;max-width:50px;border-radius:25px;box-shadow:0 6px 13px 0 rgba(0,0,0,.23)}.pp-launcher-icon:hover{cursor:pointer}.pp-sheet-header{z-index:2147483002;box-shadow:0 1px 2px 0 rgba(0,0,0,.12);background:#fff;overflow:hidden;top:0;width:100%;height:48px}.pp-sheet-header-title-container{position:absolute;left:0;top:0;width:100%;height:100%;text-align:center;-moz-text-align-last:center;text-align-last:center}.pp-container .pp-sheet-header-title{font-size:16px;line-height:48px;font-weight:500;color:#465C66;letter-spacing:.2px;max-width:200px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:inline}.pp-sheet-header-button{position:relative;margin:0 20px 0 15px;height:48px;float:right}.pp-sheet-header-button-minimize-container{position:relative;margin:0;height:48px;width:48px;float:right;cursor:pointer}.pp-sheet-header-button:hover{cursor:pointer}.pp-sheet-header-minimize-button-icon{background-position:center center;width:16px;background-repeat:no-repeat;background-size:15px 15px;height:48px;position:relative;margin:auto}.pp-composer-container-action-btn,.pp-launcher-button,.pp-sheet-header .pp-sheet-header-button-icon{background-position:center;background-repeat:no-repeat}.pp-sheet-header .title-container{display:inline-block}.pp-sheet-header .clickable{cursor:pointer}.pp-sheet-header .down-icon{cursor:pointer;display:inline-block;height:10px;margin-left:5px;width:10px}.pp-container .pp-group-content-container{box-sizing:border-box;display:none;position:relative;height:100%;margin:0 auto;padding-bottom:48px;overflow-y:auto;top:48px}.pp-group-item{padding-top:17px;padding-left:17px;cursor:pointer}.pp-group-item *{cursor:pointer}.pp-group-item img{border-radius:50%;float:left;margin-top:5px;display:inline-block;width:42px;height:42px}.pp-group-item .body-container{margin-left:55px;padding-right:17px;border-bottom:1px solid #e7e7e7;height:65px}.pp-group-item .pp-header{margin-bottom:5px}.pp-group-item .pp-timestamp{float:right;font-size:12px;line-height:20px;color:#aaa;width:50px;text-align:right}.pp-group-item .title-container{margin:0 50px 0 0}.pp-group-item .pp-title{color:rgba(96,104,110,.8);font-size:15px;line-height:22px;font-weight:500;display:block;width:100%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.pp-group-item .pp-summary{color:rgba(96,104,110,.8);font-size:14px;font-weight:400;line-height:19px;height:40px;overflow:hidden;position:relative;padding-right:17px;word-break:break-word}.pp-group-item .pp-content{line-height:19px}.pp-group-item .pp-unread{color:#3d4347;font-weight:500}.pp-group-item .readstate{background-color:red;border-radius:50%;bottom:27px;color:#fff;display:none;font-size:12px;height:16px;width:16px;position:absolute;right:0;text-align:center;top:6px}.pp-group-item-hover{background-color:#f5f5f6}.pp-sheet-header .pp-sheet-conversations-button{float:left;cursor:pointer;display:none;position:relative;margin:0 20px;height:100%}.pp-sheet-header .pp-sheet-header-button-icon{background-size:15px 12px;margin:0 auto;width:18px;height:100%;opacity:.4;float:left}.pp-sheet-header .pp-unread-count{border-radius:50%;border:2px solid #fff;font-size:11px;line-height:16px;background-color:#0074b0;text-align:center;color:#fff;position:absolute;width:16px;height:16px;top:11px;left:11px;cursor:pointer;display:none}.pp-relative-time{cursor:pointer}.pp-emoji-selector{background-color:#fff;width:324px;height:257px;float:right;margin-right:16px;border-radius:3px;border:1px solid #D0D4D8;box-shadow:0 0 3px 1px rgba(0,0,0,.1)}.pp-emoji-selector-triangle{right:25px;border:solid transparent;position:absolute;pointer-events:none;border-color:rgba(170,170,170,0);border-top-color:#aaa;border-width:8px;z-index:2147483646}.pp-emoji-selector-triangle-mask{right:25px;border:solid transparent;position:absolute;pointer-events:none;border-color:rgba(170,170,170,0);border-top-color:#FFF;margin-top:-1px;border-width:8px;z-index:2147483646}.pp-container .pp-emoji-selector-panel-header{background-color:#fff;height:35px;width:100%;border-radius:3px;text-align:center;font-size:24px}.pp-emoji-selector-panel-header span{line-height:30px;width:45px;margin-top:5px;text-align:center;display:inline-block;border-radius:3px 3px 0 0;cursor:pointer;margin-right:5px}.pp-emoji-selector-panel-header span.active{box-shadow:0 -1px 3px 0 rgba(0,0,0,.1);background-color:#FFF}.pp-emoji-selector-content{box-shadow:0 -1px 3px 0 rgba(0,0,0,.1);background-color:#fff;height:212px;width:314px;overflow-y:auto;display:block;border-radius:0 0 3px 3px;position:relative;left:0;top:0;padding:5px}.pp-container .pp-emoji-selector-content span{margin:6px;width:30px;line-height:30px;display:inline-table;cursor:pointer;text-align:center;font-size:21px}.pp-emoji-selector-sibling{background-color:transparent;overflow:hidden;height:259px}.pp-messenger-panel{width:368px;height:100%;position:fixed;right:0;top:0;bottom:0;border-left:1px solid #e7e7e7;z-index:2147483646;box-shadow:0 0 4px 1px rgba(0,0,0,.08)}.pp-container .pp-launcher-badge{position:absolute;right:-7px;top:0;border-radius:50%;font-size:12px;line-height:18px;background-color:#ff3c00;text-align:center;color:#fff;width:18px;height:18px;cursor:pointer;opacity:1;display:block;visibility:visible}.pp-launcher-button,.pp-launcher-button-container{width:48px;height:48px}.pp-launcher-button{border-radius:50%;border-style:solid;border-width:0;position:absolute;bottom:0;right:0;cursor:pointer;border-color:#004c88;box-shadow:0 6px 13px 0 rgba(0,0,0,.23)}.pp-launcher-button-container-inactive{transition:opacity,.1s;opacity:0;visibility:hidden}.pp-launcher-button-container-active{opacity:1;visibility:visible}.pp-launcher-button-minimized{-webkit-animation:pp-launcher-minimize .1s linear 0s both;animation:pp-launcher-minimize .1s linear 0s both;transition:background-image 0s linear .1s}.pp-launcher-button-maximize{-webkit-animation:pp-launcher-maximize .1s linear 0s both;animation:pp-launcher-maximize .1s linear 0s both}.pp-launcher-button-inactive{visibility:hidden}.pp-launcher-container{position:fixed;height:48px;z-index:2147483646}.pp-loading{box-sizing:border-box;display:none;height:100%;margin:0 auto;top:48px}.pp-loading-spinner{width:28px;height:28px;background-size:28px 28px;background-repeat:no-repeat;position:absolute;left:50%;top:50%;margin-left:-14px;animation:loading 1s linear 0s infinite both;-o-animation:loading 1s linear 0s infinite both;-moz-animation:loading 1s linear 0s infinite both;-webkit-animation:loading 1s linear 0s infinite both}.pp-loading-text{color:gray;font-size:14px!important;width:100%;position:absolute;text-align:center;top:calc(50% + 35px)}@-webkit-keyframes loading{100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-moz-keyframes loading{100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-o-keyframes loading{100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes loading{100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-webkit-keyframes pp-launcher-minimize{0%{-webkit-transform:scale(1);transform:scale(1)}100%{-webkit-transform:scale(0);transform:scale(0)}}@-keyframes pp-launcher-minimize{0%{-webkit-transform:scale(1);-ms-transform:scale(1);transform:scale(1)}100%{-webkit-transform:scale(0);-ms-transform:scale(0);transform:scale(0)}}@-webkit-keyframes pp-launcher-maximize{0%{-webkit-transform:scale(0);transform:scale(0)}100%{-webkit-transform:scale(1);transform:scale(1)}}@-keyframes pp-launcher-maximize{0%{-webkit-transform:scale(0);-ms-transform:scale(0);transform:scale(0)}100%{-webkit-transform:scale(1);-ms-transform:scale(1);transform:scale(1)}}.pp-conversation-content-maximize{opacity:1;-webkit-transform:scale(1);-ms-transform:scale(1);transform:scale(1);-webkit-transform-origin:bottom right;-ms-transform-origin:bottom right;transform-origin:bottom right;transition:opacity .1s linear .15s,-webkit-transform .25s ease-in-out;transition:transform .25s ease-in-out,opacity .1s linear .15s;transition:transform .25s ease-in-out,opacity .1s linear .15s,-webkit-transform .25s ease-in-out}.pp-conversation-sheet-minimized{opacity:0;-webkit-transform:scale(0);-ms-transform:scale(0);transform:scale(0);-webkit-transform-origin:bottom right;-ms-transform-origin:bottom right;transform-origin:bottom right;transition:opacity .1s linear,visibility 0s linear .25s,-webkit-transform .25s ease-in-out;transition:transform .25s ease-in-out,opacity .1s linear,visibility 0s linear .25s;transition:transform .25s ease-in-out,opacity .1s linear,visibility 0s linear .25s,-webkit-transform .25s ease-in-out}.pp-composer{position:relative;max-width:336px;margin:0 auto}.pp-composer-container-action-btn{height:15px;width:15px;position:relative;float:right;cursor:pointer;top:5px;margin:0 2px 0 0;padding:5px;opacity:.4;background-size:15px 15px}.pp-composer-container-emoji-btn{display:inline;margin-right:2px}.pp-composer-container-tools-container{position:absolute;top:3px;right:6px}.pp-composer-container-warning{bottom:60px;background:0 0;width:100%;text-align:center}.pp-composer-container-form{margin-bottom:0!important;padding:0!important;float:right;width:100%}.pp-container .pp-composer-container-warning-span{font-size:14px;color:red}.pp-container .pp-composer-container-textarea{line-height:20px;border-radius:4px;border:1px solid #cfd8dc;height:100%;width:100%;outline:0!important;color:#455A64;resize:none;font-size:14px;padding:10px 70px 5px 14px;word-break:break-all;overflow:hidden;max-height:210px;min-height:40px}.pp-composer-container-powered-by-container{padding:2px}.pp-container .pp-conversation-part-pulltorefreshbutton{font-size:14px;color:gray;cursor:pointer}.pp-composer-container-input{display:none!important}.pp-container .pp-powered-by{width:100%;color:#b0bec5;text-align:center;clear:both;font-weight:500;line-height:22px;padding:7px;font-size:13px}.pp-powered-by a{text-align:center;cursor:pointer;color:inherit;text-decoration:none}.pp-powered-by u{text-decoration:underline!important}.pp-container .pp-powered-by-span{color:#b6c2c9;float:none;font-size:13px;margin-left:0}.pp-conversation-part{margin-bottom:16px}.pp-conversation-part-welcome-outer-1{display:block;margin-bottom:16px}.pp-conversation-part-welcome-outer-2{border-top:0;border-bottom:1px solid #e4e5e7;padding:0 20px 20px}.pp-conversation-part-welcome-icon{bacground-size:28px 28px;background-repeat:no-repeat;width:28px;height:28px;margin:0 auto 15px}.pp-container .pp-conversation-part-welcome-body{font-weight:400;font-size:14px;color:#90A4AE;line-height:18px;text-align:center;display:block;-moz-user-select:text;-webkit-user-select:text;-ms-user-select:text}.pp-conversation-content{overflow-y:auto;position:absolute;top:48px;bottom:79px;right:0;width:100%;padding:8px;box-sizing:border-box;transition-timing-function:cubic-bezier(.1,.57,.1,1);-webkit-transition-timing-function:cubic-bezier(.1,.57,.1,1);transition-duration:0s;-webkit-transition-duration:0s;transform:translate(0,0) translateZ(0)}.pp-conversation-part-text-by-admin-outer{text-align:left;margin-bottom:16px;clear:both}.pp-conversation-part-text-by-admin-outer-2{position:relative;width:100%}.pp-conversation-part-text-by-admin-avatar{margin-right:5px;border-radius:50%;width:28px;height:28px;float:left;position:relative;overflow:hidden}.pp-conversation-part-text-by-admin-outer-3{position:relative}.pp-conversation-part-text-by-admin-body-container{border-color:#dadee2;border-radius:4px;border-width:1px;border-style:solid;position:relative;max-width:80%;display:inline-block;background-color:#fff;color:#455A64;-moz-user-select:text;-webkit-user-select:text;-ms-user-select:text;top:3px}.pp-container .pp-conversation-part-serve-name{font-size:12px;color:#455A64;text-align:left}.pp-container .pp-conversation-part-text-by-admin-body{font-size:14px;font-weight:400;line-height:20px;padding:12px 17px;text-align:left;word-break:break-all;white-space:pre-wrap}.pp-conversation-part-text-by-admin-triangle{width:0;height:0;border-top:4px solid transparent;border-bottom:4px solid transparent;border-right:4px solid #dadee2;position:relative;float:left;margin-top:10px;margin-right:-1px;top:3px}.pp-container .pp-conversation-part-text-by-admin-timestamp-container{font-size:12px;line-height:20px;color:#c9cbcf;position:relative;top:0;display:inline-block}.pp-conversation-part-emoji-by-admin-outer{text-align:right;margin-bottom:16px;width:100%;position:relative;overflow:hidden}.pp-conversation-part-emoji-by-admin-avatar{margin-right:7px;border-radius:50%;width:28px;height:28px;float:left;position:relative}.pp-conversation-part-emoji-by-admin-body-container{float:left;position:relative}.pp-container .pp-conversation-part-emoji-by-admin-body{font-size:96px;line-height:1.1;float:left;position:relative;margin-top:5px}.pp-container .pp-conversation-part-emoji-by-admin-timestamp{font-size:12px;line-height:20px;color:#c9cbcf;clear:both;display:block;float:left;margin-top:5px}.pp-conversation-part-image-by-user{text-align:right;margin-bottom:16px}.pp-conversation-part-image-by-user-o{text-align:right;margin-bottom:16px;position:relative;overflow:hidden;clear:both}.pp-conversation-part-image-by-user-img{cursor:pointer;border-radius:4px;margin:0 0 5px;padding:0;right:0;max-width:242px;float:right}.pp-container .pp-conversation-part-image-by-user-timestamp{position:relative;float:right;font-size:12px;line-height:20px;color:#c9cbcf;clear:both}.pp-conversation-part-image-by-admin-o{text-align:right;margin-bottom:16px;clear:both}.pp-conversation-part-image-by-admin-o1{position:relative;width:100%}.pp-conversation-part-image-by-admin-avatar{margin-right:7px;border-radius:50%;width:28px;height:28px;float:left;position:relative;overflow:hidden}.pp-conversation-part-image-by-admin-o2{overflow:hidden;position:relative}.pp-conversation-part-image-by-admin-o3{overflow:hidden}.pp-conversation-part-image-by-admin-o4{max-width:242px;float:left;position:relative}.pp-conversation-part-image-by-admin-img{cursor:pointer;border-radius:4px;margin:3px 0 0;padding:0;width:100%}.pp-container .pp-conversation-part-image-by-admin-timestamp-container{position:relative;float:left;font-size:12px;line-height:20px;color:#c9cbcf}.pp-conversation-part-file-by-admin-outer{text-align:right;margin-bottom:16px;clear:both}.pp-conversation-part-file-by-admin-outer-2{position:relative;width:100%}.pp-conversation-part-file-by-admin-avatar{margin-right:7px;border-radius:50%;width:28px;height:28px;float:left;position:relative;overflow:hidden}.pp-conversation-part-file-by-admin-outer-3{overflow:hidden;position:relative}.pp-conversation-part-file-by-admin-outer-4{max-width:80%;float:left;position:relative;margin-top:3px}.pp-conversation-part-file-by-admin-outer-5{display:block;background-color:#0071b2;border-radius:4px;border-width:1px;border-style:solid;padding:5px;overflow:hidden}.pp-conversation-part-file-by-admin-upload-icon{position:relative;float:left;width:32px;height:32px;background-size:16px 15px;background-position:center;background-repeat:no-repeat;border-right:1px solid rgba(255,255,255,.3)}.pp-conversation-part-file-by-admin-outer-6{vertical-align:middle;margin:5px 10px 0;overflow:hidden}.pp-container .pp-conversation-part-file-by-admin-file-link{font-size:14px;font-weight:400;line-height:20px;position:relative;float:left;color:#fff;text-decoration:underline;cursor:pointer;overflow:hidden;word-break:break-all;max-height:20px;margin-left:5px}.pp-container .pp-conversation-part-file-by-admin-timestamp-container{position:relative;float:left;font-size:12px;line-height:20px;color:#c9cbcf}.pp-conversation-part-file-by-user-o{width:100%;position:relative;overflow:hidden}.pp-conversation-part-file-by-user-o2{float:right;padding:5px;background-color:#0071b2;border-radius:4px;border-width:1px;border-style:solid;margin-bottom:5px;max-width:80%}.pp-conversation-part-file-by-user-upload-icon{float:left;width:32px;height:32px;background-size:16px 15px;background-position:center;background-repeat:no-repeat;border-right:1px solid rgba(255,255,255,.3)}.pp-conversation-part-file-by-user-link-container{max-height:20px;overflow:hidden;margin:5px 5px 0 32px}.pp-container .pp-conversation-part-file-by-user a{color:#fff;font-size:14px;font-weight:400;line-height:20px;text-decoration:underline;word-break:break-all;margin:5px 5px 0 10px}.pp-container .pp-conversation-part-file-by-user-timestamp{font-size:12px;line-height:20px;color:#c9cbcf;clear:both;text-align:right}.pp-conversation-part-center{display:table;margin:0 auto 10px}.pp-uploading-bar,.pp-uploading-bar-remove{display:inline-block;vertical-align:middle}.pp-container .pp-conversation-part-timestamp-time{background-color:#cecece;padding:4px;border-radius:4px;font-size:14px}.pp-uploading-bar{border-radius:4px;position:relative;width:50px;height:6px;border:1px solid #ccc;background-color:#fff;margin:0 5px}.pp-uploading-bar-state{transition:width .4s;border-radius:3px;background-color:#0071b2;position:absolute;top:0;left:0;bottom:0}.pp-uploading-bar-remove{background-size:14px 14px;background-repeat:no-repeat;opacity:.8;cursor:pointer;width:14px;height:14px;right:-22px;top:2px}.pp-container .pp-uploading-bar-outer{color:#c9cbcf;font-size:14px;display:block;float:right}.pp-launcher-preview-outer{height:100px;max-width:274px;float:right;margin-right:52px;width:100%;position:relative;margin-top:-60px}.pp-launcher-preview-outer-2{padding:10px;position:relative;float:right;cursor:pointer}.pp-launcher-preview-outer-3{border-radius:10px;background:#fff;padding:13px;position:relative;box-shadow:0 6px 13px 0 rgba(0,0,0,.23)}.pp-launcher-preview-close{background-size:18px 18px;background-repeat:no-repeat;cursor:pointer;width:20px;height:20px;float:left;margin-top:-20px;margin-left:-20px;display:none}.pp-launcher-preview{position:relative}.pp-launcher-preview-p-outer{overflow:hidden;max-height:37px;min-height:18px}.pp-launcher-preview-p{word-break:break-all;line-height:19px;color:#333}.pp-launcher-preview-triangle-container{float:right;margin-right:-15px;position:relative}.pp-launcher-preview-triangle{width:0;height:0;border-top:7px solid transparent;border-bottom:7px solid transparent;border-left:7px solid #fff;margin-left:calc(100% - 12px);margin-top:18px}.pp-no-conversations-icon{background-size:79px 59px;background-repeat:no-repeat;display:block;width:79px;height:59px;margin:0 auto 10px}.pp-container .pp-no-conversations-p{color:#CDCFD2;width:96px;margin:auto;font-size:16px;text-align:center}.pp-no-conversations{margin-top:200px}.pp-composer-container{width:100%;background:0 0;position:absolute;bottom:0;right:0;padding:5px}.pp-composer-send-button{border-radius:4px;margin-left:8px;height:40px;float:right;text-decoration:none;padding:0 9px;display:inline-block;color:#fff;cursor:pointer;background:#CCC}.pp-admin-avatar,.pp-admin-avatar img{margin:0 auto;border-radius:50%}.pp-composer-send-button p{font-size:14px;line-height:25px}.pp-app-profile-container{padding:16px 16px 0}.pp-app-profile{padding:20px 12px 26px;background-color:#fff;overflow:hidden;box-shadow:0 0 3px rgba(0,0,0,.2);border-radius:5px}.pp-active-admins{text-align:center;color:#364850;padding-top:24px}.pp-container .pp-app-profile-text{padding:14px 30px 0;text-align:center;font-weight:400;font-size:13px;color:#78909C;line-height:19px}.pp-container .pp-app-profile-team{text-align:center;color:#455a64;font-weight:500;font-size:15px;line-height:1.8}.pp-active-admin{display:inline-block}.pp-admin-avatar img{width:48px;height:48px}.pp-active-admin .state{margin-top:10px;font-size:12px}.pp-active-admin .online{color:#A6D84F}.pp-active-admin .offline{color:#F90}.pp-container .pp-active-admin-name{font-size:12px;color:#90A4AE;text-align:center;padding-top:7px;width:80px;overflow:hidden;text-overflow:ellipsis}.pp-launcher-hovercard{background-color:#fafafb;border-radius:5px;border:1px solid rgba(0,0,0,.1);box-shadow:0 0 10px rgba(0,0,0,.08);width:340px;position:absolute;bottom:64px;right:-5px}.pp-launcher-hovercard-welcome{background-color:#fff;border-radius:5px 5px 0 0;border-bottom:1px solid #dfe0e1;box-shadow:0 1px 1px #f0f0f1;padding:26px 20px;overflow:hidden;cursor:pointer}.pp-launcher-hovercard-close{opacity:1;transition:opacity .2s ease-in-out;cursor:pointer;position:absolute;top:-30px;right:-1px;border-radius:40px;box-shadow:0 0 20px rgba(0,0,0,.12);padding:6px 10px 5px 22px;font-size:12px;color:#fff;background-position:10px center;line-height:12px;background-size:8px 8px;background-repeat:no-repeat}.pp-launcher-hovercard-textarea{padding:18px 16px;font-size:16px;border-radius:0 0 5px 5px;height:42px;cursor:pointer}.pp-container .pp-launcher-hovercard-textarea-textarea{width:100%;height:42px;background-color:#fff;font-weight:400;color:#455a64;resize:none;border:1px solid #cfd8dc;font-size:14px;line-height:20px;padding:10px 70px 5px 14px;border-radius:4px;outline:0}.pp-container .pp-textarea-focus{border-color:#74BEFF;box-shadow:0 0 4px 0 rgba(75,171,255,.38)}.pp-launcher-hovercard-admins{width:107px;position:relative;float:left;height:50px;padding-bottom:35px;cursor:pointer;text-align:center}.pp-launcher-hovercard-text{float:right;width:174px;font-family:Helvetica Neue,Helvetica,Arial,sans-serif;cursor:pointer}.pp-container .pp-launcher-hovercard-app-name{font-weight:700;font-size:14px;color:#37474f;margin-bottom:7px;cursor:pointer}.pp-container .pp-launcher-hovercard-welcome-text{font-size:12px;color:#78909c;line-height:1.5;cursor:pointer}.pp-launcher-hovercard:after,.pp-launcher-hovercard:before{top:100%;right:20px;border:solid transparent;content:' ';height:0;width:0;position:absolute;pointer-events:none}.pp-launcher-hovercard:before{border-color:rgba(204,204,204,0);border-top-color:rgba(0,0,0,.14);border-width:9px;margin-left:-6px}.pp-launcher-hovercard:after{border-color:rgba(250,250,251,0);border-top-color:#fafafb;border-width:8px;margin-left:-5px;right:21px}.pp-launcher-hovercard .groups-header{margin:30 auto 20;text-align:center;font-size:20px;color:#000}.pp-launcher-hovercard .groups-footer{margin:30 auto;text-align:center;clear:both;color:#989494}.pp-launcher-hovercard .groups-body{width:290px;margin:10 auto}.pp-launcher-hovercard .groups-body .item{background-color:#F3F3F3;border:1px solid #FBF0F0;border-radius:5px;box-shadow:2px 2px 1px #E6E3E3;clear:both;cursor:pointer;height:50px;margin-bottom:20px;padding:5 5 5 15px}.pp-launcher-hovercard .groups-body .left{float:left;width:50px}.pp-launcher-hovercard .groups-body .img-container{display:inline-block;margin-left:-22px;position:relative}.pp-launcher-hovercard .groups-body .img-container:first-child{margin-left:0}.pp-launcher-hovercard .groups-body .right{float:left;margin-left:10px}.pp-launcher-hovercard .group-name{margin-top:5px;font-size:16px;color:#3E3C3C}.pp-launcher-hovercard .online-time{font-size:14px;margin-top:5px;color:gray}.pp-launcher-hovercard img{width:46px;height:46px;margin:0 auto;border-radius:50%;border:2px solid #fff}.pp-launcher-admin-avatar{position:relative;display:inline-block;top:0;cursor:pointer;margin-left:-22px}.pp-launcher-admin-avatar:first-child{margin-left:0}.pp-launcher-admin-avatar img{width:46px;height:46px;margin:0 auto;border-radius:50%;border:2px solid #fff}.pp-container img.grayscale{-webkit-filter:grayscale(1);-webkit-filter:grayscale(100%);filter:grayscale(100%);filter:gray}#pp-container .pp-image-viewable{cursor:-webkit-zoom-in;cursor:zoom-in}#pp-container .pp-image-viewer-overlay{z-index:2147483647;position:fixed;top:0;right:0;bottom:0;left:0;background:#000;cursor:-webkit-zoom-out;cursor:zoom-out;opacity:0}#pp-container .pp-zoomed-image{z-index:2147483648;position:fixed;cursor:-webkit-zoom-out;cursor:zoom-out;transition:all .3s ease}.pp-container .group-member-hovercard{background-color:#fafafb;border-radius:5px;border:1px solid rgba(0,0,0,.1);left:42px;box-shadow:0 0 10px rgba(0,0,0,.08);position:absolute;width:260px;-webkit-box-sizing:initial!important;-moz-box-sizing:initial!important;box-sizing:initial!important}.pp-container .group-member-hovercard .body{background-color:#fff;border-radius:5px 5px 0 0;border-bottom:1px solid #dfe0e1;box-shadow:0 1px 1px #f0f0f1;padding:13px 10px 1px;overflow:hidden;cursor:pointer}.pp-container .group-member-hovercard .img-container{display:inline-block;top:0;width:60px;position:relative;float:left;height:50px;padding-bottom:35px;cursor:pointer;text-align:center}.pp-container .group-member-hovercard img{width:60px;height:60px;margin:0 auto;border-radius:50%;border:2px solid #fff}.pp-container .group-member-hovercard .info{float:right;width:164px;cursor:pointer}.pp-container .group-member-hovercard .name{font-weight:700;font-size:14px;color:#37474f;margin-bottom:7px;cursor:pointer}.pp-container .group-member-hovercard .signature{font-size:12px;color:#78909c;line-height:1.5;cursor:pointer}.pp-container .group-member-hovercard .textarea-container{padding:9px 8px;font-size:16px;border-radius:0 0 5px 5px;height:36px;cursor:pointer}.pp-container .group-member-hovercard textarea{width:100%;height:36px;background-color:#fff;font-weight:400;color:#455a64;resize:none;border:1px solid #cfd8dc;font-size:14px;line-height:20px;padding:7px 35px 5px 10px;border-radius:4px;outline:0}.pp-container .group-member-hovercard textarea:focus{border-color:#74BEFF;box-shadow:0 0 4px 0 rgba(75,171,255,.38)}.pp-container .group-member-hovercard .arrow-down{width:0;height:0;border-left:9px solid transparent;border-right:9px solid transparent;border-top:8px solid #000;display:inline-block;right:10px}.pp-container .group-member-hovercard .arrow-up{width:0;height:0;border-left:9px solid transparent;border-right:9px solid transparent;border-bottom:8px solid #000}.pp-container .group-member-hovercard *,.pp-container .group-member-hovercard:after,.pp-container .group-member-hovercard:before{-webkit-box-sizing:content-box!important;-moz-box-sizing:content-box!important;box-sizing:content-box!important}.pp-container .group-member-hovercard textarea{-webkit-box-sizing:border-box!important;-moz-box-sizing:border-box!important;box-sizing:border-box!important}.pp-container .group-members{background-color:#FFF;box-shadow:0 0 10px rgba(0,0,0,.08);display:none;max-height:-moz-calc(100% - 48px);max-height:-webkit-calc(100% - 48px);max-height:calc(100% - 48px);opacity:0;overflow-y:auto;padding-bottom:10px;position:relative;right:0;width:100%}.pp-container .group-members-container{max-height:100%;width:320px;margin:0 auto}.pp-container .group-members .member{float:left;height:101px;margin-left:20px;margin-right:20px;padding-top:20px}.pp-container .group-members .pp-wrapper{position:relative}.pp-container .group-members img.pp-avatar{border-radius:50%;border:2px solid #3F65D6;cursor:pointer;height:60px;width:60px}.pp-container .group-members img.pp-state{bottom:5px;display:none;position:absolute;right:5px}.pp-container .group-members img.pp-state.pp-active{display:block}.pp-container .group-members .member .name{color:#888;font-size:14px;max-height:19px;max-width:60px;overflow:hidden;padding-top:5px;text-align:center;text-overflow:ellipsis}.pp-container .pp-conversation-part-error{color:red;display:block}.pp-container .pp-conversation-part-emoji-by-user{position:relative;top:0;font-size:12px;line-height:20px;color:#c9cbcf;margin-right:6px}.pp-container .pp-conversation-part-emoji-by-user .pp-emoji-container{text-align:right;margin-bottom:16px}.pp-container .pp-conversation-part-emoji-by-user .pp-emoji{display:block;font-size:96px;line-height:1.1;text-align:right}.pp-conversation-part-text-by-user-outer{text-align:right;margin-bottom:16px}.pp-conversation-part-text-by-user-outer .pp-wrapper{text-align:right}.pp-container .pp-conversation-part-text-by-user-timestamp-outer{position:relative;top:0;font-size:12px;line-height:20px;color:#c9cbcf;margin-right:6px}.pp-conversation-part-text-by-user-triangle{width:0;height:0;border-top:4px solid transparent;border-bottom:4px solid transparent;border-left:4px solid #21abe1;position:relative;top:50%;float:right;margin-left:-1px;margin-top:10px}.pp-conversation-part-text-by-user-body-outer{border-radius:4px;border-width:1px;border-style:solid;position:relative;max-width:80%;display:inline-block;background-color:#21abe1;color:#fff;min-height:36px}.pp-container .pp-conversation-part-text-by-user-body{font-size:14px;font-weight:400;line-height:20px;padding:12px 17px;text-align:left;-moz-user-select:text;-webkit-user-select:text;-ms-user-select:text;white-space:pre-wrap}.pp-container .msg-audio-admin .pp-avatar{border-radius:50%;width:28px;height:28px;float:left;position:relative;overflow:hidden;clear:both}.pp-container .msg-audio-admin .pp-content{float:left;width:80%;margin-left:5px;margin-bottom:16px}.pp-container .msg-audio-admin .pp-name{color:#455A64;display:block;font-size:12px;text-align:left}.pp-container .msg-audio-admin .pp-voice{position:relative}.pp-container .msg-audio-admin .pp-body{border-color:#dadee2;border-radius:4px;border-width:1px;border-style:solid;cursor:pointer;position:relative;padding:10px;max-width:80%;display:inline-block;background-color:#fff;color:#455A64;top:3px}.pp-container .msg-audio-admin .pp-triangle{width:0;height:0;border-top:4px solid transparent;border-bottom:4px solid transparent;border-right:4px solid #dadee2;position:relative;float:left;margin-top:10px;margin-right:-1px;top:3px}.pp-container .msg-audio-admin i{width:23px;height:23px;vertical-align:middle;display:inline-block}.pp-container .msg-audio-admin .pp-dura{font-size:14px;margin-left:10px}.pp-container .msg-audio-admin .pp-unread{border-radius:50%;background-color:red;display:inline-block;width:7px;height:7px;margin-left:10px;margin-bottom:2px}.pp-container .msg-audio-admin .pp-desc{font-size:12px;margin-left:5px;display:block;margin-top:5px}@media (max-width:736px){.pp-messenger-panel,.pp-sheet-header{top:0;width:100%;border-left:1px solid #e7e7e7;right:0}.pp-messenger-panel{bottom:0;background-color:#fff;z-index:2147483646}.pp-sheet-header{box-shadow:0 1px 2px 0 rgba(0,0,0,.08);background:#fff;position:fixed;border-bottom:1px solid #e7e7e7;z-index:2147483647}.pp-sheet-header-button{position:relative;margin:0;height:48px;width:48px;float:right}.pp-sheet-header-button-icon{background-size:13px 13px;background-repeat:no-repeat;width:16px;height:100%;background-position:center center;margin:auto}.pp-conversation-part-welcome-outer-2{border-top:0;padding:0 20px 20px;border-image:initial}.pp-emoji-icon{font-family:AppleColorEmoji;margin:6px;width:30px;line-height:30px;display:inline-table;cursor:pointer;text-align:center;font-size:21px}.pp-composer-container{width:100%;background:0 0;position:fixed;bottom:0;right:0;padding:5px}.pp-no-conversations-icon{background-color:#fff}.pp-powered-by{display:none}.pp-conversation-content{bottom:49px}.pp-composer{max-width:100%;margin:0 10px}}@media (max-width:480px){.pp-emoji-selector{max-width:280px;width:100%;height:175px}.pp-emoji-selector-content{max-width:270px;width:100%;height:130px}.pp-emoji-selector-panel-header{max-width:280px;width:100%}.pp-emoji-selector-sibling{height:177px}}");
}extend(t,e.PPElement),e.CssStyle=t}(View),function(e){function t(t,n){e.PPElement.call(this,"div",t,n)}extend(t,e.PPElement),e.PPDiv=t,e.Div=t}(View),function(e){function t(t,n){e.PPElement.call(this,"span",t,n)}extend(t,e.PPElement),e.Span=t}(View),function(e){function t(t,n){e.PPElement.call(this,"p",t,n)}extend(t,e.PPElement),e.P=t}(View),function(e){function t(t,n){e.PPElement.call(this,"img",t,n)}extend(t,e.PPElement),e.Img=t}(View),View.$sheetHeader=function(){function e(){var e=Ctrl.$sheetheader,t=View.PPDiv,n=View.PPElement,i=Configuration.assets_path+"img/icon-conversations.png",o=function(){return new t("pp-sheet-header-title-container").add(new View.Div({className:"title-container"}).add(new n("b",{id:s,"class":s+" pp-selectable"})))},r=function(){return new n("a",{id:c,"class":c,title:Service.Constants.i18n("MINIZE_BUTTON_HINT")}).add(new t({id:"pp-sheet-header-button-icon",style:"background-image: url("+Configuration.assets_path+"img/icon-minimize.png)"}))},u=function(){return new n("a",{"class":"pp-sheet-conversations-button"}).add(new t({"class":"pp-sheet-header-button-icon",style:"background-image: url("+i+")"})).add(new t({"class":"pp-unread-count pp-font pp-box-sizing"}))},p=function(){$("#"+a).bind("click",e.onSheetHeaderClicked)},d=function(){var t=".pp-sheet-header-button .pp-sheet-header-button-icon";$("#"+c).bind("mouseover",function(){$(t).css("opacity",1)}).bind("mouseleave",function(){$(t).css("opacity",.4)}).bind("click",e.minimize)},f=function(){var e=l;$(e).bind("mouseover",function(){$(e).css("opacity",1)}).bind("mouseleave",function(){$(e).css("opacity",.4)}).bind("click",function(){Ctrl.$conversationList.show()})},h=function(){var e=".pp-sheet-conversations-button .pp-unread-count";$(e).bind("mouseover",function(){$(l).mouseover()}).bind("mouseleave",function(){$(l).mouseleave()}).bind("click",function(){$(l).click()})};t.call(this,{id:a,"class":a+" pp-box-sizing pp-unselectable"},e),this.add(o()).add(u()).add(r()),$timeout(function(){e.onSheetHeaderInit(),p(),d(),f(),h()})}function t(){if(!Service.$sheetHeader.isShowDropDownButton()){Service.$sheetHeader.showDropDownButton(!0);var e=$(d);e.append(new View.Element("i",{className:"down-icon",style:"background: url("+Configuration.assets_path+"img/icon-down.png) 0 -795px"}).getHTML()).addClass("clickable").on("click",function(){var e=Ctrl.$groupMembers;e.isShow()?(i(),e.hide()):(o(),e.show())})}}function n(){Service.$sheetHeader.showDropDownButton(!1);var e=$(d);e.find("i").detach(),e.removeClass("clickable"),e.off("click")}function i(){$(d).find("i").attr("style","background: url("+Configuration.assets_path+"img/icon-down.png) 0 -795px")}function o(){$(d).find("i").attr("style","background: url("+Configuration.assets_path+"img/icon-down.png) 0 -2362px")}function r(){return $("#"+a).height()}extend(e,View.PPDiv);var a="pp-sheet-header",s="pp-sheet-header-title",c="pp-sheet-header-button",u=".pp-unread-count",p=".pp-sheet-conversations-button",l=p+" .pp-sheet-header-button-icon",d=".pp-sheet-header .title-container",f=function(){return new e},h=function(e){e>0?$(u).show().text(e):$(u).hide()},g=function(){$(p).show()},v=function(){$(p).hide()},m=function(e){$("#"+s).text(e)};return{build:f,height:r,setUnreadCount:h,showGroupButton:g,hideGroupButton:v,showDropDownButton:t,hideDropDownButton:n,changeDropDownButtonToHideState:i,changeDropDownButtonToShowState:o,setTitle:m}}(),View.$groupContent=function(){function e(){View.PPDiv.call(this,{"class":t}),Service.$pubsub.subscribe("msgArrived/group",function(e,t){var n=t.getBody().conversation.uuid,i=View.$groupContentItem;i.showUnread(n,Modal.$conversationContentGroup.get(n).unreadCount()),i.description(n,t.getMessageSummary())})}extend(e,View.PPDiv);var t="pp-group-content-container",n="."+t,i=function(){return $(n).show(),this},o=function(){return $(n).hide(),this},r=function(e){$(n).empty();var t="";return $.each(e,function(e,n){t+=View.$groupContentItem.build(n).getHTML()}),$(n).append(t),this},a=function(){return $(n).is(":empty")},s=function(){return $(n).is(":visible")},c=function(){return new e};return{build:c,show:i,hide:o,update:r,focus:focus,empty:a,visible:s}}(),View.$groupContentItem=function(){function e(e){View.PPDiv.call(this,{"class":"pp-group-item",group_uuid:e.uuid});var t=e.name,i="",r=e.uuid,a=e.icon,s=e.summary,c=function(){return new View.Img({src:a})},u=function(){return new View.PPDiv({"class":"body-container"}).add(new View.PPDiv({"class":"pp-body"}).add(new View.PPDiv({"class":"pp-header"}).add(new View.PPDiv({"class":"pp-timestamp"}).add(new View.Span({"class":"pp-unread"}).text(i))).add(new View.PPDiv({"class":"title-container"}).add(new View.PPDiv({"class":"pp-title"}).text(t)))).add(new View.PPDiv({"class":n}).add(new View.PPDiv({"class":"readstate"})).add(new View.Div({className:"pp-content"}).text(s))))},p=function(){var e=o(r),t="pp-group-item-hover";e.bind("mouseover",function(){e.addClass(t)}).bind("mouseleave",function(){e.removeClass(t)}).click("click",function(){Ctrl.$conversationList.showItem(r)})};this.add(c()).add(u()),$timeout(p)}function t(e,t){o(e).find(i).text(t)}extend(e,View.PPDiv);var n="pp-summary",i="."+n+" .pp-content",o=function(e){return $(".pp-group-content-container").find("div[group_uuid="+e+"]")},r=function(e,t){t>0&&o(e).find(".readstate").text(t>99?99:t).show()},a=function(e){o(e).find(".readstate").hide()},s=function(e){return $(".pp-group-content-container div[group_uuid="+e+"] img")},c=function(e,t){return e&&t?void s(e).attr("src",t.user_avatar).attr("user_uuid",t.user_uuid):s(e).attr("src")},u=function(t){return new e(t)};return{build:u,showUnread:r,hideUnread:a,groupIcon:c,description:t}}(),View.$groupMembers=function(){function e(e){Service.$conversation.asyncGetUser(e,function(e){t(e)})}function t(e){var t=e||[],n="";$(d).find(".group-members").length||a(),$(h).empty(),$.each(t,function(e,t){n+=View.$groupMember.build(t).getHTML()}),$(h).append(n),$(f).show().animate({opacity:1,top:48},m),s(t)}function n(e,t){var n=$(f),i="boolean"==typeof t?t:!0,o=function(){n.hide(),$(h).empty(),View.$groupMemberHovercard.remove()};i?n.animate({opacity:0,top:0},m,o):o()}function i(){var e=$(f);return 0!==e.length&&e.is(":visible")}function o(e){$(f).css("opacity",e)}function r(){var e=$(f).height()+View.$sheetHeader.height()+Service.$tools.scrollbarWidth>=window.innerHeight;return e?Service.$tools.scrollbarWidth:0}function a(){$(d).append(p().getHTML())}function s(e){Service.$device.isMobileBrowser()?c(e):u(e)}function c(e){$(g).on("click",function(e){var t=$(this).attr("user_uuid");View.$loading.show(),Ctrl.$groupMembers.hide(),Ctrl.$groupMembers.onMemberClicked(t,function(){View.$loading.hide()})})}function u(e){$(g).bind("mouseover",function(t){t.stopImmediatePropagation(),b=!0,Service.$task.cancel(_);var n=l(e,$(this).attr("user_uuid"));View.$groupMemberHovercard.remove(),View.$groupMemberHovercard.show(n,{e:t,el:$(this)})}).bind("mouseleave",function(e){b=!1}),$(f).bind("click",function(e){!b&&View.$groupMemberHovercard.remove()}).bind("mouseover",function(e){View.$groupMemberHovercard.isShow()&&!View.$groupMemberHovercard.isMouseover()&&Service.$task.plan(_,function(){!b&&!View.$groupMemberHovercard.isMouseover()&&View.$groupMemberHovercard.remove()})})}function p(){return new View.Div({className:"group-members"}).add(new View.Div({className:"group-members-container"}))}function l(e,t){var n;return $.each(e,function(e,i){t===i.user_uuid&&(n=i)}),n}var d="#pp-conversation-container",f=".pp-container .group-members",h=".pp-container .group-members-container",g=f+" img.pp-avatar",v=250,m=v,b=!1,w="rm-group-member-hovercard",_=w;return{build:a,isShow:i,show:e,hide:n,opacity:o,scrollbarWidth:r,_show:t}}(),View.$groupMember=function(){function e(e){var i=new View.PPDiv({className:"member"});return i.add(t(e)),i.add(n(e)),i}function t(e){var t=new View.Div({className:"pp-wrapper"}),n=e.is_online;return t.add(new View.Img({className:"pp-avatar"+(n?"":" grayscale"),src:e.user_avatar,user_uuid:e.user_uuid})),n&&(e.is_mobile_online?t.add(new View.Img({className:"pp-state pp-active",src:i})):e.is_mobile_online),t}function n(e){return new View.Div({className:"name"}).text(e.user_fullname)}var i=Configuration.assets_path+"img/state_mobile_online.png";return{build:e}}(),View.$groupMemberHovercard=function(){function e(e,t){var n=l(t);$(w).append(i(e,n).getHTML()),f(e,n)}function t(){n()&&$(x).detach(),h(),I=!1}function n(){return $(x).length>0}function i(e,t){var n=new m(e,t);return n.add(o(e)).add(s(e)).add(c(t.direction,t.arrowRight)),f(e,t),n}function o(e){return new View.Div({className:"body"}).add(r(e)).add(a(e))}function r(e){var t=e.user_avatar;return new View.Div({className:"img-container"}).add(new View.Img({src:t}))}function a(e){var t=e.user_fullname,n=e.user_signature;return new View.Div({className:"info"}).add(new View.Div({className:"name"}).text(t)).add(new View.Div({className:"signature"}).text(n))}function s(e){var t=Service.Constants.i18n("HOVER_CARD_TEXTAREA_HINT");return new View.Div({className:"textarea-container"}).add(new View.Element("textarea",{placeholder:t}))}function c(e,t){var n,i=new View.Element("style",{type:"text/css",className:_+"-style"});switch(e){case"up":n=u(t);break;case"down":n=p(t)}return i.text(n),i}function u(e){return".pp-container .group-member-hovercard:after, .pp-container .group-member-hovercard:before{top: -16px;right: "+e+'px;border: solid transparent;content: " ";height: 0;width: 0;position: absolute;pointer-events: none;}.pp-container .group-member-hovercard:before {border-color: rgba(204,204,204,0);border-bottom-color: rgba(0,0,0,0.07);border-width: 9px;margin-left: -5px;top: -18px;}.pp-container .group-member-hovercard:after {border-color: rgba(250,250,251,0);border-bottom-color: #fff;border-width: 9px;margin-left: -6px;}'}function p(e){return".pp-container .group-member-hovercard:after, .pp-container .group-member-hovercard:before{top:100%;right:"+e+'px;border: solid transparent;content: " ";height: 0;width: 0;position: absolute;pointer-events: none;}.pp-container .group-member-hovercard:before{border-color: rgba(204, 204, 204, 0);border-top-color: rgba(0, 0, 0, 0.14);border-width: 9px;margin-left: -6px;}.pp-container .group-member-hovercard:after {border-color: rgba(250, 250, 251, 0);border-top-color: #fafafb;border-width: 8px;margin-left: -5px;right:'+(e+1)+"px;}"}function l(e){var t=window.innerHeight,n=e.el.offset().top-$(window).scrollTop(),i=t-n,o=P,r=C;return i-r>=o?{direction:"up",top:n+r,arrowRight:d(e.e)}:{direction:"down",top:n-o,arrowRight:d(e.e)}}function d(e){var t=64,n=32,i=$(window).width()-e.clientX-t,o=n-e.offsetX;return i-o-5}function f(e,t){$(S).on("focus",function(n){g(t,function(){Ctrl.$groupMembers.onMemberClicked(e.user_uuid)})}),$(x).on("mouseover",function(e){I=!0}).on("mouseleave",function(e){I=!1})}function h(){$(S).off("focus"),$(x).off("mouseover").off("mouseleave")}function g(e,t){var n=46,i=18,o=40,r=10,a=100,s=368,c=300,u=50,p=window.innerHeight,l=p-u,d=$(x).offset().top-u-$(window).scrollTop()+(p-($(S).offset().top-$(window).scrollTop()))-(a-n)-i;$(x).animate({width:s,height:l,left:0,top:u},c),$(y).animate({opacity:0},c),$(S).animate({height:o}),$(E).animate({height:o,"margin-top":d,"margin-left":r,"margin-right":r},c,function(){View.$groupMembers.opacity(0),$(x).animate({opacity:0},c,function(){Ctrl.$groupMembers.hide(!1),View.$composerContainer.focus(),$onResult(void 0,t)})})}function v(){return I}function m(e,t){View.Div.call(this,{className:_,style:"top:"+t.top+"px"})}var b=".pp-container",w="#pp-conversation-container",_="group-member-hovercard",x=b+" ."+_,S=x+" textarea",y=x+" .body",E=x+" .textarea-container",P=156,C=60,I=!1;return{show:e,remove:t,isShow:n,isMouseover:v}}(),View.$loading=function(){function e(){var e=View.PPDiv;e.call(this,{id:t,"class":t+" pp-box-sizing"}),this.add(new e({id:"pp-loading-spinner",style:"background-image:url("+Configuration.assets_path+"img/spinner.png)"})).add(new View.P({className:"pp-loading-text"}))}extend(e,View.PPDiv);var t="pp-loading",n="#"+t,i=".pp-loading-text",o=function(){$(n).fadeIn()},r=function(){$(n).fadeOut(),$(i).hide().text("")},a=function(e){e&&$(i).show().text(e)},s=function(){return new e};return{build:s,show:o,hide:r,text:a}}(),View.$launcher=function(){function e(){var e=Ctrl.$launcher.get(),t=e.shouldShowLauncherWhenInit(),n=View.PPDiv;n.call(this,{id:"pp-launcher","class":"pp-launcher"},e);var i=this,o="background-image: url("+Configuration.assets_path+"img/icon-newacquire.png);background-color:"+View.Style.Color.launcher_background_color,r=e.getLauncherBottomMargin(),a=e.getLauncherRightMargin(),s="bottom:"+r+"; right:"+a;this.add(new n({id:"pp-launcher-container",style:s,event:{init:function(){e.onLauncherInit()}}},e).add(new n("pp-launcher-button-container").add(new n({id:"pp-launcher-button","class":"pp-launcher-button pp-unselectable",style:o,event:{click:function(){i.controller.onClickEvent()},mouseover:function(){i.controller.onMouseOverEvent()},mouseleave:function(){i.controller.onMouseLeaveEvent()}}}))).add(new n({id:"pp-launcher-badge","class":"pp-launcher-badge pp-font",style:"display:none"},e)).add(View.$launcherPreview.init().build()).add(View.$hoverCard.build())).show(t)}extend(e,View.PPDiv);var t="#pp-launcher-button",n="pp-launcher-button-maximize",i="pp-launcher-button-minimized",o="#pp-launcher-button-container",r="pp-launcher-button-container-active",a="pp-launcher-button-container-inactive",s=function(){return new e},c=function(){$(t).removeClass(n).addClass(i),$(o).removeClass(r).addClass(a)},u=function(){$(t).removeClass(i).addClass(n),$(o).removeClass(a).addClass(r)},p=function(){View.$launcherPreview.text("").hide(),$("#pp-messenger").show(),View.$conversation.show(),Ctrl.$hoverCard.get().hideHoverCardNow()};return{build:s,hideLauncher:c,showLauncher:u,showMessageBox:p}}(),function(e){function t(){var t=e.PPDiv;t.call(this,{id:"pp-container","class":"pp-container pp-box-sizing pp-location"}),this.add(new e.CssStyle).add(e.$launcher.build()).add(new e.PPMessenger)}extend(t,e.PPDiv),e.PPContainer=t}(View),View.$launcherPreview=function(){function e(){return Service.$pubsub.subscribe("msgArrived/launcher",function(e,t){Service.$device.inMobile()||d.show().text(t.getMessageSummary())}),d}function t(){return new r}function n(){return $(u).show(),d}function i(){return $(u).hide(),d}function o(e){return $(l).text(e),d}function r(){function e(){var e=$("#"+s),t=$("#"+c);t.bind("mouseover",function(){e.show()}).bind("mouseleave",function(){e.hide()}),e.bind("click",function(){i()})}var t=View.Div;t.call(this,{id:a,style:"display:none"}),this.add(new t("pp-launcher-preview-outer").add(new t({id:c}).add(new t("pp-launcher-preview-outer-3").add(new t({id:s,style:"background-image:url("+Configuration.assets_path+"img/icon-preview-close.png)"})).add(new t("pp-launcher-preview-p-outer").add(new View.Span({className:p}))))).add(new t("pp-launcher-preview-triangle"))),$timeout(e)}var a="pp-launcher-preview",s="pp-launcher-preview-close",c="pp-launcher-preview-outer-2",u="#"+a,p="pp-launcher-preview-p",l="."+p,d={build:t,init:e,show:n,hide:i,text:o};return d}(),function(e){function t(){e.PPDiv.call(this,{id:"pp-messenger",style:"display:none"},null),this.add(new e.PPDiv("pp-messenger-box-container").add(e.$conversation.build()))}extend(t,e.PPDiv),e.PPMessenger=t}(View),View.$poweredBy=function(){function e(){return new n}function t(){$(o).on("click",function(){Ctrl.$emojiSelector.get().showSelector(!1),Ctrl.$groupMembers.hide()})}function n(){View.PPDiv.call(this,{id:i});var e=Service.Constants.i18n("PPMESSAGE"),t='Powered by <u class="pp-font">'+e+"</u>";this.add(new View.PPElement("a",{href:Configuration.portal,target:"_blank"}).add(new View.Span({"class":"pp-powered-by-span pp-font"}).html(t)))}var i="pp-powered-by",o="#"+i;return{build:e,bindEvent:t}}(),View.$conversation=function(){function e(){View.PPDiv.call(this,{id:t,style:"background-color:"+View.Style.Color.base,"class":"pp-messenger-panel pp-box-sizing"}),this.add(View.$sheetHeader.build()).add(View.$groupContent.build()).add(View.$conversationContentContainer.build()).add(View.$loading.build())}var t="pp-conversation",n="#"+t,i="pp-conversation-content-maximize",o="pp-conversation-sheet-minimized";return{build:function(){return new e},show:function(){$(n).removeClass(o).addClass(i)},hide:function(){$(n).removeClass(i).addClass(o)}}}(),View.$composerContainer=function(){function e(){var e=Ctrl.$composerContainer.get();View.PPDiv.call(this,{id:i,style:"background-color:"+View.Style.Color.base,"class":i+" pp-box-sizing-borderbox pp-font"},e);var t=this;this.add(t.getUploadingWarningHtml(e)).add(t.getComposerEmojiContainerHtml(e)).add(new View.PPDiv({id:"pp-composer"}).add(t.getComposerSendButtonContainer(e)).add(t.getComposerFormContainerHtml(e))).add(View.$poweredBy.build()),$timeout(View.$poweredBy.bindEvent),this.calcInputTextAreaRows()}extend(e,View.PPDiv),e.prototype.getUploadingWarningHtml=function(e){return new View.PPDiv("pp-composer-container-warning").add(new View.PPElement("span",{id:"pp-composer-container-warning-span","class":"pp-composer-container-warning-span pp-font"})).show(!1)},e.prototype.getComposerEmojiContainerHtml=function(e){var t=new View.PPDiv({style:"position: relative"});return t.add(new View.$emojiSelector.build),t.add(new View.PPDiv({"class":"pp-emoji-selector-sibling",id:"pp-emoji-selector-sibling",event:{click:function(){e.onEmojiSelectorSiblingClicked()},init:function(){$("#pp-emoji-selector-sibling").css("display","none")}}},e)),t},e.prototype.getComposerFormContainerHtml=function(e){var t=new View.PPDiv({style:"position: relative; overflow: hidden;"}),n=Service.$device.isMobileBrowser(),i=this,r=new View.PPElement("form",{id:"pp-composer-container-form",name:"pp-composer-container-form",enctype:"multipart/form-data",target:"pp-composer-uploadframe",method:"post"}),a=Service.Constants.i18n(n?"START_CONVERSATION_MOBILE_HINT":"START_CONVERSATION_HINT"),s="pp-composer-container-textarea pp-box-sizing-borderbox pp-font";return Service.$device.isIE()&&(s+=" pp-composer-container-textarea-min-height"),r.add(new View.PPElement("textarea",{id:o,"class":s,"data-min-rows":1,placeholder:a,style:e.getTextareaPaddingStyle(),rows:1,event:{keydown:function(t){e.onChatTextareaKeyDown(t)},focus:function(){e.onChatTextareaFocus()},blur:function(){e.onTextareaFocusOut()},init:function(){e.onTextareaInit()},"input propertychange":function(){e.onTextareaChange()}}},e)),r.add(new View.PPElement("input",{id:"pp-composer-container-content-txt",name:"content_txt",type:"hidden"})),r.add(new View.PPElement("input",{name:"upload_type",type:"hidden",value:"content_txt"})),r.add(new View.PPElement("iframe",{id:"pp-composer-uploadframe",name:"pp-composer-uploadframe",style:"display:none"})),r.add(i.getComposerToolsContainerHtml(e)),t.add(r),t},e.prototype.getComposerToolsContainerHtml=function(e){var t=new View.PPDiv("pp-composer-container-tools-container"),n="background-image: url("+Configuration.assets_path+"img/icon-emoji.png)";t.add(new View.PPElement("strong",{id:"pp-composer-container-emoji-btn","class":"pp-composer-container-action-btn pp-composer-container-emoji-btn pp-box-sizing",style:e.isShowEmojiIcon()?"display:block;"+n:"display:none",event:{click:function(){e.onEmojiSelectorBtnClicked()},mouseover:function(){e.onEmojiSelectorBtnMouseOver()},mouseleave:function(){e.onEmojiSelectorBtnMouseLeave()}}}));var i="background-image: url("+Configuration.assets_path+"img/icon-upload.png)";return t.add(new View.PPElement("strong",{id:"pp-composer-container-file-selector","class":"pp-composer-container-action-btn pp-box-sizing",style:i,event:{click:function(){e.onFileSelectorBtnClicked()},mouseover:function(){e.onFileSelectorBtnMouseOver()},mouseleave:function(){e.onFileSelectorBtnMouseLeave()}}},e)),t.add(new View.PPElement("input",{id:"pp-composer-container-input",type:"file",event:{change:function(t){e.onFileSelect(t)}}},e)),t},e.prototype.getComposerSendButtonContainer=function(e){var t=e.isSendButtonShow(),n=Service.Constants.i18n("SEND");return new View.PPDiv({id:"pp-composer-send-button","class":"pp-composer-send-button pp-unselectable",style:"display:"+(t?"block":"none"),event:{mousedown:function(t){e.onSendButtonMouseDown(t)},init:function(){e.onSendButtonInit()}}}).add(new View.PPElement("p",{style:"padding-top: 7.5px;","class":"pp-p-no-margin"}).text(n))},e.prototype.calcInputTextAreaRows=function(){$(document).one("focus.textarea",r,function(){var e=this.value;this.value="",n=this.scrollHeight||this[0].scrollHeight,this.value=e,t=this.rows}).on("input.textarea",r,function(){c(),s()})};var t,n,i="pp-composer-container",o="pp-composer-container-textarea",r="#"+o,a=function(){return Service.$device.inMobile()?28:Service.$device.isIE()?17:23},s=function(){var e=1,t=n,i=jQuery(r)[0],o=a();i&&i.rows&&i.scrollHeight&&(i.rows=e,i.rows=e+Math.ceil((i.scrollHeight-t)/o))},c=function(){Service.$schedule.once(Service.$notifyTyping.get(Service.$notification).typing,"typing",2e3)};return{build:function(){return new e},fixInputRows:function(){s(),View.$emojiSelector.changeBottomMarginByInputHeight($(r).height())},focus:function(){$(r).focus()},blur:function(){$(r).blur()}}}(),View.$conversationContent=function(){function e(e){var n=Ctrl.$conversationContent.init();if(View.PPDiv.call(this,{id:t,"class":t+" pp-unselectable pp-box-sizing-borderbox",style:"background-color:"+View.Style.Color.base,event:{click:function(){n.onConversationContentClicked()},init:function(){n.onConversationContentInit()}}},n),e&&e.length>0)for(var i=0;i<e.length;++i)this.add(new View.PPConversationPart(e[i]))}extend(e,View.PPDiv);var t="pp-conversation-content",n="#"+t;return{build:function(t){return new e(t)},scrollToBottom:function(){$(n).stop().animate({scrollTop:$(n)[0].scrollHeight},600,"swing")},html:function(e){$(n).html(e)},append:function(e){$(n).append(e)},show:function(e){e?$(n).show():$(n).fadeIn()}}}(),View.$conversationContentContainer=function(){var e="pp-conversation-container",t="."+e,n=function(){$(t).hide()},i=function(e){e?$(t).show():$(t).fadeIn()},o=function(){return $(t).is(":visible")},r=function(){return new View.PPDiv(e).add(View.$conversationContent.build()).add(View.$composerContainer.build())};return{hide:n,show:i,visible:o,build:r}}(),function(e){function t(t){var n=new Ctrl.PPUploadingBarCtrl,i="";switch(t.messageType){case"FILE":i=t.message.file.fileUploadId;break;case"IMAGE":i=t.message.image.fileUploadId}e.PPElement.call(this,"span",{id:"pp-uploading-bar-outer-"+i,"class":"pp-uploading-bar-outer pp-font"},n),this.text(Service.Constants.i18n("UPLOADING_HINT")),this.add(new e.PPDiv({id:"pp-uploading-bar-"+i,"class":"pp-uploading-bar"}).add(new e.PPDiv({id:"pp-uploading-bar-state-"+i,"class":"pp-uploading-bar-state"}))).add(new e.PPElement("span",{id:"pp-uploading-bar-remove-"+i,"class":"pp-uploading-bar-remove",style:"background-image:url("+Configuration.assets_path+"img/icon-upload-remove.png)",event:{click:function(){n.onUploadingBarRemoveBtnClicked(i,t)}}})),setTimeout(function(){n.init(t,i)})}extend(t,e.PPElement),e.PPUploadingBar=t}(View),View.$hoverCard=function(){function e(){var e=Ctrl.$hoverCard.get();View.PPDiv.call(this,{"class":"pp-launcher-hovercard",id:"pp-launcher-hovercard",style:"display:none; transform-origin: 315px 100% 0px; transform: translate(0px 0px) scale(0.8, 0.8); opacity:0;",event:{mouseover:function(){e.onMouseOver()},mouseleave:function(){e.onMouseLeave()},click:function(){e.onHoverCardClicked()},init:function(){e.onHoverCardInit()}}},e)}return extend(e,View.PPDiv),{build:function(){return new e},smoothTranisationToMessagePanel:function(){var e=300,t=window.innerHeight,n="#pp-conversation",i="#pp-launcher-hovercard-welcome",o="#pp-launcher-hovercard-textarea",r="#pp-launcher-hovercard",a="#pp-messenger";$(n).removeClass("pp-conversation-content-maximize").removeClass("pp-conversation-sheet-minimized"),$(n).css({boxShadow:"none"}),$(i).animate({opacity:0,marginBottom:"+=100"},{duration:100}),$(o).animate({paddingBottom:"31"},{duration:e}),$(r).css({border:"none",borderLeft:"1px solid #dadee2"}).animate({width:368,paddingTop:t,borderRadius:0,right:-20,bottom:-19},{duration:e}),$(a).css({opacity:0,display:"block"}).delay(e).animate({opacity:1},{duration:0,complete:function(){$(i).removeAttr("style"),$(o).removeAttr("style"),$(r).removeAttr("style").hide(),$(a).removeAttr("style"),$(n).css({boxShadow:""})}})}}}(),function(e){e.$hoverCardContentCategorySingle=function(){function t(e){e=e||[],$("#pp-launcher-hovercard-admins").empty().append(a(e).getHTML())}var n=function(t){var n=Ctrl.$hoverCard.get(),s="#pp-launcher-hovercard",c=$(s);n.updateInitState(!0),c.empty().css("cursor","pointer").append(i(n).getElement()[0].outerHTML).append(new e.PPDiv("pp-launcher-hovercard-welcome").add(a(t.activeAdmins)).add(o(t.appTeamName,t.appWelcomeText)).getElement()[0].outerHTML).append(r(n).getElement()[0].outerHTML)},i=function(t){var n="pp-launcher-hovercard-close",i="background-image: url("+Configuration.assets_path+"img/icon-close-white.png)",o="background-color: "+e.Style.Color.hovercard_close_btn,r=t.isShowCloseButton()?"display:block":"display:none",a=Service.Constants.i18n("CLOSE");return new e.PPDiv({"class":n+" pp-font",selector:"."+n,style:i+";"+o+";"+r,event:{click:function(e){t.onHovercardCloseButtonClickEvent(e)}}}).text(a)},o=function(t,n){return new e.PPDiv("pp-launcher-hovercard-text").add(new e.PPDiv("pp-launcher-hovercard-app-name").text(t)).add(new e.PPDiv("pp-launcher-hovercard-welcome-text").text(n))},r=function(t){var n=Service.Constants.i18n("HOVER_CARD_TEXTAREA_HINT");return new e.PPDiv({id:"pp-launcher-hovercard-textarea",className:"pp-launcher-hovercard-textarea pp-box-sizing"}).add(new e.PPElement("textarea",{placeholder:n,id:"pp-launcher-hovercard-textarea-textarea",className:"pp-launcher-hovercard-textarea-textarea pp-box-sizing-borderbox",event:{focus:function(){t.onTextareaFocus()},blur:function(){t.onTextareaUnFocus()}}}))},a=function(t){var n=new e.PPDiv("pp-launcher-hovercard-admins"),i=2147483003,o=s(t),r="width:"+o+"; height:"+o,a=3;return t&&$.each(t,function(t,o){a>t&&n.add(new e.PPDiv({"class":"pp-launcher-admin-avatar",style:"z-index:"+i--,user_uuid:o.user_uuid}).add(new e.PPElement("img",{src:o.user_avatar,style:r})))}),n},s=function(e){var t="46px";if(e){var n=e.length;switch(n){case 1:t="84px";break;case 2:t="56px";break;default:t="46px"}}return t};return{updateHoverCard:n,updateUsers:t}}()}(View),View.$imageViewer=function(){function e(e,t){View.PPDiv.call(this,{"class":"pp-image-viewer"}),this.add(new View.PPDiv({"class":"pp-image-viewer-overlay"})).add(new View.PPElement("img",{"class":"pp-zoomed-image",src:e,style:t}))}extend(e,View.PPDiv);var t,n,i,o,r=".pp-image-viewer-overlay",a="#pp-container",s=".pp-image-viewer",c=".pp-image-viewer img",u=20,p=function(e){t=e,f(t),h(window.innerWidth,window.innerHeight,t),o="width:"+n.width+"px;height:"+n.height+"px;left:"+n.left+"px;top:"+n.top+"px"},l=function(){$(window).on("resize.pp-image-viewer",x),$(r).bind("click",w),$(s+" img").bind("click",w),$(document).on("keyup.pp-image-viewer",_)},d=function(){$(document).off("keyup.pp-image-viewer"),$(window).on("resize.pp-image-viewer")},f=function(e){n={width:e.width(),height:e.height(),left:e.offset().left-$(document).scrollLeft(),top:e.offset().top-$(document).scrollTop()}},h=function(e,t,n){var o=n[0],r=e-2*u,a=t-2*u,s=Math.min(r/o.naturalWidth,a/o.naturalHeight);s>1&&(s=1);var c=o.naturalWidth*s,p=o.naturalHeight*s,l=e/2-c/2,d=t/2-p/2;i={width:c,height:p,left:l,top:d}},g=function(t){return p(t),$(a).append(new e(t[0].src,o).getElement()[0].outerHTML),l(),$(c).animate(i,{duration:100,queue:!1,easing:"easeInQuart"}),$(r).animate({opacity:.8,queue:!1,easing:"easeInQuart"},200),this},v=function(){$(s).remove()},m=function(e,n){h(e,n,t),$(c).css(i)},b=function(){f(t),$(c).animate(n,{queue:!1,duration:200}),$(r).animate({opacity:0},{queue:!1,duration:500}),setTimeout(function(){v()},700),d()},w=function(){b()},_=function(e){27===e.keyCode&&b()},x=function(e){m(window.innerWidth,window.innerHeight)};return{show:g}}(),function(e){function t(t){var n=new Ctrl.AppProfileContainerCtrl(t),i=this;e.PPDiv.call(this,"pp-app-profile-container",n);var o=n.getAppTeamName(),r=n.getWelcomeText(),a=n.getActiveAdmins();this.add(new e.PPDiv("pp-app-profile").add(new e.PPDiv("pp-app-profile-activity").add(new e.PPDiv({id:"pp-app-profile-team","class":"pp-app-profile-team pp-font pp-selectable"}).text(o))).add(i.appendActiveAdminsHtmlElements(a)).add(new e.PPDiv({id:"pp-app-profile-text","class":"pp-app-profile-text pp-font pp-selectable"}).add(new e.PPElement("p").text(r))))}extend(t,e.PPDiv),t.prototype.appendActiveAdminsHtmlElements=function(t){var n=new e.PPDiv("pp-active-admins");return t&&$.each(t,function(t,i){i=Service.$users.getUser(i.user_uuid)&&Service.$users.getUser(i.user_uuid).getInfo(),n.add(new e.AppProfileContainerActiveAdmin(i))}),n},e.AppProfileContainer=t}(View),function(e){function t(t){e.PPDiv.call(this,{"class":"pp-active-admin",user_uuid:t.user_uuid});var n=t.is_online,i="state "+(n?"online":"offline"),o=function(e){return"["+(e?Service.Constants.i18n("ONLINE"):Service.Constants.i18n("OFFLINE"))+"]"},r=o(n);this.add(new e.PPDiv("pp-admin-avatar").add(new e.PPElement("img",{src:t.user_avatar}))).add(new e.PPDiv({"class":"pp-active-admin-name pp-font pp-selectable"}).text(t.user_fullname)).add(new e.PPDiv({"class":i+" pp-font"}).text(r)),Service.$pubsub.subscribe("user/infochange/"+t.user_uuid,function(e,n){var i=n.getInfo(),o=$("#pp-active-admins").find("div[user_uuid="+t.user_uuid+"]");o.length&&(o.find("img").attr("src",i.user_avatar),o.find(".pp-active-admin-name").text(i.user_fullname))}),Service.$pubsub.subscribe("user/infochange/state/"+t.user_uuid,function(e,n){var i=n.getInfo(),r=$("#pp-active-admins").find("div[user_uuid="+t.user_uuid+"]");if(r.length){var a=r.find(".state");i.is_online?a.removeClass("offline").addClass("online"):a.removeClass("online").addClass("offline"),a.text(o(i.is_online))}})}extend(t,e.PPDiv),e.AppProfileContainerActiveAdmin=t}(View),function(e){function t(t){var n=t.messageId;switch(e.PPDiv.call(this,{id:"pp-conversation-part-"+n,"class":"pp-conversation-part"}),t.messageType){case"WELCOME":t&&this.add(new e.AppProfileContainer(t));break;case"TEXT":this.add(t.user.admin?new e.PPConversationPartTextByAdmin(t):e.$userTextMessage.build(t));break;case"EMOJI":this.add(t.user.admin?new e.PPConversationPartEmojiByAdmin(t):e.$userEmojiMessage.build(t));break;case"IMAGE":this.add(t.user.admin?e.$adminImageMessage.build(t):e.$userImageMessage.build(t));break;case"AUDIO":t.user.admin&&this.add(e.$adminAudioMessage.build(t));break;case"FILE":this.add(t.user.admin?new e.PPConversationPartFileByAdmin(t):new e.PPConversationPartFileByUser(t));break;case"TIMESTAMP":this.add(new e.PPConversationPartTimestamp(t))}}extend(t,e.PPDiv),e.PPConversationPart=t}(View),View.$pulltoRefresh=function(){function e(e){var n=Ctrl.$pulltoRefreshController.get(),i=void 0!==e?e:n.getLoadHistortyHintText();View.PPDiv.call(this,{id:t,"class":t+" pp-conversation-part-center"}),this.text(i)}extend(e,View.PPDiv);var t="pp-conversation-part-pulltorefreshbutton",n="."+t,i=function(t){return new e(t)},o=function(){$(n).hide()},r=function(){$(n).show()},a=function(){return $(n)};return{build:i,hide:o,show:r,el:a}}(),function(e){function t(t){e.PPDiv.call(this,"pp-conversation-part-emoji-by-admin"),Service.$pubsub.subscribe("user/infochange/"+t.user.id,function(e,n){var i="#pp-conversation-part-"+t.messageId,o=n.getInfo();$(i).find(".pp-conversation-part-emoji-by-admin-avatar").attr("src",o.user_avatar),$(i).find(".pp-conversation-part-serve-name").text(o.user_fullname)}),this.add(new e.PPDiv("pp-conversation-part-emoji-by-admin-outer").add(new e.PPElement("img",{src:t.user.avatar,id:"pp-conversation-part-emoji-by-admin-avatar"})).add(new e.PPDiv("pp-conversation-part-emoji-by-admin-body-container").add(new e.PPDiv({
id:"","class":"pp-conversation-part-serve-name pp-font"}).text(t.user.name)).add(new e.PPElement("span",{id:"pp-conversation-part-emoji-by-admin-body","class":"pp-conversation-part-emoji-by-admin-body pp-selectable"}).text(t.message.emoji.code)).add(new e.PPElement("span",{id:"pp-conversation-part-emoji-by-admin-timestamp-"+t.messageId,"class":"pp-conversation-part-emoji-by-admin-timestamp pp-selectable pp-font"}).text())))}extend(t,e.PPDiv),e.PPConversationPartEmojiByAdmin=t}(View),View.$userEmojiMessage=function(){function e(e){return new n(e)}function t(e){$(o+e.messageId).find(".extra").text(e.extra.errorDescription).css({color:"red"}).show()}function n(e){View.PPDiv.call(this,r);var t=Service.$tools.isMessageSendError(e),n=t?e.extra.errorDescription:e.extra.description;this.add(new View.PPDiv({className:"pp-emoji-container"}).add(new View.PPDiv({className:"pp-emoji "+a}).text(e.message.emoji.code)).add((new View.PPDiv).add(new View.PPElement("span",{className:"extra "+a,style:t?"color:red; display:block;":"color:#c9cbcf; display:none;"}).text(n))))}var i="pp-conversation-part-",o="#"+i,r=i+"emoji-by-user",a="pp-selectable";return{build:e,onSendFail:t}}(),function(e){function t(t){e.PPDiv.call(this,"pp-conversation-part-file-by-admin");var n=t.user.avatar,i=t.user.name,o=t.user.id,r=t.message.file.fileUrl,a=t.message.file.fileName,s=t.messageId,c=function(e,t){var n="#pp-conversation-part-"+s,i=t.getInfo();$(n).find(".pp-conversation-part-file-by-admin-avatar").attr("src",i.user_avatar),$(n).find(".pp-conversation-part-serve-name").text(i.user_fullname)};Service.$pubsub.subscribe("user/infochange/"+o,c),this.add(new e.PPDiv("pp-conversation-part-file-by-admin-outer").add(new e.PPDiv("pp-conversation-part-file-by-admin-outer-2").add(new e.PPElement("img",{"class":"pp-conversation-part-file-by-admin-avatar",src:n})).add(new e.PPDiv("pp-conversation-part-file-by-admin-outer-3").add(new e.PPDiv({id:"","class":"pp-conversation-part-serve-name pp-font"}).text(i)).add(new e.PPDiv("pp-conversation-part-file-by-admin-outer-4").add(new e.PPDiv("pp-conversation-part-file-by-admin-outer-5").add(new e.PPDiv({id:"pp-conversation-part-file-by-admin-upload-icon",style:"background-image:url("+Configuration.assets_path+"img/icon-upload-white.png)"})).add(new e.PPDiv("pp-conversation-part-file-by-admin-outer-6").add(new e.PPElement("a",{href:r,download:a,"class":"pp-conversation-part-file-by-admin-file-link pp-font",title:a}).text(a)))).add(new e.PPDiv("pp-conversation-part-file-by-admin-timestamp-container").add(new e.PPElement("span",{"class":"pp-selectable pp-font",id:"pp-conversation-part-file-by-admin-timestamp-"+s}).text()))))))}extend(t,e.PPDiv),e.PPConversationPartFileByAdmin=t}(View),function(e){function t(t){e.PPDiv.call(this,{id:"pp-conversation-part-file-by-user-"+t.messageId,"class":"pp-conversation-part-file-by-user"});var n=Service.$tools,i=n.isMessageSendError(t),o=i?t.extra.errorDescription:t.extra.description,r=n.isUploading(t),a=Service.$device.isIE();this.add(new e.PPDiv({id:"pp-conversation-part-file-by-user-o-"+t.messageId,"class":"pp-conversation-part-file-by-user-o"}).add(new e.PPDiv({id:"pp-conversation-part-file-by-user-o2-"+t.messageId,"class":"pp-conversation-part-file-by-user-o2",style:i?"opacity: 0.6":""}).add(new e.PPDiv({id:"pp-conversation-part-file-by-user-upload-icon",style:"background-image:url("+Configuration.assets_path+"img/icon-upload-white.png)"})).add(new e.PPDiv({"class":"pp-conversation-part-file-by-user-link-container",style:a?"margin-left: 0px;":null}).add(new e.PPElement("a",{id:"pp-conversation-part-file-by-user-a-"+t.messageId,"class":"pp-font",title:t.message.file.fileName,style:i?"cursor:default":"cursor:pointer",href:t.message.file.fileServerUrl?t.message.file.fileServerUrl:void 0}).text(t.message.file.fileName)))).add(new e.PPDiv({id:"pp-conversation-part-file-by-user-timestamp-"+t.messageId,"class":"pp-conversation-part-file-by-user-timestamp pp-selectable pp-font",style:i?"color:red; display:block;":"color:#c9cbcf; display:none;"}).text(o).show(i)).add(new e.PPDiv({"class":"pp-fixme"}).add(new e.PPUploadingBar(t).show(r))))}extend(t,e.PPDiv),e.PPConversationPartFileByUser=t}(View),function(e){e.$adminImageMessage=function(){function t(t){e.PPDiv.call(this,"pp-conversation-part-image-by-admin");var n="#pp-conversation-part-"+t.messageId+" .pp-conversation-part-image-by-admin-img",o=function(){i()?e.$imageViewer.show($(n)):window.open(t.message.image.url)},r=function(){return i()?null:"cursor:pointer"};Service.$pubsub.subscribe("user/infochange/"+t.user.id,function(e,n){var i="#pp-conversation-part-"+t.messageId,o=n.getInfo();$(i).find(".pp-conversation-part-image-by-admin-avatar").attr("src",o.user_avatar),$(i).find(".pp-conversation-part-serve-name").text(o.user_fullname)}),this.add(new e.PPDiv("pp-conversation-part-image-by-admin-o").add(new e.PPDiv("pp-conversation-part-image-by-admin-o1").add(new e.PPElement("img",{src:t.user.avatar,"class":"pp-conversation-part-image-by-admin-avatar"})).add(new e.PPDiv("pp-conversation-part-image-by-admin-o2").add(new e.PPDiv("pp-conversation-part-image-by-admin-o3").add(new e.PPDiv({"class":"pp-conversation-part-serve-name pp-font"}).text(t.user.name)).add(new e.PPDiv("pp-conversation-part-image-by-admin-o4").add(new e.PPElement("img",{src:t.message.image.url,selector:n,"class":"pp-conversation-part-image-by-admin-img pp-image-viewable",style:r(),event:{click:o}})))).add(new e.PPDiv("pp-conversation-part-image-by-admin-timestamp-container").add(new e.PPElement("span",{"class":"pp-selectable pp-font",id:"pp-conversation-part-image-by-admin-timestamp-"+t.messageId}).text())))))}extend(t,e.PPDiv);var n=function(e){return new t(e)},i=function(){return!0};return{build:n}}()}(View),function(e){e.$userImageMessage=function(){function t(t){e.PPDiv.call(this,"pp-conversation-part-image-by-user");var i=Service.$tools.isUploading(t),o=t.messageId,r="#pp-conversation-part-"+o+" .pp-conversation-part-image-by-user-img",a=Service.$tools.isMessageSendError(t),s=a?t.extra.errorDescription:t.extra.description,c=Service.$tools.isMessageSendError(t)||i,u=(t.message.image.url,n()),p="pp-conversation-part-image-by-user-img"+(u?" pp-image-viewable":""),l=function(e){u?f($(r)):window.open($(r).attr("src"))},d=function(){var e="";return e+=c?"opacity: .6":"",u||(e+="cursor:pointer"),e},f=function(t){e.$imageViewer.show(t)};this.add(new e.PPDiv("pp-conversation-part-image-by-user-o").add(new e.PPElement("img",{id:"pp-conversation-part-image-by-user-img-"+t.messageId,"class":p,src:t.message.image.data||t.message.image.url,style:d(),event:{click:l}})).add(new e.PPDiv({id:"pp-conversation-part-image-by-user-timestamp-"+t.messageId,"class":"pp-conversation-part-image-by-user-timestamp pp-selectable"}).add(new e.PPElement("span",{id:"pp-conversation-part-image-by-user-timestamp-span-"+t.messageId,"class":"pp-conversation-part-image-by-user-timestamp-span pp-font",style:a?"color:red; display:block;":"color:#c9cbcf; display:none;"}).text(s)).show(!i)).add(new e.PPDiv({"class":"pp-fixme"}).add(new e.PPUploadingBar(t).show(i))))}extend(t,e.PPDiv);var n=function(){return!0},i=function(e){return new t(e)},o=function(e){return"#pp-conversation-part-image-by-user-img-"+e},r=function(e){return"#pp-conversation-part-image-by-user-timestamp-"+e},a=function(e){return"#pp-conversation-part-image-by-user-timestamp-span-"+e},s=function(e){var t=o(e);$(t).css({opacity:.6})},c=function(e,t){$(o(e)).css({opacity:.6,cursor:"default"}),$(r(e)).show(),$(a(e)).text(t).css({color:"red",display:"block"})},u=function(e,t){$(o(e)).css({opacity:1})};return{build:i,onBeginUpload:s,onSendFail:c,onSendDone:u}}()}(View),function(e){function t(t){e.PPDiv.call(this,"pp-conversation-part-text-by-admin");var n=e.$textUrlChecker.match(t.message.text.body).trustAsHtml(),i="37px";Service.$pubsub.subscribe("user/infochange/"+t.user.id,function(e,n){var i="#pp-conversation-part-"+t.messageId,o=n.getInfo();$(i).find(".pp-conversation-part-text-by-admin-avatar").attr("src",o.user_avatar),$(i).find(".pp-conversation-part-serve-name").text(o.user_fullname)}),this.add(new e.PPDiv("pp-conversation-part-text-by-admin-outer").add(new e.PPDiv("pp-conversation-part-text-by-admin-outer-2").add(new e.PPElement("img",{id:"pp-conversation-part-text-by-admin-avatar",src:t.user.avatar})).add(new e.PPDiv("pp-conversation-part-text-by-admin-outer-3").add((new e.PPDiv).add(new e.PPDiv({id:"",style:"margin-left:"+i,"class":"pp-conversation-part-serve-name pp-font"}).text(t.user.name)).add(new e.PPDiv("pp-conversation-part-text-by-admin-body-container").add(new e.PPDiv({id:"pp-conversation-part-text-by-admin-body","class":"pp-conversation-part-text-by-admin-body pp-font pp-text-link-admin pp-selectable"}).html(n))).add(new e.PPDiv("pp-conversation-part-text-by-admin-triangle"))).add(new e.PPDiv("pp-conversation-part-text-by-admin-timestamp-container").add(new e.PPElement("span",{"class":"pp-selectable pp-font",id:"pp-conversation-part-text-by-admin-timestamp-"+t.messageId}))))))}extend(t,e.PPDiv),e.PPConversationPartTextByAdmin=t}(View),View.$userTextMessage=function(){function e(e){return new n(e)}function t(e){$(r+e.messageId).find(".extra").text(e.extra.errorDescription).css({color:"red"}).show()}function n(e){i.call(this,"pp-conversation-part-text-by-user");var t=Service.$tools.isMessageSendError(e),n=t?e.extra.errorDescription:e.extra.description,o=View.$textUrlChecker.match(e.message.text.body).trustAsHtml();this.add(new i("pp-conversation-part-text-by-user-outer").add(new i("pp-wrapper").add(new i("pp-conversation-part-text-by-user-body-outer").add(new i({id:"pp-conversation-part-text-by-user-body","class":"pp-conversation-part-text-by-user-body pp-font pp-text-link-user pp-selectable"}).html(o))).add(new i("pp-conversation-part-text-by-user-triangle"))).add(new i("pp-conversation-part-text-by-user-timestamp-outer").add(new View.Span({"class":"extra pp-selectable",style:t?"color:red; display:block":"color:#c9cbcf; display:none"}).text(n))))}var i=View.PPDiv,o="pp-conversation-part-",r="#"+o;return{build:e,onSendFail:t}}(),View.$adminAudioMessage=function(){function e(e){function t(){$timeout(function(){l.canPlay()||r(g),l.hasRead()&&o(g)})}function a(e){var t=45,n=120,i=300,o=1;return e>i&&(e=i),0>e&&(e=o),t+(n-t)*e/i}function s(e,t){var o=Service.$audioContext.STATE,a=Service.$pubsub;switch(t.state){case o.NULL:i(g,t.audioId),c&&a.unsubscribe(c),c=void 0;break;case o.ERROR:i(g,t.audioId),c&&a.unsubscribe(c),c=void 0,l.markError(),r(g);break;case o.PLAYING:n(g,t.audioId)}}View.Div.call(this,{className:"msg-audio-admin"});var c,p="url("+Configuration.assets_path+"img/icon-down.png) 0 -2427px",l=e.message.audio,d=l.duration(),f=d+"''",h=u(e.messageId),g=e.messageId,v=function(e){var t=l.id(),n=Service.$audioContext;return n.isPlaying(l)?n.stop(l):(c=Service.$pubsub.subscribe("audio/"+t,s),l.markRead(),o(g),n.play(l)),!0};this.add(new View.Img({src:e.user.avatar,className:"pp-avatar"})).add(new View.Div({className:"pp-content"}).add(new View.Span({className:"pp-name"}).text(e.user.name)).add(new View.Div({className:"pp-voice",uuid:l.id()}).add(new View.Div({className:"pp-triangle"})).add(new View.Div({className:"pp-body",style:"width:"+a(d)+"px",selector:h,event:{click:v}}).add(new View.Element("i",{style:"background:"+p}))).add(new View.Span({className:"pp-dura"}).text(f)).add(new View.Div({className:"pp-unread"}))).add(new View.Span({className:"pp-desc"}))),t()}function t(t){return new e(t)}function n(e){var t=[8.3,13,23],n=s(e),i="voice-"+e,o=0;Service.$task.repeat(i,function(){n.css("width",t[o++%t.length])},500)}function i(e){Service.$task.cancelRepeat("voice-"+e),s(e).css("width",23)}function o(e){$(c(e)).find(".pp-unread").hide()}function r(e){a(e).css("color","red").text(Service.Constants.i18n("AUDIO_PLAY_ERROR")).show()}function a(e){return $(c(e)).find(".pp-desc")}function s(e){return $(c(e)).find(".pp-body").find("i")}function c(e){return"#pp-conversation-part-"+e}function u(e){return c(e)+" .pp-body"}return extend(e,View.Div),{build:t,playAudioAnimation:n,stopAudioAnimation:i}}(),function(e){function t(t){e.PPDiv.call(this,{id:"pp-conversation-part-timestamp-"+t.messageId,"class":"pp-conversation-part-center pp-font"}),this.add(new e.PPDiv({"class":"pp-conversation-part-timestamp-time"}).text(t.message.timestamp.timeStr))}extend(t,e.PPDiv),e.PPConversationPartTimestamp=t}(View),function(e){function t(t,n,i){e.PPElement.call(this,"span",{title:t.title,selector:".pp-emoji-selector-panel-header span:eq("+n+")",event:{click:function(){i.selectGroup(n)},mouseleave:function(){i.onEmojiGroupIconMouseLeave(n)},mouseover:function(){i.onEmojiGroupIconMouseOver(n)}}}),this.text(t.value)}extend(t,e.PPElement),e.PPEmojiSelectorGroupIcon=t}(View),function(e){function t(t,n){if(e.PPDiv.call(this,{id:"pp-emoji-selector-panel-header",style:"background-color:"+e.Style.Color.base},n),t&&t.length>0)for(var i=0;i<t.length;++i)this.add(new e.PPEmojiSelectorGroupIcon(t[i],i,n))}extend(t,e.PPDiv),e.PPEmojiSelectorPanelHeader=t}(View),function(e){function t(t,n,i){e.PPElement.call(this,"span",{title:t.title,selector:"#pp-emoji-selector-content > span:eq("+n+")",event:{click:function(){i.onEmojiIconClicked(n,t)},mouseover:function(){i.onEmojiIconMouseOver(n,t)},mouseleave:function(){i.onEmojiIconMouseLeave(n,t)}}},i),this.text(t.value)}extend(t,e.PPElement),e.PPEmojiIcon=t}(View),function(e){function t(t){e.PPDiv.call(this,{id:"pp-emoji-selector-content","class":"pp-emoji-selector-content pp-box-sizing"},t),setTimeout(function(){t.selectGroup(0)})}extend(t,e.PPDiv),e.PPEmojiSelectorContent=t}(View),function(e){e.$emojiSelector=function(){function t(){var t=Ctrl.$emojiSelector.get();e.PPDiv.call(this,{id:n,"class":i+" pp-box-sizing pp-unselectable",event:{init:function(){$(o).css({display:"none"})}}},t),this.add(new e.PPEmojiSelectorPanelHeader(t.getDefaultEmojiGroup(),t)).add(new e.PPEmojiSelectorContent(t)).add(new e.PPDiv("pp-emoji-selector-triangle")).add(new e.PPDiv("pp-emoji-selector-triangle-mask"))}extend(t,e.PPDiv);var n="pp-emoji-selector",i=n,o="#"+n,r="#pp-composer-container-tools-container";return{build:function(){return new t},changeBottomMarginByInputHeight:function(e){var t=e+3;$(r).css("bottom",t)}}}()}(View),function(e){function t(e,t,n){this.source=e,this.include=t,this.matchIndexArray=n}function n(){}t.prototype.trustAsHtml=function(e){if(!this.include)return this._encodeHtmlEntity(this.source);var t=this.source,n=this.matchIndexArray,i="",o=0,r=this;return $.each(n,function(n,a){i+=r._encodeHtmlEntity(t.substring(o,a.begin));var s=/^https?:\/\//.test(a.url)?a.url:"http://"+a.url;i+="<a href='"+s+"' target='_blank'",e&&(i+=" class='"+e+"'"),i+=">",i+=a.url,i+="</a>",o=a.end}),o<t.length&&(i+=this._encodeHtmlEntity(t.substring(o,t.length))),i},t.prototype._encodeHtmlEntity=function(e){var t=e;return t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;")},n.UrlPattern=/(https?:\/\/(?:www\.|(?!www))[^\s\.]+\.[a-zA-Z0-9\/\-\.=_&%#?:;|]{2,}|www\.[^\s"']+\.[a-zA-Z0-9\/\-\.=_&%#?:;|]{2,})/g,n.prototype.match=function(e){for(var i,o=[],r=n.UrlPattern;null!==(i=r.exec(e));)o.push({begin:i.index,end:r.lastIndex,url:i[0]});return new t(e,0!=o.length,o)},e.TextUrlChecker=n}(View),View.Style=function(){function e(){return i.Color=t(),i}function t(){if(void 0!==n)return n;var e=Service.$app.app()&&Service.$app.app().ppcom_launcher_color||"#54C6D6",t="#fafafb",i="#E4E4E4";return{launcher_background_color:e,base:t,base_darker:i,hovercard_close_btn:"rgba(40,45,50,.4)"}}var n,i={init:e};return i}(),function(e){function t(){this._ppSettings=null}t.DEFAULT_BOTTOM_MARGIN="20px",t.DEFAULT_RIGHT_MARGIN="20px",t.prototype.init=function(e){return this._ppSettings=e,this},t.prototype.getLauncherBottomMargin=function(){return this._getValueFromPPSettingsView("launcher_bottom_margin",t.DEFAULT_BOTTOM_MARGIN)},t.prototype.getLauncherRightMargin=function(){return this._getValueFromPPSettingsView("launcher_right_margin",t.DEFAULT_RIGHT_MARGIN)},t.prototype.isShowLauncher=function(){return this._getValueFromPPSettingsView("launcher_is_show",!0)},t.prototype._getValueFromPPSettingsView=function(e,t){var n=t;return this._ppSettings&&this._ppSettings.view&&e in this._ppSettings.view&&(n=this._ppSettings.view[e]),n},e.PPSettings=t}(View),function(e){function t(e){var t=e;this.empty=function(e){$(e).empty()},this.show=function(e,t){$(e).css("display",t?"block":"none")},this.getModal=function(){return t},this.setModal=function(e){t=e}}e.PPBaseCtrl=t}(Ctrl),function(e){function t(t){e.PPBaseCtrl.call(this);var n=t.message.welcome;this.getAppTeamName=function(){return n.appTeamName},this.getWelcomeText=function(){return n.appWelcomeText},this.getActiveAdmins=function(){return n.activeAdmins}}extend(t,e.PPBaseCtrl),e.AppProfileContainerCtrl=t}(Ctrl),Ctrl.$composerContainer=function(){function e(){Ctrl.PPBaseCtrl.call(this);var e=Service.$tools,t=Service.$device,n=Service.Constants,i=t.isMobileBrowser(),o="#pp-composer-container",r="#pp-composer-container-emoji-btn",a="#pp-composer-container-textarea",s="#pp-composer-container-file-selector",c="#pp-composer-container-warning",u=function(){var e=$(a)[0];if(e.setSelectionRange)e.focus(),e.setSelectionRange(0,0);else if(e.createTextRange){var t=e.createTextRange();t.moveStart("character",0),t.select()}};this.getTextareaPaddingStyle=function(){return this.isShowEmojiIcon()?"padding: 10px 70px 5px 14px":"padding: 10px 45px 5px 14px"},this.hide=function(){$(o).css("margin-bottom","-59px")},this.show=function(e){$(o).animate({"margin-bottom":"0px"},200,function(){e&&e()})},this.onEmojiSelectorSiblingClicked=function(){Ctrl.$emojiSelector.get().showSelector(!1)},this.onEmojiSelectorBtnClicked=function(){Ctrl.$emojiSelector.get().toggleSelector()},this.onEmojiSelectorBtnMouseOver=function(){$(r).css("opacity",1)},this.onEmojiSelectorBtnMouseLeave=function(){$(r).css("opacity",.4)},this.onFileSelectorBtnClicked=function(){Ctrl.$emojiSelector.get().showSelector(!1),$("#pp-composer-container-input").trigger("click")},this.onFileSelectorBtnMouseOver=function(){$(s).css("opacity",1)},this.onFileSelectorBtnMouseLeave=function(){$(s).css("opacity",.4)},this.onChatTextareaFocus=function(){Ctrl.$groupMembers.hide(),View.$conversationContent.scrollToBottom(),$(a).addClass("pp-textarea-focus")},this.onTextareaFocusOut=function(){$(a).removeClass("pp-textarea-focus")},this.onTextareaChange=function(){if(this.isSendButtonShow()){var e=$(a).val(),t=e&&e.length>0;this.disableSendButton(!t)}},this.onChatTextareaKeyDown=function(e){13==e.which&&(e.preventDefault(),this.sendText())},this.sendText=function(){var e=$(a).val();e&&(Ctrl.$emojiSelector.get().showSelector(!1),$(a).val(""),$(a).focus(),View.$composerContainer.fixInputRows(),$(a)[0].rows=1,new Service.PPMessage.Builder("TEXT").textMessageBody(e).build().send()),this.disableSendButton(!0)},this.onTextareaInit=function(){t.isIE()&&$(a).val("")},this.onFileSelect=function(t){var i=$(t).val(),o=e.isImage(i),r=t.files[0],a=new FileReader;if(a.onloadend=function(e){if(o)e.target&&e.target.result&&new Service.PPMessage.Builder("IMAGE").imageBody({file:r,url:i,data:e.target.result}).build().send();else{var t=i,n=-1;(n=i.lastIndexOf("\\"))>0&&(t=i.substring(n+1)),new Service.PPMessage.Builder("FILE").fileBody({fileUrl:i,file:r,fileName:t,fileSize:e.total}).build().send()}},a.onerror=function(e){Service.$debug.d("FileReader upload file error. filePath: %s, error: %s.",i,e)},t&&t.files[0]){var s=t.files[0].size;if(s>n.MAX_UPLOAD_SIZE){var u=n.i18n("MAXIMUM_UPLOAD_SIZE_HINT")+n.MAX_UPLOAD_SIZE_STR;$(c).css("display","block"),$("#pp-composer-container-warning-span").text(u),setTimeout(function(){$(c).animate({opacity:.01},3e3,function(){$(c).css("display","none"),$(c).css("opacity","1.0")})},2e3)}else a.readAsDataURL(t.files[0]);$(t).val("")}},this.isShowEmojiIcon=function(){return e.isShowEmojiIcon()},this.isSendButtonShow=function(){return i},this.onSendButtonInit=function(){this.disableSendButton(!0)},this.onSendButtonMouseDown=function(e){e.stopImmediatePropagation(),e.preventDefault(),this.sendText()},this.disableSendButton=function(e){$("#pp-composer-send-button").css("background",e?"#CCCCCC":"#0074b0")},this.resetCursor=u}extend(e,Ctrl.PPBaseCtrl);var t=null,n=function(){return null==t&&(t=new e),t};return{get:n}}(),Ctrl.$conversationContent=function(){function e(e){r=e,Ctrl.$conversationPanel.mode(Ctrl.$conversationPanel.MODE.CONTENT),Ctrl.$hoverCard.get().notifyUserActiveClickPPCom(),__Monitor.report(__MonitorEvent.show,r),e&&e.uuid&&Service.$notifyTyping.get(Service.$notification).watch(e.uuid),t(e)}function t(e){View.$conversationContent.html(View.$pulltoRefresh.el());var t=u()&&u().getMessages()||[],n="";$.each(t,function(e,i){n+=new View.PPConversationPart(t[e]).getElement()[0].outerHTML}),View.$conversationContent.append(n);var i=Modal.$conversationContentGroup.get(o());Ctrl.$sheetheader.decrUnread(i.unreadCount()),i.clearUnread(),__Monitor.report(__MonitorEvent.resume,r)}function n(e){e&&e.uuid&&Service.$notifyTyping.get(Service.$notification).unWatch(e.uuid),Service.$audioContext.close(),e&&__Monitor.report(__MonitorEvent.hide,e)}function i(){View.$conversationContentContainer.hide(),n(r),r=void 0}function o(){return r&&r.uuid}var r,a=200,s="#pp-conversation-content",c=function(){return Service.$pubsub.subscribe("msgArrived/chat",function(e,t){var n=t.getBody();n.conversation.uuid;g(n),View.$conversationContent.scrollToBottom()}),Service.$pubsub.subscribe("ws/typing",function(e,t){if(View.$conversationContentContainer.visible()){var n=o();if(n){var i,r="typing",a=r,s=Ctrl.$sheetheader,c=View.$sheetHeader.setTitle,u=s.getHeaderTitle;Service.$schedule.schedule(function(){i=u(),c(Service.Constants.i18n("TYPING"))},a).after(function(){c(i)}).onCancel(function(){c(i)}).start()}}}),Service.$pubsub.subscribe("ws/online",function(e,t){if(Service.$users.exist(t.user_uuid)&&("UNCHANGED"!=t.mobile||"UNCHANGED"!=t.browser)){var n=Service.$users.getUser(t.user_uuid).getInfo();"UNCHANGED"!=t.mobile&&(n.is_mobile_online="ONLINE"==t.mobile),"UNCHANGED"!=t.browser&&(n.is_browser_online="ONLINE"==t.browser);var i=n.is_mobile_online||n.is_browser_online;i!==n.is_online&&Service.$users.getUser(n.user_uuid).update({user_uuid:n.user_uuid,is_online:i})}}),this},u=function(e){var t=e||o();return t&&Modal.$conversationContentGroup.get(t)},p=function(e,t){var n=$(s),i=n[0].scrollHeight,o="";$.each(e,function(t,n){o+=new View.PPConversationPart(e[t]).getElement()[0].outerHTML}),n.prepend(o),n.scrollTop(n[0].scrollHeight-i),t&&t()},l=function(e,t){var n=o();n&&f(n,function(n){e&&e(),u()&&u().setLoadable(n.length>0),p(n,function(){t&&t(n)})})},d=function(){Ctrl.$emojiSelector.get().showSelector(!1),Ctrl.$groupMembers.hide(),Service.$device.isMobileBrowser()&&View.$composerContainer.blur()},f=function(e,t){u().getConversationHistory(e,t)},h=function(){$(s).append(View.$pulltoRefresh.build().getHTML())},g=function(e){var t=u(e.conversation.uuid);if(t){var n=t.addMessage(e);n&&$(s).append(new View.PPConversationPartTimestamp(n).getElement()[0].outerHTML),$(s).append(new View.PPConversationPart(e).getElement()[0].outerHTML)}},v=function(e){u()&&u().updateMessageIdsArray(e)},m=function(i,o,s){var c=o&&o.delay&&o.delay||a,u=o&&o.fadeIn&&o.fadeIn||!0,p=function(){$timeout(function(){Ctrl.$pulltoRefreshController.get(Ctrl.$conversationContent).loadable(b()).onend(d).bindEvent(),Service.$device.isMobileBrowser()||View.$composerContainer.focus(),View.$conversationContentContainer.show(u),s&&s()},c)};if(Service.$device.isIOS()&&Service.$device.disableScroll(),i&&i.token){var l=r;l!==i?(n(l),e(i)):t(i),p()}},b=function(){return u()&&u().isLoadable()};return{init:c,show:m,hide:i,onConversationContentClicked:d,onConversationContentInit:h,appendMessage:g,loadHistorys:l,updateMessageIdsArray:v,isLoadable:b}}(),Ctrl.$conversationList=function(){function e(){function e(e){var t=[];return e&&$.each(e,function(e,n){var i,o,r,a=n.token;switch(n.type){case Service.$conversationManager.TYPE.CONVERSATION:var s=n.conversation_data||n;i=Service.$tools.icon.get(s.conversation_icon),o=s.conversation_name;break;case Service.$conversationManager.TYPE.GROUP:o=n.group_name,i=Service.$tools.icon.get(n.group_icon)}t.push({uuid:a,icon:i,name:o,summary:r})}),t}function t(e){e&&$.each(e,function(e,t){if(t.type===Service.$conversationManager.TYPE.CONVERSATION){var n=t.token,i=Modal.$conversationContentGroup.get(n),o=View.$groupContentItem;i.unreadCount()>0?o.showUnread(n,i.unreadCount()):o.hideUnread(n)}})}Ctrl.$conversationPanel.mode(Ctrl.$conversationPanel.MODE.LIST),View.$loading.show(),Service.$conversationManager.asyncGetList(function(n){View.$groupContent.update(e(n)).show(),Ctrl.$conversationContent.hide(),View.$loading.hide(),t(n),i(n).load(function(e,t){View.$groupContentItem.description(e,t)})})}function t(e){function t(){View.$loading.show(),View.$groupContent.hide()}function n(e){Service.$conversationManager.asyncGetConversation({group_uuid:e.uuid},function(e){o(e&&e.token)})}function i(t){o(e)}function o(e){if(void 0!==e){var t=Service.$conversationManager;t.activeConversation(e),Ctrl.$conversationContent.show(t.activeConversation(),{},a)}else r()}function r(){View.$loading.hide(),View.$groupContent.show()}function a(){Ctrl.$conversationPanel.mode(Ctrl.$conversationPanel.MODE.CONTENT),View.$loading.hide(),View.$composerContainer.focus()}var s=Service.$conversationManager,c=s.find(e),u=s.TYPE;if(void 0!==c)switch(t(),c.type){case u.GROUP:n(c);break;case u.CONVERSATION:i(c)}}function n(){}function i(e){function t(t){e&&$.each(e,function(e,n){switch(n.type){case Service.$conversationManager.TYPE.CONVERSATION:var i=Modal.$conversationContentGroup.get(n.token);if(i&&!i.isEmpty()){var o=i.getMessages()[i.getMessages().length-1];return void(t&&t(n.token,Service.PPMessage.getMessageSummary(o)))}n.latest_message&&new Service.ApiMessageAdapter(Service.$json.parse(n.latest_message.message_body)).asyncGetPPMessage(function(e,i){i&&t&&t(n.token,i?e.getMessageSummary():"")});break;case Service.$conversationManager.TYPE.GROUP:t&&t(n.token,n.group_desc)}})}return{load:t}}return{show:e,showItem:t,hide:n}}(),Ctrl.$conversationPanel=function(){function e(e){if(void 0===e)return s;switch(s=e){case a.LIST:t(),o();break;case a.CONTENT:View.$sheetHeader.showDropDownButton(),View.$sheetHeader.showGroupButton(),o();break;case a.WAITING:t(),View.$groupContent.hide(),Ctrl.$conversationContent.hide(),View.$loading.show(),Ctrl.$sheetheader.setHeaderTitle(Service.Constants.i18n("WAITING_AVALIABLE_CONVERSATION")),i()}}function t(){Service.$schedule.cancelAll(),View.$sheetHeader.hideGroupButton(),View.$sheetHeader.hideDropDownButton(),Ctrl.$groupMembers.hide()}function n(){var t=Service.$pubsub,n=Service.$conversationManager,i=n.EVENT.WAITING,o=n.EVENT.AVALIABLE,r=200;t.subscribe(i,function(t,n){$timeout(function(){!Ctrl.$launcher.get().isLauncherShow()&&e(a.WAITING)},r)}),t.subscribe(o,function(t,n){e()===a.WAITING&&(Ctrl.$sheetheader.setHeaderTitle(),View.$groupContent.hide(),Ctrl.$conversationContent.show(Service.$conversationManager.activeConversation(),{fadeIn:!1,delay:0},function(){e(a.CONTENT),View.$loading.hide(),View.$composerContainer.focus()}))})}function i(){Service.$polling.run({eventID:c,apiFunc:Service.$api.getWaitingQueueLength,apiRequestParams:{app_uuid:Service.$app.appId()},onGet:r})}function o(){Service.$polling.cancel({eventID:c}),Service.$conversationAgency.cancel(),View.$loading.hide()}function r(e,t){if(t){var n=Service.$tools.format(Service.Constants.i18n("WAITING_LENGTH_HINT"),e.length);View.$loading.text(n)}}var a={LIST:"LIST",CONTENT:"CONTENT",WAITING:"WAITING"},s=a.CONTENT,c="POLLING_QUEUE_LENGTH_EVENT_ID";return n(),{MODE:a,mode:e,stopPollingWaitingQueueLength:o}}(),Ctrl.$emojiSelector=function(){function e(){Ctrl.PPBaseCtrl.call(this);var e=-1,t=this,n="#pp-composer-container-textarea",i="#pp-emoji-selector",o=function(e){var t="#pp-emoji-selector-content > span:eq("+e+")";return $(t)},r=function(e){var t=".pp-emoji-selector-panel-header span:eq("+e+")";return $(t)},a=function(e){return t.getDefaultEmojiGroup()[e].title};this._showSelector=!1,this.toggleSelector=function(){this._showSelector=!this._showSelector,this.showSelector(this._showSelector),View.$composerContainer.focus()},this.showSelector=function(e){this._showSelector=e,this.show(i,this._showSelector),this.show("#pp-emoji-selector-sibling",this._showSelector)},this.getDefaultEmojiGroup=function(){return[{value:Service.$emoji.getEmojiCode("People","smile").value,title:"People"},{value:Service.$emoji.getEmojiCode("Nature","cherry_blossom").value,title:"Nature"},{value:Service.$emoji.getEmojiCode("Objects","bell").value,title:"Objects"},{value:Service.$emoji.getEmojiCode("Places","blue_car").value,title:"Places"},{value:Service.$emoji.getEmojiCode("Symbols","capital_abcd").value,title:"Symbols"}]},this.onEmojiIconClicked=function(e,t){var i=o(e)[0].textContent;if($(n).val()){var r=document.getElementById("pp-composer-container-textarea").selectionStart,a=$(n).val(),s=a.substring(0,r)+i+a.substring(r);$(n).val(s),$(n)[0].focus(),$(n)[0].setSelectionRange(r+i.length,r+i.length),View.$composerContainer.fixInputRows()}else this.showSelector(!1),new Service.PPMessage.Builder("EMOJI").emojiMessageCode(i).build().send()},this.onEmojiIconMouseOver=function(e,t){o(e).css({"background-color":"#E4E4E4"})},this.onEmojiIconMouseLeave=function(e,t){o(e).css({"background-color":"#FFF"})},this.onEmojiGroupIconMouseLeave=function(t){e!=t&&r(t).css("background-color",View.Style.Color.base)},this.onEmojiGroupIconMouseOver=function(t){e!=t&&r(t).css("background-color",View.Style.Color.base_darker)},this._filterEmojiFunc=function(e){var t=this;if(Service.$device.isIE()){var n=$.inArray(e,t._IE_EMOJI_FILTER_ARRAY);return n>=0}if(Service.$device.isWindowsPlatform()&&Service.$device.isFirefox()){var n=$.inArray(e,t._WINDOWS_FIREFOX_EMOJI_FILTER_ARRAY);return n>=0}return!1},this.selectGroup=function(t){if(e!=t){var n=[],i=e,o=a(t);e=t;var s=Service.$emoji.getEmojiGroup(o,this._filterEmojiFunc);for(var c in s){var u=s[c];n.push({value:u.value,title:u.title})}-1!=i&&r(i).removeClass("active"),r(t).removeAttr("style").addClass("active"),this.empty(".pp-emoji-selector-content");var p=this,l="";$.each(n,function(e,t){l+=new View.PPEmojiIcon(t,e,p).getElement()[0].outerHTML}),$(".pp-emoji-selector-content").append(l)}}}var t;return{get:function(){return t||(t=new e),t}}}(),Ctrl.$groupMembers=function(){function e(){var e=i();View.$sheetHeader.changeDropDownButtonToShowState(),View.$groupMembers.show(e)}function t(e){var t=i();View.$sheetHeader.changeDropDownButtonToHideState(),View.$groupMembers.hide(t,e)}function n(){return View.$groupMembers.isShow()}function i(){var e=Service.$conversationManager.activeConversation();return e&&e.token}function o(e,t){Service.$conversationManager.asyncGetConversation({user_uuid:e},function(e){e&&Service.$conversationManager.activeConversation(e.token),Ctrl.$conversationContent.show(e),$onResult(void 0,t)})}return{show:e,hide:t,isShow:n,onMemberClicked:o}}(),Ctrl.$hoverCard=function(){function e(){Ctrl.PPBaseCtrl.call(this);var e,n,i=null,o=!1,r=!1,a=!1,s=this,c="#pp-launcher-hovercard",u="#pp-launcher-hovercard-textarea-textarea",p="pp-textarea-focus",l=function(){return null!=i?($clearTimeout(i),void(i=null)):void 0},d=function(){return null!=i},f=function(){return!1},h=function(){r=!1},g=function(){return n&&n.interceptLauncherClickEvent(s)};this.onHoverCardInit=function(){},this.asyncPrepareHoverCardInfo=function(i){return this.isInited()?void $onResult(!0,i):void Service.$conversationManager.asyncGetDefaultConversation(function(o){if(o){s.updateInitState(!0);var r=View.$hoverCardContentCategorySingle,a=Ctrl.$hoverCardCategorySingle,c=t(o.app_name,o.app_welcome,o.user_list);r.updateHoverCard(c),a.delegateHoverCardInitEvent(c),e=r,n=a}$onResult(!!o,i)})},this.isInited=function(){return a},this.updateInitState=function(e){a=e},this.onTextareaFocus=function(){
$(u).addClass(p)},this.onTextareaUnFocus=function(){$(u).removeClass(p)},this.onMouseOver=function(){this.showHoverCard()},this.onMouseLeave=function(){this.hideHoverCard()},this.onHoverCardClicked=function(){h(),n&&n.delegateHoverCardClickEvent(this)},this.smoothTranisationToMessagePanel=function(){View.$hoverCard.smoothTranisationToMessagePanel(),Ctrl.$conversationContent.show(Service.$conversationManager.activeConversation(),{fadeIn:!1,delay:0},function(){View.$composerContainer.focus()})},this.hideHoverCard=function(){i=$timeout(function(){s.hideHoverCardNow()},500)},this.hideHoverCardNow=function(){if(!r){var e=$(c);e.css({transform:"315px 100%"}).animate({scale:.8,x:0,y:0,opacity:0},90,function(){e.hide(),o=!1,l()})}},this.showHoverCard=function(){if(d())return void l();if(!o&&a){var e=$(c);e.stop().clearQueue().removeAttr("style"),e.show().css({transformOrigin:"315 100%",x:0,y:0}).animate({opacity:0,scale:.8,x:0,y:0},{duration:0}).animate({scale:1,x:0,y:0},{queue:!1,duration:250}).animate({opacity:1},{duration:170}),n&&n.onShow(),o=!0}},this.onHovercardCloseButtonClickEvent=function(e){e.stopImmediatePropagation(),h(),s.hideHoverCardNow()},this.isShowCloseButton=f,this.notifyUserActiveClickPPCom=h,this.interceptLauncherClickEvent=g}function t(e,t,n){return{appTeamName:e,appWelcomeText:t,activeAdmins:function(){var e=[];return n&&$.each(n,function(t,n){var i=Service.$users.adapter(n);i.user_uuid!==Service.$user.getUser().getInfo().user_uuid&&e.push(Service.$users.getOrCreateUser(i).getInfo())}),e}()}}extend(e,Ctrl.PPBaseCtrl);var n=null,i=function(){return n||(n=new e),n};return{get:i}}(),function(e){e.$hoverCardCategorySingle=function(){function t(){var e=Service.$conversationManager.vipConversation();e&&Service.$conversation.asyncGetUser(e.token,function(e){View.$hoverCardContentCategorySingle.updateUsers(e)},{reuse:!0})}function n(e){return!1}function i(t){e.$launcher.get().hideLauncher(),View.$launcherPreview.text("").hide(),t.smoothTranisationToMessagePanel()}function o(e){}return{delegateHoverCardClickEvent:i,delegateHoverCardInitEvent:o,interceptLauncherClickEvent:n,onShow:t}}()}(Ctrl),Ctrl.$launcher=function(){function e(){var e=this,n=function(){Ctrl.$hoverCard.get().showHoverCard()},s=function(){Ctrl.$hoverCard.get().hideHoverCard()};this.onClickEvent=function(){if(!Ctrl.$hoverCard.get().interceptLauncherClickEvent()){var t=Ctrl.$hoverCard.get();t.asyncPrepareHoverCardInfo(function(t){e.showMessageBox()})}},this.shouldShowLauncherWhenInit=function(){return View.$settings.isShowLauncher()},this.showMessageBox=function(){e.hideLauncher(),View.$launcher.showMessageBox(),Ctrl.$conversationPanel.mode()===Ctrl.$conversationPanel.MODE.CONTENT&&Ctrl.$conversationContent.show(Service.$conversationManager.activeConversation(),{fadeIn:!1,delay:0},function(){View.$composerContainer.focus()})},this.onMouseOverEvent=function(){if(a=!0,this.shouldShowHoverCardOnMouseOver()){var e=Ctrl.$hoverCard.get();e.asyncPrepareHoverCardInfo(function(e){e&&n()})}},this.onMouseLeaveEvent=function(){a=!1,s()},this.isMouseOver=function(){return a},this.recordOpenConversationItem=function(e){o=e},this.getLauncherIcon=function(){return i||Service.Constants.ICON_DEFAULT_LAUNCHER},this.getLauncherBottomMargin=function(){return View.$settings.getLauncherBottomMargin()},this.getLauncherRightMargin=function(){return View.$settings.getLauncherRightMargin()},this.shouldShowHoverCardOnMouseOver=function(){return!Service.$device.isMobileBrowser()&&Ctrl.$conversationPanel.mode()===Ctrl.$conversationPanel.MODE.CONTENT},this.launcherInit=function(){},this.setLauncherIcon=function(e){i=e,$("#pp-launcher-icon").attr("src",this.getLauncherIcon())},this.isLauncherShow=function(){return this.shouldShowLauncherWhenInit()&&!$("#pp-launcher-button").hasClass("pp-launcher-button-minimized")},this.onLauncherInit=function(){},this.setUnreadBadgeNum=function(e){var t=e>0;r=t?e>99?99:e:0,t?$("#pp-launcher-badge").show():$("#pp-launcher-badge").hide(),$("#pp-launcher-badge").text(r)},this.getUnreadBadgeNum=function(){return r},this.clear=function(){r=0,i="",o=""},this.hideLauncher=function(){View.$launcher.hideLauncher(),this.setUnreadBadgeNum(0),this.setLauncherIcon(""),t=void 0},Service.$pubsub.subscribe("msgArrived/launcher",function(n,i){e.setUnreadBadgeNum(e.getUnreadBadgeNum()+1),e.setLauncherIcon(i.getBody().user.avatar),e.recordOpenConversationItem(i.getBody()),t=i.getBody()})}var t,n,i="",o="",r=0,a=!1,s=function(){return n||(n=new e),n};return{get:s}}(),Ctrl.$pulltoRefreshController=function(){function e(){Ctrl.PPBaseCtrl.call(this);var e,t=Service.Constants,n=Service.$device,i=n.isMobileBrowser(),o=i?t.i18n("LOAD_HISTORY_MOBILE_HINT"):t.i18n("LOAD_HISTORY_HINT"),r=t.i18n("LOADING_HISTORY"),a=t.i18n("NO_MORE_HISTORY"),s=!0,c=this,u="#pp-conversation-part-pulltorefreshbutton",p="#pp-conversation-content",l=null,d=function(){$(p).pullToRefresh().on("start.pulltorefresh",function(e,t){Service.$debug.d("Start!! "+e+", "+t)}).on("move.pulltorefresh",function(e,t){Service.$debug.d("Move.. "+e+", "+t)}).on("end.pulltorefresh",function(e){Service.$debug.d("End.. "+e),l&&l(e)}).on("refresh.pulltorefresh",function(e,t){Service.$debug.d("Refresh.. "+e+", "+t),g()})},f=function(){$(u).remove()},h=function(t){var n=e.isLoadable(),i=n?o:a;$(p).prepend(View.$pulltoRefresh.build(i).getHTML()),v(n),c.bindEvent()},g=function(){s&&($(u).text(r),v(!1),e.loadHistorys(function(){f()},function(e){h(e)}))},v=function(e){s=e,$(u).css("cursor",s?"pointer":"default")};this.getLoadHistortyHintText=function(){return o},this.onLoadHistoryButtonClick=function(){i||g()},this.loadable=function(e){return v(e),$(u).text(e?o:a),this},this.bindEvent=function(){return i?d():View.$pulltoRefresh.el().bind("click",c.onLoadHistoryButtonClick),this},this.onend=function(e){return l=e,this},this.init=function(t){return t&&(e=t),this}}extend(e,Ctrl.PPBaseCtrl);var t=null,n=function(n){return null==t&&(t=new e),t.init(n)};return{get:n}}(),Ctrl.$sheetheader=function(){function e(){u.isIOS()&&u.enableScroll(),View.$launcher.showLauncher(),View.$conversation.hide(),Service.$schedule.cancelAll(),Service.$sheetHeader.close(!1),c()}function t(){return Service.$sheetHeader.getHeaderTitle()}function n(){Ctrl.$emojiSelector.get().showSelector(!1)}function i(e){e=e||t(),Service.$sheetHeader.setHeaderTitle(e),View.$sheetHeader.setTitle(e)}function o(){return Service.$sheetHeader.closed()}function r(){Service.$sheetHeader.asyncGetHeaderTitle(function(e){i(e)}),Service.$conversationManager.asyncGetList(function(e){var t=(e||[]).length;t>1&&View.$sheetHeader.showGroupButton()})}function a(){Service.$sheetHeader.incrUnreadCount(),View.$sheetHeader.setUnreadCount(Service.$sheetHeader.unreadCount())}function s(e){Service.$sheetHeader.decrUnreadCount(e),View.$sheetHeader.setUnreadCount(Service.$sheetHeader.unreadCount())}function c(){var e=Service.$conversationAgency,t=e.isRequestingGroupConversation(),n=300;Ctrl.$conversationPanel.stopPollingWaitingQueueLength(),$timeout(function(){i(),t&&Ctrl.$conversationList.show(),!e.isDefaultConversationAvaliable()&&Ctrl.$conversationPanel.mode(Ctrl.$conversationPanel.MODE.CONTENT)},n)}var u=Service.$device;return{onSheetHeaderInit:r,getHeaderTitle:t,onSheetHeaderClicked:n,setHeaderTitle:i,minimize:e,closed:o,incrUnread:a,decrUnread:s}}(),function(e){function t(){e.PPBaseCtrl.call(this);this.init=function(e,t){},this.onUploadingBarRemoveBtnClicked=function(e,t){Service.$uploader.cancel(e)}}extend(t,e.PPBaseCtrl),e.PPUploadingBarCtrl=t}(Ctrl),function(e){function t(e){var t=Service.$api,n=Service.$json,i=Service.$tools,o=e,r=this,a=Service.$device.isMobileBrowser(),s=!1,c=!0,u=0,p=function(e){if(e){var t=Service.PPMessage.Builder,n={appTeamName:e.appTeamName,appWelcomeText:e.appWelcomeText,activeAdmins:e.activeAdmins},i=new t("WELCOME").messageState("FINISH").conversationId(Service.$tools.getUUID()).welcomeBody(n).build().getBody();return i}},l=function(e){if(a);else if(e)return p(e)},d=function(e,t){return t&&(s=!0,e.push(t)),e},f=function(){return d([],l())},h=f(),g=[],v=function(e){return-1!=$.inArray(e,g)},m=function(e){return e.messageId?v(e.messageId):!1},b=20,w=0,_=b,x=null,S=function(e,i){return e?void t.getMessageHistory({conversation_uuid:e,page_offset:w,page_size:_,max_id:x},function(e){w++,x=x?x:e.list.length>0?e.list[0].uuid:null;var t=[];!function o(e,i,r,a){i>e?new Service.ApiMessageAdapter(n.parse(r[e].message_body)).asyncGetPPMessage(function(n,s){s&&!m(n.getBody())&&t.push(n.getBody()),o(e+1,i,r,a)}):a&&a()}(0,e.list.length,e.list,function(){var e=T(t);A(e),i&&i(e)})},function(e){i&&i([])}):void(i&&i([]))},y=300,E=y,P=null,C=null,I=function(e){var t=P,n=e.messageTimestamp,i=Service.$messageToolsModule.isMessage(e);return P=i&&n?n:P,i&&n?t?!(E>=n-t):!0:!1},T=function(e){if(!e)return e;if(0===e.length)return null!=C&&(e.push(k(C)),C=null),e;var t=[],n=C||e[0].messageTimestamp;return $.each(e,function(e,i){var o=n-i.messageTimestamp>E;o&&t.unshift(k(n)),t.unshift(i),n=i.messageTimestamp}),C=e[e.length-1].messageTimestamp,t},A=function(e){if(e&&0!=e.length){var t=e.slice().reverse();$.each(t,function(e,t){h.unshift(t)})}},k=function(e){var t=1e3*e,n=Service.Constants.I18N[Service.$language.getLanguage()].timeFormat(t);return new Service.PPMessage.Builder("TIMESTAMP").id(i.getUUID()).timestampBody({time:t,timeStr:n}).messageState("FINISH").build().getBody()};this.updateMessageIdsArray=function(e){v(e)||g.push(e)},this.clear=function(){h=[],g=[],w=0,x=null,P=null},this.getConversationHistory=function(e,t){S(e,t)},this.addMessage=function(e){if(e.messageId&&m(e))return null;var t=I(e),n=null;return t&&(n=k(e.messageTimestamp),h.push(n)),h.push(e),Service.$messageStore.map(e.messageId,o),e.messageId&&r.updateMessageIdsArray(e.messageId),n},this.find=function(e){if(v(e)){for(var t=h.length;t--;)if(h[t].messageId===e)return h[t];return e}},this.isEmpty=function(){return 0==h.length},this.getMessages=function(){return h},this.setLoadable=function(e){c=e},this.isLoadable=function(){return c},this.canAddWelcomeInfo=function(){return this.isEmpty()&&!s},this.addWelcomeInfo=function(e){var t=l(e);return d(this.getMessages(),t),t},this.unreadCount=function(){return u},this.incrUnreadCount=function(){u++},this.clearUnread=function(){u=0},this.token=function(){return o}}e.ConversationContentModal=t}(Modal),Modal.$conversationContentGroup=function(){function e(e,t){if(!t)throw new Error("Modal == null");if(n(e))throw new Error("Modal "+e+" exist!");o[e]=t}function t(e){var t;return t=n(e)?o[e]:o[e]=i(e)}function n(e){return void 0!==o[e]}function i(e){return new Modal.ConversationContentModal(e)}var o={};return{get:t,set:e,exist:n}}(),Service.PPStartUp.bootServices(),fn}function PPModule(e){var t,n=function(e){return PPMessage(e)},i=function(e){return o()||(t=n(e),a.fn=t),t},o=function(){return void 0!==t},r=function(){t=void 0},a={version:"0.2.0.6",boot:function(t,n){t=t||window.ppSettings,t&&i(e).Service.$publicApi.boot(t,n)},show:function(){o(e)&&i(e).Service.$publicApi.show()},hide:function(){o(e)&&i(e).Service.$publicApi.hide()},onShow:function(t){o(e)&&i(e).Service.$publicApi.onShow(t)},onHide:function(t){o(e)&&i(e).Service.$publicApi.onHide(t)},shutdown:function(){o(e)&&i(e).Service.$publicApi.shutdown(),r()},update:function(t){t=t||window.ppSettings,o(e)&&i(e).Service.$publicApi.update(t)&&(a.shutdown(),a.boot(t))}};return a}function JQueryModule(){return jQuery.noConflict(!0)}!function(){var e=window;!e||void 0!==e.PP&&null!==e.pp||(e.PP=PPModule(JQueryModule()),e.ppSettings&&e.PP.boot())}()}();